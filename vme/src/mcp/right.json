{
    "keyword": "right",
    "opcode": "DILSE_RIGHT",
    "yacc_rule": "| DILSE_RIGHT '(' dilexp ',' dilexp ')'\n{\n    INITEXP($$);\n\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'right' not a string.\");\n    }\n    if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'right' not an integer.\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_SP;\n        make_code(&($3));\n        make_code(&($5));\n        add_code(&($$), &($3));\n        add_code(&($$), &($5));\n        add_ubit8(&($$), DILE_RIGHT);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_right",
    "c_implementation": "void dilfe_right(dilprg *p)\n{\n    dilval *v = new dilval;\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n    int strl = 0;\n    int x = 0;\n    int y = 0;\n\n    v->type = DILV_SP;\n\n    switch (dil_getval(v1))\n    {\n        case DILV_FAIL:\n        case DILV_NULL:\n            v->type = DILV_FAIL;\n            break;\n        default:\n            v->type = DILV_ERR;\n            break;\n        case DILV_SP:\n            switch (dil_getval(v2))\n            {\n                case DILV_FAIL:\n                case DILV_NULL:\n                    v->type = DILV_FAIL;\n                    break;\n                default:\n                    v->type = DILV_ERR;\n                    break;\n                case DILV_INT:\n\n                    if (str_is_empty((char *)v1->val.ptr))\n                    {\n                        v->val.ptr = nullptr;\n                        break;\n                    }\n\n                    if ((int)strlen((char *)v1->val.ptr) < v2->val.num)\n                    {\n                        strl = strlen((char *)v1->val.ptr);\n                    }\n                    else\n                    {\n                        strl = v2->val.num;\n                    }\n\n                    if (str_is_empty((char *)v1->val.ptr) || strl == 0)\n                    {\n                        v->val.ptr = nullptr;\n                    }\n                    else\n                    {\n                        v->atyp = DILA_EXP;\n                        v->val.ptr = malloc(strl + 1);\n                        for (x = 0, y = strlen((char *)v1->val.ptr) - strl; x < strl; y++, x++)\n                        {\n                            ((char *)v->val.ptr)[x] = ((char *)v1->val.ptr)[y];\n                        }\n                        ((char *)v->val.ptr)[strl] = 0;\n                    }\n\n                    break;\n            }\n            break;\n    }\n    p->stack.push(v);\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin fnpri(FN_PRI_MISSION) unique to_the_rescue(sroomto : string);\nexternal\n   unitptr unit_room@function(u : unitptr);\n   integer walk_room@function (s:string,i:integer);\n\nvar \n   roomorg : string;\n   roomto  : string;\n   tf      : integer;\n   descorg : string;\n\ncode\n{\n   if (self.outside.type != UNIT_ST_ROOM)\n   {\n      act(\"$1n looks up, down, left, right. Pauses. Seems confused about $1s surroundings.\",\n            A_ALWAYS, self, null, null, TO_ALL);\n      quit;\n   }\n\n   roomorg := self.outside.symname;\n   descorg := self.outside_descr;\n   roomto  := sroomto;\n\n   :torescue:\n   priority;\n   self.outside_descr := sact(\"$1n is hurrying along.\", A_ALWAYS, self, null, null, TO_CHAR);\n   tf:=walk_room@function(roomto, 5);\n   self.outside_descr := sact(\"$1n is on the lookout.\", A_ALWAYS, self, null, null, TO_CHAR);\n\n   // Stay a little\n   act(\"$1n alertly scans $1s surroundings.\",A_ALWAYS, self, null, null, TO_ALL);\n   heartbeat := PULSE_SEC*4;\n   nopriority;\n\n   :nowwhat:\n   // Let the other DIL programs take control (no priority above)\n   pause;\n   pause;\n   pause;\n   if (self.position == POSITION_FIGHTING)\n      goto nowwhat;\n\n   :gohome:\n   self.outside_descr := sact(\"$1n is trodding along.\", A_ALWAYS, self, null, null, TO_CHAR);\n   priority;\n   tf:=walk_room@function(roomorg, 8);\n   self.outside_descr := descorg;\n   nopriority;\n   return;\n} dilend"
}