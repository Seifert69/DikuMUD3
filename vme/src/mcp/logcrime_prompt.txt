Generate MCP entry for DIL keyword: logcrime

=== Yacc rule ===
| DILSI_LCRI '(' coreexp ',' coreexp ',' coreexp ')' ihold
{
    if ($3.typ != DilVarType_e::DILV_UP)
    {
        dilfatal("Arg 1 of 'logcrime' not an unitptr");
    }
    else if ($5.typ != DilVarType_e::DILV_UP)
    {
        dilfatal("Arg 2 of 'logcrime' not an unitptr");
    }
    else if ($7.typ != DilVarType_e::DILV_INT)
    {
        dilfatal("Arg 3 of 'logcrime' not an integer");
    }
    else
    {
        $$.fst = $3.fst;
        $$.lst = $9 + 1;
        wtmp = &tmpl.core[$9];
        bwrite_ubit8(&wtmp, DILI_LCRI);
    }
}

=== C implementation ===
void dilfi_lcri(dilprg *p)
{
    dilval *v3 = p->stack.pop();
    dilval *v2 = p->stack.pop();
    dilval *v1 = p->stack.pop();

    p->waitcmd--;

    if (dil_type_check("logcrime", p, 3, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, TYPEFAIL_NULL, 1, DILV_UP, v3, TYPEFAIL_NULL, 1, DILV_INT))
    {
        if (v1->val.ptr && v2->val.ptr && ((unit_data *)v1->val.ptr)->isChar() && ((unit_data *)v2->val.ptr)->isChar())
        {
            log_crime((unit_data *)v1->val.ptr, (unit_data *)v2->val.ptr, v3->val.num);
        }
    }
    delete v1;
    delete v2;
    delete v3;
}

=== DIL example ===
dilbegin steal(arg : string);
external
    onefreehand();
    bobcheck(victim : unitptr);
    provoked_attack (victim : unitptr, ch : unitptr);
    awareness_check(thief : unitptr, victim : unitptr, skill : integer, msg : string);
    integer skillbattle2(skillidx : integer, abiidx1 : integer, abiidx2 : integer, opp : unitptr, oabiidx1 : integer, oabiidx2 : integer);

var
   skilla  :  integer;
   skillb  :  integer;
   skillc  :  integer;
   skilld  :  integer;
   hm      :  integer;
   vict    :  unitptr;
   targ    :  unitptr;
   t       :  string;
   temp    : string;
   ti      : integer;

code
{
   if ((self.type == UNIT_ST_PC) and (self.skills[SKI_STEAL] <= 0))
   {
      act("You must practice first.", A_ALWAYS, self, null, null, TO_CHAR);
      quit;
   }

   onefreehand();

   if (not (" from " in arg))
   {
      act("Steal what from who?", A_SOMEONE, self, null, null,  TO_CHAR);
      quit;
   }

   /* needed for multi word names */
   t := getword(arg);
   temp := getword(arg);
   while (temp != "from")
   {
      t := (t + " " + temp);
      temp := getword(arg);
   }

   vict := findunit(self, arg, FIND_UNIT_SURRO, null);
   if ((vict == null) or not visible(self, vict))
   {
      act("No such person to steal from.",  A_SOMEONE, self, null,  null, TO_CHAR);
      quit;
   }


   if (vict == self)
   {
      act("But you already have it - no need to steal it from yourself.", A_SOMEONE, self, null, null, TO_CHAR);
      quit;
   }

   if ((vict.type != UNIT_ST_PC) and (vict.type != UNIT_ST_NPC))
   {
      act("Why bother? Just get the darn thing!", A_SOMEONE, self, null, null, TO_CHAR);
      quit;
   }

   bobcheck(vict);

   targ := findunit(vict, t, FIND_UNIT_IN_ME, null);

   if ((targ == null) or not visible(self, targ))
   {
      act("You can't find that on $3n.", A_SOMEONE, self, targ, vict, TO_CHAR);
      quit;
   }

   if (targ.objecttype == ITEM_MONEY)
   {
      act("That would take a different type of finesse, try pickpocket instead.", A_SOMEONE, self, null, vict, TO_CHAR);
      quit;
   }

   if (targ.equip != 0)  /* 0 = not equipped, value not in values.h */
   {
      act("You can only steal non-equiped items!", A_SOMEONE, self, null, vict, TO_CHAR);
      quit;
   }

   if (targ.zoneidx == "treasure")
   {
      act("A chill runs down your spine...someone or something is watching.",
         A_ALWAYS, self, null, null, TO_CHAR);
      act("You change your mind about stealing that.", A_ALWAYS, self,
         null, null, TO_CHAR);
      quit;
   }

   ti := can_carry(self,targ,1);

   if (ti == 1)
   {
      act ("You can't carry another thing.", A_ALWAYS,self,null,null,TO_CHAR);
      quit;
   }

    hm := skillbattle2(SKI_STEAL, ABIL_DEX, ABIL_BRA, vict, ABIL_BRA, ABIL_DEX);
    if (isaff(self, ID_INVISIBILITY))
        hm := hm + 50;

   if (hm <= -25)
   {
      act("You are caught!", A_SOMEONE, self, targ, vict, TO_CHAR);
      if (isaff(self, ID_INVISIBILITY))
      {
         subaff(self, ID_INVISIBILITY);
      }
      act("You catch $1n trying to steal your $2n!", A_SOMEONE, self, targ,
          vict, TO_VICT);
      act("You see $1n trying to steal something from $3n...$3e doesn't " +
          "seem amused!", A_SOMEONE, self, targ, vict, TO_NOTVICT);
      provoked_attack(vict, self);
      logcrime(self, vict, CRIME_STEALING);
      quit;
   }

   if (hm <= 0)
   {
      act("You fail to steal $3n's $2n, but at least no one was watching!",
        A_SOMEONE, self, targ, vict, TO_CHAR);
      quit;
   }

   if (hm < 25)
   {
      act("You steal $2n from $3n just as $3e turns toward you..You have "+
          "been caught!", A_SOMEONE, self, targ, vict, TO_CHAR);
      if (isaff(self, ID_INVISIBILITY))
      {
          subaff(self, ID_INVISIBILITY);
      }
      act("Arrgh!  $1n just stole your $2n!", A_SOMEONE, self, targ, vict, TO_VICT);
      act("You see $1n steal something from $3n...$3e doesn't seem amused!",
          A_SOMEONE, self, targ, vict, TO_NOTVICT);
      link(targ, self);
      provoked_attack(vict, self);
      logcrime(self, vict, CRIME_STEALING);
      send_done("steal",self,targ,vict,hm,arg,null, CMD_AUTO_NONE);
      quit;
   }

   act("You stealthily steal $3n's $2n and quickly tuck it out of sight!", A_SOMEONE, self, targ, vict, TO_CHAR);
   link(targ, self);
   awareness_check(self, vict, SKI_STEAL, "You notice $2n stealing something from $3n");
   send_done("steal",self,targ,vict,hm,arg,null, CMD_AUTO_NONE);
   quit;
} dilend
