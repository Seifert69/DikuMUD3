{
    "keyword": "getword",
    "opcode": "DILSE_GETW",
    "yacc_rule": "| DILSE_GETW '(' dilexp ')'\n{\n    INITEXP($$);\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'getword' not string variable\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_SP;\n        add_code(&($$), &($3));\n        add_ubit8(&($$), DILE_GETW);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_getw",
    "c_implementation": "void dilfe_getw(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* Get first word of a string */\n    dilval *v1 = p->stack.pop();\n    char *c = nullptr;\n    char buf1[MAX_STRING_LENGTH];\n\n    switch (dil_getval(v1))\n    {\n        case DILV_NULL:\n        case DILV_FAIL:\n            v->type = DILV_FAIL; /* failed */\n            break;\n        case DILV_SP:\n            if (v1->val.ptr)\n            {\n                v->atyp = DILA_EXP;\n                v->type = DILV_SP;\n                c = str_next_word_copy((char *)v1->val.ptr, buf1);\n                c = (char *)skip_spaces(c);\n                v->val.ptr = str_dup(buf1);\n\n                if (v1->atyp == DILA_NORM && v1->type == DILV_SPR)\n                {\n                    memmove(*(char **)v1->ref, c, strlen(c) + 1);\n                }\n                else if (p->sarg->arg == (const char *)v1->val.ptr)\n                {\n                    p->sarg->arg = c; /* Update argument as in findunit :) */\n                }\n            }\n            else\n            {\n                v->type = DILV_FAIL; /* NULL string */\n            }\n            break;\n        default:\n            v->type = DILV_ERR; /* wrong type */\n            break;\n    }\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin no_command();\nvar\n  pc:unitptr;\n  splno:integer;\n  s:string;\ncode\n{\n   on_activation((self.position <= POSITION_SLEEPING) or\n   (self.position==POSITION_MORTALLYW) or\n   (self.position== POSITION_STUNNED) or\n   (self.position==POSITION_INCAP),skip);\n\n:start:\nheartbeat:= 3;\nwait(SFB_PRE, (command(\"cast\") and (target == self)));\n   s := getword(argument);\n   splno := atoi(s);\n\n   if (not(splno == SPL_COMMAND)) goto start;\n\npc:=activator;\nsecure (pc,start);\npower:=-1;\nblock;\nexec(\"say You will pay for that \"+pc.name ,self);\nexec (\"hunt \"+pc.name,self);\ngoto start;\n} dilend"
}