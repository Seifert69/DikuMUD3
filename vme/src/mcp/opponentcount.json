{
    "keyword": "opponentcount",
    "opcode": "DILSF_OPPCT",
    "yacc_rule": "| DILSF_OPPCT /* .opponentcount */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_OPPCT;\n}",
    "dilfe_name": "DILF_OPPCT",
    "c_implementation": "case DILF_OPPCT:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL:\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if ((v1->val.ptr && ((unit_data *)v1->val.ptr)->isChar()))\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_INT;\n                        if (CHAR_COMBAT((unit_data *)v1->val.ptr))\n                        {\n                            v->val.num = CHAR_COMBAT((unit_data *)v1->val.ptr)->NoOpponents();\n                        }\n                        else\n                        {\n                            v->val.num = 0;\n                        }\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin string get_pos (looker : unitptr, u:unitptr);\n\nvar\n\n     p    :  stringlist;\n     i    :  integer;\n     pc   :  unitptr;\n\ncode{\n\ni := u.position;\np := {\" is lying here, dead ... creepy.\",\n      \" is lying here, mortally wounded.\",\n      \" is lying here, incapacitated.\",\n      \" is lying here, stunned.\",\n      \" is sleeping here.\",\n      \" is resting here.\",\n      \" is sitting here.\",\n      \" is here, fighting \",\n      \" is standing here.\"};\n\nif (i != 7)\n    return (p.[i]);\n\n\nif ((u.fighting == null) and (u.opponentcount == 0))\n    return (p.[i] + \"someone who has already left.\");\n\npc := getopponent(u, 0);\n\nif (u.fighting == null)\n    return (p.[i] + pc.name + \" at a distance.\");\n\nif (u.fighting == looker)\n    return (p.[i] + \"YOU!\");\n\nreturn (p.[i] + u.fighting.name);\n\n} dilend"
}