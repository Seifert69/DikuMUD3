{
    "keyword": "inside_descr",
    "opcode": "DILSF_IDES",
    "yacc_rule": "| DILSF_IDES /* .inside_descr */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_SP;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_IDES;\n}",
    "dilfe_name": "DILF_IDES",
    "c_implementation": "case DILF_IDES:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n\n                case DILV_UP:\n                {\n                    auto *unit = reinterpret_cast<unit_data *>(v1->val.ptr);\n                    if (unit)\n                    {\n                        v->atyp = DILA_NONE; // Dont dealloc!\n                        v->type = DILV_HASHSTR;\n                        v->ref = unit->getDescriptionOfInsidePtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin do_graffiti(cc : string, cs : string);\nvar\n  exdp \t\t: extraptr;\n  pc \t\t: unitptr;\n  roomdesc\t: string;\n  startroom : string;\n  sarg\t\t: string;\n  arg\t\t: string;\n\ncode\n{\n:init:\n\n\theartbeat := PULSE_SEC*4;\n\n:start:\n\n\twait(SFB_CMD,(command(\"use\")) and (left(argument, 8) == \"graffiti\"));\n\t\n\tpc:=activator;\n\tsecure(pc, lostpc);\n\targ := argument;\n\tsarg := getword(arg);\n\tif(self.equip==WEAR_HOLD)\n\t{\n\t\t//if(left(self.outside.outside.zoneidx, 5)==\"clan_\")\n\t\t//Graffiti can currently be used anywhere, not just clanhome.\n\t\tif(1==1)\n\t\t{\n\t\t\tblock;\n\t\t\tif(\"$empty\" in self.extra)\n\t\t\t\tgoto empty;\n\t\t\telse\n\t\t\t{\t\t\n\t\t\t\tstartroom := self.outside.outside.inside_descr;\n\t\t\t\t\n\t\t\t\tif(self.outside.position < POSITION_STANDING)\n\t\t\t\t\tgoto badstance;\n\t\t\t\t\t\n\t\t\t\tact(\"You dip a brush in your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti paint.\", A_ALWAYS,pc,self,pc,TO_CHAR);\n\t\t\t\tact(\"$1n dips a brush in their <div class='\"+cc+\"'>\"+cs+\"</div> graffiti paint.\", A_ALWAYS,pc,self,pc,TO_REST);\n\n\t\t\t\twait(SFB_TICK, command(CMD_AUTO_TICK));\n\n\t\t\t\t\n\t\t\t\tif(startroom != self.outside.outside.inside_descr)\n\t\t\t\t\tgoto moved;\n\t\t\t\tif(self.outside.position == POSITION_FIGHTING)\n\t\t\t\t\tgoto fight;\n\t\t\t\tif(not(self.equip==WEAR_HOLD))\n\t\t\t\t\tgoto rem;\n\t\t\t\t\t\n\t\t\t\tact(\"You begin making your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti mark.\", A_ALWAYS,pc,self,pc,TO_CHAR);\n\t\t\t\tact(\"$1n begins leaving their mark in <div class='\"+cc+\"'>\"+cs+\"</div>.\", A_ALWAYS,pc,self,pc,TO_REST);\n\n\t\t\t\twait(SFB_TICK, command(CMD_AUTO_TICK));\t\n\n\t\t\t\t\n\t\t\t\tif(startroom != self.outside.outside.inside_descr)\n\t\t\t\t\tgoto moved;\n\t\t\t\tif(self.outside.position == POSITION_FIGHTING)\n\t\t\t\t\tgoto fight;\n\t\t\t\tif(not(self.equip==WEAR_HOLD))\n\t\t\t\t\tgoto rem;\n\t\t\t\t\t\n\t\t\t\tact(\"You complete leaving your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti mark.\", A_ALWAYS,pc,self,pc,TO_CHAR);\n\t\t\t\tact(\"$1n leaves their mark in <div class='\"+cc+\"'>\"+cs+\"</div>.\", A_ALWAYS,pc,self,pc,TO_REST);\n\t\t\t\troomdesc := self.outside.outside.inside_descr;\n\t\t\t\t\n\t\t\t\tif(not(\"$secretgraffitiextra\" in self.outside.outside.extra))\n\t\t\t\t{\n\t\t\t\t\taddextra(self.outside.outside.extra, {\"$secretgraffitiextra\"}, roomdesc);\t\n\t\t\t\t\tlog(self.outside.name+\" used graffiti in \"+self.outside.outside.nameidx+\"@\"+self.outside.outside.zoneidx+\n\t\t\t\t\t\". Room description was written to extra: $secretgraffitiextra\");\n\t\t\t\t}\n\t\t\t\tif(arg == \"self\")\n\t\t\t\t{\n\t\t\t\t\troomdesc := self.outside.outside.inside_descr+\" <div class='\"+cc+\"'>\"+self.outside.name+\"'s name is painted here in \"+cs+\" graffiti!</div>\";\n\t\t\t\t\tself.outside.outside.inside_descr := roomdesc;\n\t\t\t\t}\n\t\t\t\telse if (arg == \"\")\n\t\t\t\t{\n\t\t\t\t\troomdesc := self.outside.outside.inside_descr+\" <div class='\"+cc+\"'>\"+toupper(left(cs,1))+right(cs,length(cs)-1)+\" graffiti is painted all over!</div>\";\n\t\t\t\t\tself.outside.outside.inside_descr := roomdesc;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\troomdesc := self.outside.outside.inside_descr+\" <div class='\"+cc+\"'>\"+toupper(left(cs,1))+right(cs,length(cs)-1)+\" graffiti is painted all over!</div>\";\n\t\t\t\t\tself.outside.outside.inside_descr := roomdesc;\n\t\t\t\t\taddstring(self.outside.outside.names, arg);\n\t\t\t\t\taddextra(self.outside.outside.extra, {\"graffiti\"}, \"This graffiti has been used to add the name '\"+arg+\"' to the room.\");\n\t\t\t\t\taddextra(self.outside.outside.extra, {\"$secretgraffitiextra2\"}, arg);\n\t\t\t\t}\n\t\t\t}\n\t\t\taddextra(self.extra, {\"$empty\"}, \"\");\t\n\t\t\tgoto start;\n\t\t}\n\t\telse\n\t\t\tgoto wrongzone;\n\t}\n\t{\n\t\tblock;\t\t\t\n\n\t\tif(\"$empty\" in self.extra)\n\t\t\tgoto empty;\n\t\telse\n\t\t\tact(\"You must hold that before you can use it.\", A_ALWAYS,pc,self,pc,TO_CHAR);\n\t}\n\t\n:lostpc:\n\tunsecure(pc);\n\tgoto start;\n\t\n:empty:\n\tact(\"Your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti paint seems to be empty.\",A_ALWAYS,pc,self,null,TO_CHAR);\n\tgoto start;\n\t\n:moved:\t\n\tact(\"You abandon your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti, leaving the can empty.\",A_ALWAYS,pc,self,null,TO_CHAR);\t\n\taddextra(self.extra, {\"$empty\"}, \"\");\t\n\tgoto start;\n\t\n:badstance:\n\tact(\"You cannot use your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti in this position!\",A_ALWAYS,pc,self,null,TO_CHAR);\t\n\tgoto start;\n\t\n:fight:\n\tact(\"You abandon your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti, focusing on the combat at hand!\",A_ALWAYS,pc,self,null,TO_CHAR);\t\n\taddextra(self.extra, {\"$empty\"}, \"\");\t\n\tgoto start;\n\t\n:rem:\n\tact(\"You abandon your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti, having removed the paint.\",A_ALWAYS,pc,self,null,TO_CHAR);\t\n\taddextra(self.extra, {\"$empty\"}, \"\");\t\n\tgoto start;\n\t\n:wrongzone:\n\tblock;\n\tact(\"You cannot use your <div class='\"+cc+\"'>\"+cs+\"</div> graffiti paint here.\",A_ALWAYS,pc,self,null,TO_CHAR);\n\tgoto start;\t\n} dilend"
}