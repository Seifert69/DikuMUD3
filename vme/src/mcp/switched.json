{
    "keyword": "switched",
    "opcode": "DILSF_SWT",
    "yacc_rule": "| DILSF_SWT /* .switched */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_UP;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_SWT;\n}",
    "dilfe_name": "DILF_SWT",
    "c_implementation": "case DILF_SWT:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if (v1->val.ptr)\n                    {\n                        unit_data *switched = nullptr;\n                        unit_data *vict = nullptr;\n                        vict = ((unit_data *)v1->val.ptr);\n                        if (vict->isPC() && CHAR_DESCRIPTOR(vict) == nullptr)\n                        {\n                            descriptor_data *d = nullptr;\n                            for (d = g_descriptor_list; d; d = d->getNext())\n                            {\n                                if (descriptor_is_playing(d) && d->cgetOriginalCharacter() == vict)\n                                {\n                                    switched = d->getCharacter();\n                                    break;\n                                }\n                            }\n                        }\n                        else\n                        {\n                            if (vict->isNPC() && CHAR_DESCRIPTOR(vict))\n                            {\n                                if (CHAR_DESCRIPTOR(vict)->cgetOriginalCharacter())\n                                {\n                                    switched = CHAR_DESCRIPTOR(vict)->getCharacter();\n                                }\n                            }\n                        }\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_UP;\n                        v->val.ptr = switched;\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin heal_animal(medi : unitptr, tgt : unitptr, arg : string,\n                       hm : integer, effect : string);\nvar\n   heal_ran : integer;\n\ncode\n{\n   if ((not(race_lower_animal(tgt.race)))) // there are cases where an PC can be a 'lower animal' - Removing NPC check\n   {\n      act(\"Your spell will only heal animals.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   if (hm <= 0)\n   {\n      act(\"You fail.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   if (tgt.hp == tgt.max_hp)\n   {\n      act(\"It is in excellent health - your spell does nothing more \" +\n          \"it.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   heal_ran := rnd(self.spells[SPL_HEAL_ANIMAL]/2,\n                  self.spells[SPL_HEAL_ANIMAL]/2 + 30);\n\n   if ( (tgt.hp + heal_ran) > (tgt.max_hp) )\n      tgt.hp := (tgt.max_hp);\n   else tgt.hp := (tgt.hp + heal_ran);\n   act(\"The gods smile on you and $3N looks better.\",\n       A_ALWAYS, self, null, tgt, TO_CHAR);\n   act(\"The gods smile on $1n and $3N looks better.\",\n       A_ALWAYS, self, null, tgt, TO_NOTVICT);\n   act(\"The gods smile on $1n and you feel better.\", /*switched gods*/\n       A_ALWAYS, self, null, tgt, TO_VICT);\n\n   quit;\n} dilend"
}