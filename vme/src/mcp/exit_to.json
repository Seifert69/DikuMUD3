{
    "keyword": "exit_to",
    "opcode": "DILSF_TOR",
    "yacc_rule": "| DILSF_TOR idx /* .exit_to */\n{\n    INITEXP($$);\n    copy_code(&($$), &($2));\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_UP;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_TOR;\n    FREEEXP($2);\n}",
    "dilfe_name": "DILF_TOR",
    "c_implementation": "case DILF_TOR:\n            v2 = p->stack.pop();\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    v->type = DILV_UP;\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            switch (dil_getval(v2))\n            {\n                case DILV_FAIL:\n                    if (v->type != DILV_ERR)\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                case DILV_INT:\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n\n            if (v->type == DILV_UP)\n            {\n                auto *room = reinterpret_cast<room_data *>(v1->val.ptr);\n\n                if (room && room->isRoom() && is_in(v2->val.num, 0, MAX_EXIT))\n                {\n                    if (ROOM_EXIT(room, v2->val.num))\n                    {\n                        v->atyp = DILA_NORM;\n                        v->val.ptr = ROOM_EXIT(room, v2->val.num)->getToRoom();\n                    }\n                    else // There is no exit, the result is the null pointer\n                    {\n                        v->type = DILV_NULL;\n                        v->val.ptr = nullptr;\n                    }\n                }\n                else\n                {\n                    v->type = DILV_FAIL;\n                }\n            }\n            break;",
    "dil_example": "dilbegin clan_move(i:integer);\ncode\n{\n\tact(\"<div class='clan'>$1n vanishes.</div>\",A_HIDEINV,self, null, null, TO_ROOM);\n\tact(\"<div class='clan'>You are teleported.</div>\", A_SOMEONE,self, null, null, TO_CHAR);\n\tlink(self, self.outside.exit_to[i]);\n\tact(\"<div class='clan'>$1n appears from thin air.</div>\",A_HIDEINV, self, null, null, TO_ROOM);\n\texec(\"look\", self);\n\tquit;\n} dilend"
}