{
    "keyword": "reset_vlevel",
    "opcode": "DILSI_RSVLV",
    "yacc_rule": "| DILSI_RSVLV '(' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'reset_vlevel' not a unit\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $5 + 1;\n        wtmp = &tmpl.core[$5];\n        bwrite_ubit8(&wtmp, DILI_RSVLV);\n    }\n}",
    "dilfe_name": "dilfi_rsvlv",
    "c_implementation": "void dilfi_rsvlv(dilprg *p)\n{\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"reset_vlevel\", p, 1, v1, TYPEFAIL_NULL, 1, DILV_UP))\n    {\n        if (p->frame[0].tmpl->zone->getAccessLevel() > 1)\n        {\n            szonelog(p->frame->tmpl->zone, \"DIL '%s' attempt to reset vlevel w/o access.\", p->frame->tmpl->prgname);\n            p->waitcmd = WAITCMD_QUIT;\n        }\n        else\n        {\n            auto *pc = reinterpret_cast<pc_data *>(v1->val.ptr);\n            if (pc->isPC())\n            {\n                if (!IS_IMMORTAL(pc))\n                {\n                    pc->setVirtualPlayerLevel(1);\n                }\n            }\n        }\n    }\n    delete v1;\n}",
    "dil_example": "dilbegin recall aware nanny_rebirth ();\nexternal guild_choose ();\n   upd_all_comp@competition(u:unitptr);\n   upd_rebirth@competition(u:unitptr);\n   pcinitabils@basis();\n\nvar\n   pc          : unitptr;\n   weapon      : unitptr;\n   nxt         : unitptr;\n   tempu       : unitptr;\n   link_u      : unitptr;\n   t_u         : unitptr;\n   temp_u      : unitptr;\n   i           : integer;\n   j           : integer;\n   l           : integer;\n   picks       : integer;\n   my_pcflags  : integer;\n   s           : string;\n   new_guild   : string;\n   figh_choice : integer;\n   heal_choice : integer;\n   conj_choice : integer;\n   thie_choice : integer;\n   pala_choice : integer;\n   sorc_choice : integer;\n   assa_choice : integer;\n   necr_choice : integer;\n   rang_choice : integer;\n   drui_choice : integer;\n   dk_choice : integer;\n   expd       : extraptr;   /* REBIRTH_DATA in self */\n   expd2      : extraptr;\n   broad      : string;\n   slist      : stringlist;\n\ncode\n{\n   heartbeat := PULSE_SEC * 2;\n   pause;\n\n\n   /* Unequip all */\n   weapon:=self.inside;\n   while (weapon!=null){\n      if (weapon.equip!=0){\n         unequip(weapon);\n      }\n      weapon:=weapon.next;\n\t}\n\n   /* Remove affects */\n\n   /* This is almost a copy/paste from basis dispel_magic */\n   :loop:\n   if (isaff(self, ID_BLESS))\n     subaff(self, ID_BLESS);\n   else if (isaff(self, ID_UNHOLY_BLESSING))\n     subaff(self, ID_UNHOLY_BLESSING);\n   else if (isaff(self, ID_NBLESS))\n     subaff(self, ID_NBLESS);\n   else if (isaff(self, ID_RAGE))\n     subaff(self, ID_RAGE);\n   else if (isaff(self, ID_BERSERK))\n     subaff(self, ID_BERSERK);\n   else if (isaff(self, ID_DETECT_ALIGN))\n     subaff(self, ID_DETECT_ALIGN);\n   else if (isaff(self, ID_DETECT_INVISIBLE))\n     subaff(self, ID_DETECT_INVISIBLE);\n   else if (isaff(self, ID_DETECT_MAGIC))\n     subaff(self, ID_DETECT_MAGIC);\n   else if (isaff(self, ID_DETECT_POISON))\n     subaff(self, ID_DETECT_POISON);\n   else if (isaff(self, ID_DETECT_UNDEAD))\n     subaff(self, ID_DETECT_UNDEAD);\n   else if (isaff(self, ID_DETECT_CURSE))\n     subaff(self, ID_DETECT_CURSE);\n   else if (isaff(self, ID_DETECT_LIFE))\n     subaff(self, ID_DETECT_LIFE);\n   else if (isaff(self, ID_ENCHANT_WEAPON))\n     subaff(self, ID_ENCHANT_WEAPON);\n   else if (isaff(self, ID_ENCHANT_ARMOUR))\n     subaff(self, ID_ENCHANT_ARMOUR);\n   else if (isaff(self, ID_ABSORBTION))\n     subaff(self, ID_ABSORBTION);\n   else if (isaff(self, ID_INVISIBILITY))\n     subaff(self, ID_INVISIBILITY);\n   else if (isaff(self, ID_HOLD))\n     subaff(self, ID_HOLD);\n   else if (isaff(self, ID_CHARM))\n     subaff(self, ID_CHARM);\n   else if (isaff(self, ID_MAGIC_LIGHT))\n     subaff(self, ID_MAGIC_LIGHT);\n   else if (isaff(self, ID_MAGIC_DARK))\n     subaff(self, ID_MAGIC_DARK);\n   else if (isaff(self, ID_SPL_RAISE_MAG))\n     subaff(self, ID_SPL_RAISE_MAG);\n   else if (isaff(self, ID_SPL_RAISE_DIV))\n     subaff(self, ID_SPL_RAISE_DIV);\n   else if (isaff(self, ID_SPL_RAISE_STR))\n     subaff(self, ID_SPL_RAISE_STR);\n   else if (isaff(self, ID_SPL_RAISE_DEX))\n     subaff(self, ID_SPL_RAISE_DEX);\n   else if (isaff(self, ID_SPL_RAISE_CON))\n     subaff(self, ID_SPL_RAISE_CON);\n   else if (isaff(self, ID_SPL_RAISE_CHA))\n     subaff(self, ID_SPL_RAISE_CHA);\n   else if (isaff(self, ID_SPL_RAISE_BRA))\n     subaff(self, ID_SPL_RAISE_BRA);\n   else if (isaff(self, ID_SPL_RAISE_HPP))\n     subaff(self, ID_SPL_RAISE_HPP);\n   else if (isaff(self, ID_SPL_RAISE_DIVINE))\n     subaff(self, ID_SPL_RAISE_DIVINE);\n   else if (isaff(self, ID_SPL_RAISE_SUMMONING))\n     subaff(self, ID_SPL_RAISE_SUMMONING);\n   else if (isaff(self, ID_SPL_RAISE_MIND))\n     subaff(self, ID_SPL_RAISE_MIND);\n   else if (isaff(self, ID_SPL_RAISE_HEAT))\n     subaff(self, ID_SPL_RAISE_HEAT);\n   else if (isaff(self, ID_SPL_RAISE_COLD))\n     subaff(self, ID_SPL_RAISE_COLD);\n   else if (isaff(self, ID_SPL_RAISE_CELL))\n     subaff(self, ID_SPL_RAISE_CELL);\n   else if (isaff(self, ID_SPL_RAISE_INTERNAL))\n     subaff(self, ID_SPL_RAISE_INTERNAL);\n   else if (isaff(self, ID_SPL_RAISE_EXTERNAL))\n     subaff(self, ID_SPL_RAISE_EXTERNAL);\n   else if (isaff(self, ID_RAISE_MAG))\n     subaff(self, ID_RAISE_MAG);\n   else if (isaff(self, ID_RAISE_DIV))\n     subaff(self, ID_RAISE_DIV);\n   else if (isaff(self, ID_RAISE_STR))\n     subaff(self, ID_RAISE_STR);\n   else if (isaff(self, ID_RAISE_DEX))\n     subaff(self, ID_RAISE_DEX);\n   else if (isaff(self, ID_RAISE_CON))\n     subaff(self, ID_RAISE_CON);\n   else if (isaff(self, ID_RAISE_CHA))\n     subaff(self, ID_RAISE_CHA);\n   else if (isaff(self, ID_RAISE_BRA))\n     subaff(self, ID_RAISE_BRA);\n   else if (isaff(self, ID_RAISE_HPP))\n     subaff(self, ID_RAISE_HPP);\n   else if (isaff(self, ID_RAISE_DIVINE))\n     subaff(self, ID_RAISE_DIVINE);\n   else if (isaff(self, ID_RAISE_SUMMONING))\n     subaff(self, ID_RAISE_SUMMONING);\n   else if (isaff(self, ID_RAISE_MIND))\n     subaff(self, ID_RAISE_MIND);\n   else if (isaff(self, ID_RAISE_HEAT))\n     subaff(self, ID_RAISE_HEAT);\n   else if (isaff(self, ID_RAISE_COLD))\n     subaff(self, ID_RAISE_COLD);\n   else if (isaff(self, ID_RAISE_CELL))\n     subaff(self, ID_RAISE_CELL);\n   else if (isaff(self, ID_RAISE_INTERNAL))\n     subaff(self, ID_RAISE_INTERNAL);\n   else if (isaff(self, ID_RAISE_EXTERNAL))\n     subaff(self, ID_RAISE_EXTERNAL);\n   else if (isaff(self, ID_MIRE))\n     subaff(self, ID_MIRE);\n   else if (isaff(self, ID_CONDEMN))\n     subaff(self, ID_CONDEMN);\n   else if (isaff(self, ID_FOCUS))\n     subaff(self, ID_FOCUS);\n   else if (isaff(self, ID_POISON))\n     subaff(self, ID_POISON);\n   else if (isaff(self, ID_SPEED))\n     subaff(self, ID_SPEED);\n   else\n\tgoto end_aff;\n\n\n   goto loop;\n   :end_aff:\n\n   i := 0;\n\n/* First reduce skills by 75% */\n\n   while (i < LAST_SKILL)\n   {\n      self.skills[i] := self.skills[i] / 8;\n      self.skills[i] := self.skills[i] * 2;\n      i := i + 1;\n   }\n\n   i := 0;\n\n/* Now spells */\n\n   while (i < LAST_SPELL)   /* was 220 */\n   {\n      self.spells[i] := self.spells[i] / 4;\n      i := i + 1;\n   }\n\n   i := 0;\n\n/* Now weapons */\n\n   while (i < LAST_WEAPON)  /* was 60 */\n   {\n      self.weapons[i] := self.weapons[i] / 4;\n      i := i + 1;\n   }\n\n   expd2 := \"$path\" in self.quests;\n   if (expd2 != null)\n   {\n      self.guild := expd2.names.[1];\n      subextra(self.quests, \"$path\");\n   }\n   expd2 := null;\n\n   expd2 := \"$dead_g\" in self.quests;\n   if (expd2 != null)\n   {\n      self.guild := expd2.names.[1];\n   }\n\n   if (self.guild == GUILD_UDG_FIGHTER)\n      l := 2;\n   else if (self.guild == GUILD_UDG_THIEF)\n      l := 3;\n   else if (self.guild == GUILD_UDG_CLERIC)\n      l := 4;\n   else if (self.guild == GUILD_UDG_MAGE)\n      l := 5;\n   else if (self.guild == GUILD_PALADIN)\n      l := 6;\n   else if (self.guild == GUILD_SORCERER)\n      l := 7;\n   else if (self.guild == GUILD_ASSASSIN)\n      l := 8;\n   else if (self.guild == GUILD_NECROMANCER)\n      l := 9;\n   else if (self.guild == GUILD_NYM_RANGER)\n      l := 10;\n   else if (self.guild == GUILD_NYM_DRUID)\n      l := 11;\n   else if (self.guild == GUILD_KNIGHT)\n      l := 12;\n\n\n\n/* Remove me from guilds */\n\n:remove_guilds:\n\n   if (\"$guild\" in self.quests)\n   {\n      subextra(self.quests, \"$guild\");\n      goto remove_guilds;\n   }\n\n   self.guild := \"Rebirthing\";\n\n   if (dilfind(\"no_kill@basis\", self))\n   {\n      i := dildestroy(\"no_kill@basis\", self);\n      set(self.pcflags, PC_PK_RELAXED);\n   }\n\n   if ((isset(self.pcflags, PC_PK_RELAXED)) and (not(\"$Rebirth_Bob\" in\n         self.quests)))\n   {\n      addextra(self.quests,{\"$Re-Bob\"},\"\");\n      unset(self.pcflags, PC_PK_RELAXED);\n   }\n\n   /* Here we remove the inform pc flag from the person's pcflags - this stops\n      spam, etc - the settings are retained and replaced at the end\n      of the procecure. */\n\n   my_pcflags := self.pcflags;\n   if (isset(my_pcflags, PC_INFORM))\n      unset(self.pcflags, PC_INFORM);\n\n/* We worry about abilities later */\naddextra(self.extra,{\"$rebirth_prompt\"},self.prompt);\ni:=dildestroy(\"send_prompt@update\",self);\ndilcopy (\"rebirth_prompt@update\",self);\n\n   self.prompt := \">\";\n\n   act(\"In a state of semi-consciousness, an ethereal voice \" +\n       \"calls to you through the void...\\n\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n   heartbeat := PULSE_SEC*4;\n   wait(SFB_CMD | SFB_TICK, TRUE);\n   block;\n   heartbeat := PULSE_SEC;\n   act(\"Life ends, and is born anew. You must now choose the beginning \" +\n       \"of your new life, \" + self.name + \". <div class=cpw>Remember your \" +\n       \"choices will affect \" +\n       \"later choices, e.g. your alignment affects what guilds you \" +\n       \"can join.</div>\\n\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n\n:get_gender:\n   self.prompt := \"Please select 1 or 2:\";\n   sendtext(\"\\nPlease choose your new gender:\\n\" +\n            \"  <div class=cpw>1</div>) Male\\n\" +\n            \"  <div class=cpw>2</div>) Female\\n\", self);\n\n   wait(SFB_CMD, (activator == self));\n   block;\n   if (not(command(\"1\")) and not (command(\"2\")))\n   {\n      act(\"That is not a valid gender!\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_gender;\n   }\n\n   if (command(\"1\"))\n   {\n      self.sex := SEX_MALE;\n      act(\"You are now male.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_race;\n   }\n\n   else\n   {\n      self.sex := SEX_FEMALE;\n      act(\"You are now female.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_race;\n   }\n\n:get_race:\n\n   self.prompt := \"Please select 1 - 11:\";\n   sendtext(\"\\nPlease choose your race:\\n\"+\n            \"  <div class=cpw>1</div>) Human</div>            <div class=cpw> 7</div>) Half-Ogre \\n\"+\n            \"  <div class=cpw>2</div>) Elf</div>              <div class=cpw> 8</div>) Half-Elf\\n\"+\n            \"  <div class=cpw>3</div>) Dwarf</div>            <div class=cpw> 9</div>) Brownie\\n\"+\n            \"  <div class=cpw>4</div>) Halfing</div>          <div class=cpw>10</div>) Groll\\n\"+\n            \"  <div class=cpw>5</div>) Gnome</div>            <div class=cpw>11</div>) Dark-Elf (Evil)\\n\"+\n            \"  <div class=cpw>6</div>) Half-Orc\\n\", self);\n\n   wait(SFB_CMD, (activator == self));\n   block;\n\n   if (atoi(cmdstr) == 1)\n   {\n      self.race := 0;\n      act(\"You are now a human.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 2)\n   {\n      self.race := 1;\n      act(\"You are now an elf.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 3)\n   {\n      self.race := 2;\n      act(\"You are now a dwarf.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 4)\n   {\n      self.race := 3;\n      act(\"You are now a halfling.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 5)\n   {\n      self.race := 4;\n      act(\"You are now a gnome.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 6)\n   {\n      self.race := 5;\n      act(\"You are now a half-orc.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 7)\n   {\n      self.race := 6;\n      act(\"You are now a half-ogre.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 8)\n   {\n      self.race := 7;\n      act(\"You are now a half-elf.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 9)\n   {\n      self.race := 8;\n      act(\"You are now a brownie.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 10)\n   {\n      self.race := 9;\n      act(\"You are now a groll.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else if (atoi(cmdstr) == 11)\n   {\n      self.race := 10;\n      act(\"You are now a dark-elf.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_alignment;\n   }\n\n   else\n   {\n      act(\"That is not a valid race!\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      goto get_race;\n   }\n\n:get_alignment:\n\n/* As of July 17th, This has been put in guild_choose with guilds. */\n\n   guild_choose();\n\n:finish_off:\n/*   self.guild := new_guild;\n\n   new_guild := \"$\" + new_guild;\n\n   data_list := null;\n   addstring(data_list, new_guild);\n   addstring(data_list, \"0\");\n   addstring(data_list, \"$guild\");\n\n   addextra(self.quests, data_list, itoa(realtime));\n*/\n\n   reset_level(self);  /* Reset my level to 1 */\n   reset_race(self);   /* Reset my race attributes - age, costs, etc */\n   reset_vlevel(self);\n\n   pcinitabils@basis();\n\n   if (self.race==RACE_HUMAN)\n   {\n      self.birth := realtime - (rnd(16, 19) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_DWARF)\n   {\n      self.birth := realtime - (rnd(60,85) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_ELF)\n   {\n      self.birth := realtime - (rnd(190,215) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_HALFLING)\n   {\n      self.birth := realtime - (rnd(39, 48) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_GNOME)\n   {\n      self.birth := realtime - (rnd(104, 137) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_HALF_OGRE)\n   {\n      self.birth := realtime - (rnd(20, 30) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_HALF_ORC)\n   {\n      self.birth := realtime - (rnd(19, 25) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_BROWNIE)\n   {\n      self.birth := realtime - (rnd(34, 48) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_HALF_ELF)\n   {\n      self.birth := realtime - (rnd(25, 40) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_GROLL)\n   {\n      self.birth := realtime - (rnd(9, 12) * SECS_PER_MUD_YEAR);\n   }\n   else if (self.race==RACE_DARK_ELF)\n   {\n      self.birth := realtime - (rnd(196, 226) * SECS_PER_MUD_YEAR);\n   }\n\n   /* Update morph data, etc */\n\n      expd := PC_REBIRTHS in self.extra;\n\n      if (expd == null)\n          {\n          slist := {PC_REBIRTHS};\n          addstring (slist, \"0\");\n          addextra (self.extra, slist, \"Total Rebirths\");\n          expd := PC_REBIRTHS in self.extra;\n          }\n\n      i := 0;\n\n      expd.names.[1] := itoa(atoi(expd.names.[1]) + 1);\n\n      if (l == 2)\n      {\n       expd := F_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {F_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Fighter Rebirths\");\n         expd := F_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 3)\n      {\n       expd := T_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {T_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Thief Rebirths\");\n         expd := T_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 4)\n      {\n       expd := H_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {H_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Healer Rebirths\");\n         expd := H_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 5)\n      {\n       expd := C_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {C_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Conjurer Rebirths\");\n         expd := C_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 6)\n      {\n       expd := P_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {P_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Paladin Rebirths\");\n         expd := P_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 7)\n      {\n       expd := S_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {S_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Sorcerer Rebirths\");\n         expd := S_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 8)\n      {\n       expd := A_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {A_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Assassin Rebirths\");\n         expd := A_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 9)\n      {\n       expd := N_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {N_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Necromancer Rebirths\");\n         expd := N_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 10)\n      {\n       expd := R_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {R_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Ranger Rebirths\");\n         expd := R_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n      if (l == 11)\n      {\n       expd := D_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {D_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Druid Rebirths\");\n         expd := D_REBIRTHS in self.extra;\n        }\n       goto setit;\n      }\n\t   expd := DK_REBIRTHS in self.extra;\n       if(expd == null)\n        {\n         slist := {DK_REBIRTHS};\n         addstring(slist, \"0 0\");\n         addextra(self.extra, slist, \"Knight Rebirths\");\n         expd := DK_REBIRTHS in self.extra;\n        }\n       goto setit;\n\n:setit:\n         slist := getwords(expd.names.[1]);\n         slist.[0] := itoa(atoi(slist.[0]) + 5);\n         slist.[1] := itoa(atoi(slist.[1]) + 1);\n         expd.names.[1] := slist.[0] +\" \"+ slist.[1];\n\n         expd := SAC_POINTS in self.extra;\n         expd.names.[1] := \"0\";\n\n   expd2 := \"$rebirth_prompt\" in self.extra;\n   self.prompt := expd2.descr;\n   subextra(self.extra, \"$rebirth_prompt\");\ni:=dildestroy(\"rebirth_prompt@update\",self);\ndilcopy (\"send_prompt@update\",self);\n\n\n   act(\"&h\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n\n   act(\"\\n\\nThe gods have seen fit to let you keep your equipment from \" +\n       \"your previous life in the hope that it will help you in this \" +\n       \"new one.\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n   wait(SFB_CMD | SFB_TICK, TRUE);\n   block;\n   act(\"A great portal opens and you find yourself somewhere else!\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n\n   if (self.guild == GUILD_ASSASSIN)\n      link(self, findroom(\"entrance@assassin\"));\n   else if (self.guild == GUILD_SORCERER)\n      link(self, findroom(\"ent_guild@sorcerer\"));\n   else if (self.guild == GUILD_NYM_RANGER)\n      link(self, findroom(\"for_gath1@ranger\"));\n   else if (self.guild == GUILD_UDG_FIGHTER)\n      link(self, findroom(\"entrance@fightersguild\"));\n   else if (self.guild == GUILD_UDG_THIEF)\n      link(self, findroom(\"entrance@thievesguild\"));\n   else if (self.guild == GUILD_UDG_CLERIC)\n      link(self, findroom(\"entrance@clericguild\"));\n   else if (self.guild == GUILD_UDG_MAGE)\n      link(self, findroom(\"entrance@mageguild\"));\n   else if (self.guild == GUILD_PALADIN)\n      link(self, findroom(\"mon_yard@paladin_guild\"));\n   else if (self.guild == GUILD_NECROMANCER)\n      link(self, findroom(\"church_ruin@necro_guild\"));\n   else if (self.guild == GUILD_KNIGHT)\n      link(self, findroom(\"room_5@knight\"));\n   else if (self.guild == GUILD_NYM_DRUID)\n      link(self, findroom(\"henge@druid\"));\n\n   if (self.outside.nameidx == \"waiting_room\")\n      link(self, findroom(\"temple@udgaard\"));\n\nupd_rebirth@competition(self);\n   i := 0 - self.exp;\n   experience(i, self);\n   \n   experience(11250, self);\n                                 upd_all_comp@competition(self);\n\n   subextra (self.quests, \"$dead_g\");\nself.max_hp:=3*self.abilities[ABIL_HP]+20;\n   self.skill_points := 80;\n   self.ability_points := 40;\n\n:end:\n   sendto(\"rebirth_done\", self);\n\n   /* cycle through wearable equipment and resize */\n   set_weight(self, self.baseweight);\n\n   tempu := self.inside;\n   while(tempu)\n   {\n      if ((tempu.names.[0]==\"storage container\") and (tempu.minv>200))\n      {\n         set_weight_base(tempu, 0);\n         set_weight(tempu, 0);\n      }\n\n      if (tempu.weight<0)\n      {\n         if (tempu.minv>=200)\n            set_weight(tempu, 0);\n         else\n            set_weight(tempu, tempu.baseweight);\n\t   }\n      set_weight(self, self.weight+tempu.weight);\n\n\n     if((tempu.manipulate & (MANIPULATE_WEAR_FINGER | MANIPULATE_WEAR_NECK  |\n                             MANIPULATE_WEAR_BODY   | MANIPULATE_WEAR_HEAD  |\n                             MANIPULATE_WEAR_LEGS   | MANIPULATE_WEAR_FEET  |\n                             MANIPULATE_WEAR_HANDS  | MANIPULATE_WEAR_ARMS  |\n                             MANIPULATE_WEAR_SHIELD | MANIPULATE_WEAR_ABOUT |\n                             MANIPULATE_WEAR_WAIST  | MANIPULATE_WEAR_WRIST |\n                             MANIPULATE_WIELD       | MANIPULATE_WEAR_EAR   |\n                             MANIPULATE_WEAR_BACK   | MANIPULATE_WEAR_CHEST |\n                             MANIPULATE_WEAR_ANKLE)) == 0) goto nowayinhell;\n     tempu.height := self.height;\n:nowayinhell:\n     tempu := tempu.next;\n    }\n\n:go_on:\n\n   if (isset(my_pcflags, PC_INFORM))\n      set(self.pcflags, PC_INFORM);\n   if (\"$Re-Bob\" in self.quests)\n   {\n      dilcopy(\"rebob@rebirth\", self);\n      act(\"<div class=cpr>Please note that shortly after you reach level 50 you \" +\n          \"will automatically be put back into the book of blood.\\n\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n   }\n   self.minv := 0; /* Make them visible to mortals again */\n   act(\"$1n steps out of a portal and into the room.\",\n       A_SOMEONE, self, null, null, TO_REST);\n   exec(\"look\", self);\n   if (not(dilfind(\"morph_charge@rebirth\", self)))\n      dilcopy(\"morph_charge@rebirth\", self);\n   destroy(tempu);\n\n   self.hp := self.max_hp;\n   self.endurance := self.max_endurance;\n   self.mana := self.max_mana;\n\n   set(self.charflags, CHAR_PROTECTED);\n   self.crimes := 0;\n\n   position_update(self);\n\n  broad := \"<div class=cpr>The grounds tremors and lightning streaks across the \" +\n  \"heavens as the gods mark \" + self.name + \"'s rebirth.</div>\";\n\n  broad := textformat(broad);\n\n  pc := self;\n\n  while (pc.gprevious.type==UNIT_ST_PC)\n     pc := pc.gprevious;\n\n     while (pc.type==UNIT_ST_PC)\n      {\n     act(broad, A_ALWAYS, pc, null, null, TO_CHAR);\n      pc:=pc.gnext;\n      }\n\n   tempu := load(\"guild_medallion@guild_paths\");\n    tempu.height := self.height;\n   link(tempu, self);\n   tempu := load(\"torch@midgaard\");\n   link(tempu,self);\n   exec(\"wear medallion\", self);\n   exec(\"hold torch\", self);\n   exec(\"light torch\", self);\n   act(\"Don't forget to use your medallion to get around!\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n   quit;\n} dilend"
}