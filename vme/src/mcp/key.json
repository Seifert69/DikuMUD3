{
    "keyword": "key",
    "opcode": "DILSF_KEY",
    "yacc_rule": "| DILSF_KEY /* .key */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_SP;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_KEY;\n}",
    "dilfe_name": "DILF_KEY",
    "c_implementation": "case DILF_KEY:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *unit = reinterpret_cast<unit_data *>(v1->val.ptr);\n                    if (unit)\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_SPR;\n                        v->ref = unit->getKeyPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin quasimodo();\nexternal\n   integer walk_room@function (s:string,i:integer);\n   DailyRoutine@quests(sl : stringlist, arg2 : string);\n\nvar\ntf:integer;\n  u:unitptr;\n  i:integer;\n\ncode\n{\n   on_activation((self.position < POSITION_SLEEPING) or (self.position == POSITION_FIGHTING), skip);\n\n   /* Quasi shall react only on ticks (variable time)  */\n   wait(SFB_TICK | SFB_RANTIME, TRUE);\n\n   :start:\n   heartbeat := WAIT_SEC*15;\n   DailyRoutine@quests({\n      \"wake\",\n      \"::walkto::cth_sw_tower@midgaard\",\n      \"sigh\", \"sit\", \"yawn\", \"sleep\"}, \"\");\n\n   heartbeat := WAIT_SEC*SECS_PER_MUD_HOUR/2;\n   while ((mudhour != 4) and (mudhour != 16))\n   {\n      exec(\"snore\", self);\n      pause;\n   }\n   heartbeat := WAIT_SEC*15;\n\n   DailyRoutine@quests({\n      \"wake\",\n      \"::walkto::cth_altar@midgaard\",\n      \"sulk\"}, \"\");\n\n   u := findunit(self, \"bronze key\", FIND_UNIT_INVEN | FIND_UNIT_EQUIP, null);\n   if (u #= null)\n   {\n      DailyRoutine@quests({\n         \"cry\",\n         \"say swomeone stwole our kwey!\"}, \"\");\n      goto start;\n   }\n\n   DailyRoutine@quests({\n      \"unlock east door\",\n      \"open east door\",\n      \"east\",\n      \"close west door\",\n      \"lock west door\",\n      \"::walkto::cth_n_tower@midgaard\",\n      \"bounce\"}, \"\");\n\n   heartbeat := WAIT_SEC*SECS_PER_MUD_HOUR/2;\n   while ((mudhour != 6) and (mudhour != 18))\n     pause;\n   heartbeat := WAIT_SEC*15;\n\n   DailyRoutine@quests({\n      \"giggle\",\n      \"emote tries to ring the bells.\",\n      \"clap\",\n      \"::walkto::cth_n_stairs1@midgaard\",\n      \"sulk\",\n      \"unlock west door\",\n      \"open west door\",\n      \"west\",\n      \"close east door\",\n      \"lock east door\",\n      \"sniff\"}, \"\");\n\n   goto start;\n} dilend"
}