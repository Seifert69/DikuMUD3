= send_pre =
 function: integer '''send_pre'''(c : string, a : unitptr, m : unitptr, t : unitptr, p : integer, arg : string, o : unitptr);

The '''send_pre''' function sends preparation messages to DIL programs that are waiting for specific commands to start, with optional blocking capabilities.

== Description ==
The send_pre function sends an SFB_PRE message to DIL programs in the surrounding area that are waiting for a specific command to be executed. This function is commonly used to coordinate between multiple DIL programs, allowing one program to notify others that it's about to execute a command. The function can either allow sharing (SFR_SHARE) or block the command (SFR_BLOCK) if another program is already handling it.

== PARAMETERS ==
{| class="wikitable"
! Parameter !! Type !! Description
|-
| c || string || Command string that is being prepared for execution
|-
| a || unitptr || Activator unit that is preparing the command
|-
| m || unitptr || Medium unit through which the command is being processed
|-
| t || unitptr || Target unit of the command preparation
|-
| p || integer || Power/parameter value for the message
|-
| arg || string || Argument string passed with the command
|-
| o || unitptr || Other unit to also receive the message
|}

== Return Values ==
The function returns an integer indicating the result:
* SFR_SHARE - Command can be shared/allowed to proceed
* SFR_BLOCK - Command is blocked by another program

== Examples ==
=== Basic Command Preparation ===
 dilbegin prepare_cast(spell_name : string, target : unitptr);
 var
     result : integer;
 code
 {
     result := send_pre("cast", self, null, target, 1, spell_name, null, 0);
     
     if (result == SFR_BLOCK)
     {
         sendtext("Another spellcaster is already preparing that spell.&n", self);
         quit;
     }
     
     act("You begin preparing " + spell_name + " spell.", A_ALWAYS, self, target, null, TO_CHAR);
 }
 dilend

=== Command Blocking System ===
 dilbegin exclusive_command(command_name : string);
 var
     result : integer;
 code
 {
     result := send_pre(command_name, self, null, null, 1, argument, null, 0);
     
     if (result == SFR_BLOCK)
     {
         sendtext("The " + command_name + " command is already in use.&n", self);
         quit;
     }
     
     act("You gain exclusive access to " + command_name + " command.", A_ALWAYS, self, null, null, TO_CHAR);
 }
 dilend

=== Resource Management ===
 dilbegin use_resource(resource_type : string, amount : integer);
 var
     resource_manager : unitptr;
     result : integer;
 code
 {
     resource_manager := findunit(self, "resource_mgr", FIND_UNIT_SURRO, null);
     if (resource_manager == null)
         quit;
     
     result := send_pre("allocate", self, null, resource_manager, 1, resource_type, itoa(amount), 0);
     
     if (result == SFR_BLOCK)
     {
         sendtext("Resource allocation denied by manager.&n", self);
         quit;
     }
     
     act("You allocate " + itoa(amount) + " units of " + resource_type + ".", A_ALWAYS, self, null, null, TO_CHAR);
 }
 dilend

== Usage Notes ==
* The function sends SFB_PRE messages to waiting DIL programs
* Programs must be waiting with interrupt(SFB_PRE, ...) to receive these messages
* The command string 'c' identifies the command being prepared
* Parameter 'p' determines message priority and handling behavior
* Return value indicates whether command can proceed (SFR_SHARE) or is blocked (SFR_BLOCK)
* Commonly used for command coordination and resource management systems

== Return Value Meanings ==
; SFR_SHARE : Command preparation successful and can proceed
; SFR_BLOCK : Command is blocked by another program or system restriction

== Error Handling ==
* Function will fail if any required parameters are null or invalid
* Invalid command strings may cause unpredictable behavior
* Always check return value before proceeding with command execution
* Parameter validation occurs at runtime - invalid types cause execution errors

== Related Functions/Fields ==
* [[Manual:DIL_Manual/send_done|send_done]] - Function for sending completion messages
* [[Manual:DIL_Manual/interrupt|interrupt]] - Function to receive preparation messages
* [[Manual:DIL_Manual/exec|exec]] - Function for executing commands
* [[Manual:DIL_Manual/send|send]] - Function for sending messages to units
* [[Manual:DIL_Manual/wait|wait]] - Function for waiting with interrupt conditions

== See Also ==
* DIL program coordination and synchronization
* Command blocking and access control
* Message passing between DIL programs