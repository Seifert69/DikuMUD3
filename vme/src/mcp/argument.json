{
    "keyword": "argument",
    "opcode": "DILSE_ARGM",
    "yacc_rule": "| DILSE_ARGM\n{\n    INITEXP($$);\n    $$.dsl = DSL_DYN;\n    $$.typ = DilVarType_e::DILV_SP;\n    add_ubit8(&($$), DILE_ARGM);\n}",
    "dilfe_name": "dilfe_argm",
    "c_implementation": "void dilfe_argm(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* Argument */\n\n    v->type = DILV_SP;\n    v->atyp = DILA_NORM;\n    if (p->sarg->arg)\n    {\n        v->val.ptr = (char *)p->sarg->arg;\n    }\n    else\n    {\n        v->type = DILV_NULL;\n        v->val.ptr = nullptr;\n    }\n    p->stack.push(v);\n}",
    "dil_example": "dilbegin engrave();\nvar\n    pc     : unitptr;\n \tting   : unitptr;\n \tpris   : integer;\n \ti      : integer;\n \ttext   : string;\n \tblah   : extraptr;\n\tcash   : string;\n\tmaxlength : integer;\n\ttemplist : stringlist;\ncode\n{\n    heartbeat := PULSE_SEC*4;\n\n:start:\n    wait(SFB_DONE,command(\"give\")and(self == target));\n    if(not visible(self,medium))goto start;\n    if(not visible(self,activator))\n    {\n        exec(\"sigh\",self);\n        exec(\"say How can I deal with someone I can't see?\", self );\n        exec(\"drop\"+medium.name,self);\n        goto start;\n    }\n    pc := activator;\n    ting := medium;\n    secure(pc,nopc);\n    secure(ting,ingenting);\n    dilcopy(\"busy@function(Please wait; I am working right now.)\",self);\n\n    if((ting.type != UNIT_ST_OBJ)or(ting.objecttype == ITEM_LIGHT)\n        or(ting.objecttype == ITEM_SCROLL)or(ting.objecttype == ITEM_FOOD)\n        or(ting.objecttype == ITEM_BOOK)or(ting.objecttype == ITEM_SPELL)\n        or(MAT_CLOTH_STR in ting.extra)or(MAT_FIRE_STR in ting.extra)or\n        ((ting.objecttype == ITEM_ARMOR)and(ting.value[0]==0)))\n    {\n        exec(\"say Sorry, it is beyond my ability to engrave this.\",self);\n:giveback:\n        unsecure(ting);\n        link(ting, pc);\n        act(\"$3n gives $2n to $1n.\",A_SOMEONE,pc,ting,self,TO_REST);\n        act(\"$3n gives $2n to you.\",A_SOMEONE,pc,ting,self,TO_CHAR);\n        i:=dildestroy(\"busy@function\",self);\n        unsecure (pc);\n        goto start;\n    }\n\n    if(\"engraving\" in ting.extra)\n    {\n        exec(\"say Hmm... this item appears to be engraved already, \"+pc.name+\n        \".\",self);\n        goto giveback;\n    }\n\n    if(\"$no_engrave\" in ting.extra)\n    {\n        exec(\"emote examines \"+ting.title+\"carefully...\",self);\n        exec(\"say This item cannot be engraved. I am sorry, \"+pc.name+\n        \".\",self);\n        goto giveback;\n    }\n\n:brief:\n    exec(\"say What do you want engraved on this \"+ting.name+\", \"+pc.name+\"?\",self);\n    exec(\"say Just say the line, and remember, maximum 20 letters!\",self);\n\n:brieftext:\n    wait(SFB_DONE, command(\"say\")and(activator == pc));\n    text := argument;\n    maxlength := 20;\n    if(\"&amp;\" in text){ // These all exist to allow engraving to work for special characters without eating up the maximum length. Also increasing Max length of engravings to 20\n        templist := split(text,\"&amp;\");\n    \tmaxlength := maxlength + ((length(templist)-1)*4);\n    }\n    if(\"&quot;\" in text){\n        templist := split(text,\"&quot;\");\n    \tmaxlength := maxlength + ((length(templist)-1)*5);\n    }\n    if(\"&lt;\" in text){\n        templist := split(text,\"&lt;\");\n    \tmaxlength := maxlength + ((length(templist)-1)*3);\n    }\n    if(\"&gt;\" in text){\n        templist := split(text,\"&gt;\");\n    \tmaxlength := maxlength + ((length(templist)-1)*3);\n    }\n    if(length(text) > maxlength)\n    {\n        exec(\"say I am sorry, but this is too long!\",self);\n        exec(\"say Try another one, 20 letters maximum.\",self);\n        goto brieftext;\n    }\n\n    exec(\"say An engraving saying: '\"+text+\"', yes?\",self);\n\n    wait(SFB_DONE,(command(\"say\") or command(\"nod\") or command(\"shake\"))and(activator == pc));\n\n    if((command(\"say\")and((\" \" + argument)in \"no\")) or command(\"shake\"))\n    {\n        exec(\"say Oh, what is it then?\",self);\n        goto brieftext;\n    }\n\n    pause;\n    pris := (5*GOLD_MULT)+((ting.rent)*3);\n    cash := moneystring(pris,TRUE);\n    exec(\"say This engraving will cost you \"+cash+\".\",self);\n    if(not transfermoney(pc,self,pris))\n    {\n        exec(\"say ...which you don't have apparently.\",self);\n        exec(\"say Come back when you are richer, \"+pc.name+\".\",self);\n        goto giveback;\n    }\n\n    ting.title := ting.title+\" (engraved: '\" + text + \"')\";\n    blah := \"\" in ting.extra;\n    if(blah)\n    {\n        blah.descr := blah.descr + \"<br/>'\" + text + \"' is engraved on it.\";\n        addextra( ting.extra, {\"engraving\"}, \"It says '\" + text + \"'\" );\n    }\n    else\n    {\n        addextra(ting.extra,{\"dummy\"},\"You see nothing special.<br/>'\"+text+\n        \"' is engraved on it.\");\n        blah := \"dummy\" in ting.extra;\n        substring( blah.names, \"dummy\" );\n        /* There was no general description... make a new one :) */\n    }\n    pause;\n    exec(\"say There, hope you like it, \" + pc.name + \"!\", self);\n    destroy(self.inside);\n    goto giveback;\n\n\n:nopc:\n    exec(\"shrug \",self);\n    exec(\"drop \"+ting.name,self);\n    i:=dildestroy(\"busy@function\",self);\n    unsecure(pc);\n    unsecure(ting);\n    goto start;\n\n:ingenting:\n    exec(\"say Huh? Where did that ting go?\",self);\n    I:=dildestroy(\"busy@function\",self);\n    unsecure(ting);\n    unsecure(pc);\n    goto start;\n\n} dilend"
}