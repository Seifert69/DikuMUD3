{
    "keyword": "interrupt",
    "opcode": "DILSE_INTR",
    "yacc_rule": "corefunc : DILSE_INTR '(' coreexp ',' ihold ahold ahold coreexp ',' labelskip ')' \n    {\n        checkbool(\"argument 1 in 'interrupt'\", $3.boolean);\n        if ($3.typ != DilVarType_e::DILV_INT)\n        {\n            dilfatal(\"Arg 1 of 'interrupt' not number\");\n        }\n        else\n        {\n            $$.fst = $3.fst;\n            $$.lst = $10.lst;\n            /* Type is ok */\n            wtmp = &tmpl.core[$5];\n            bwrite_ubit8(&wtmp, DILE_INTR);\n            wtmp = &tmpl.core[$6];\n            bwrite_ubit32(&wtmp, $8.fst);\n            wtmp = &tmpl.core[$7];\n            bwrite_ubit32(&wtmp, $10.fst);\n            tmpl.intrcount++;\n            frm.intrcount++;\n        }\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_INT;\n    }",
    "dilfe_name": "dilfe_intr",
    "c_implementation": "void dilfe_intr(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* add interrupt to current frame */\n    ubit16 intnum = 0;\n    ubit8 *beg = nullptr;\n    ubit8 *end = nullptr;\n    ubit32 endptr = 0;\n    ubit32 begptr = 0;\n\n    dilval *v1 = p->stack.pop();\n\n    begptr = bread_ubit32(&(p->fp->pc));\n    endptr = bread_ubit32(&(p->fp->pc));\n    beg = &(p->fp->tmpl->core[begptr]);\n    end = &(p->fp->tmpl->core[endptr]);\n\n    intnum = dil_intr_insert(p, beg, end, v1->val.num);\n\n    // skip past the expression and label\n    p->fp->pc = &(p->fp->tmpl->core[endptr + 4]);\n\n    v->val.num = intnum;\n    v->type = DILV_INT;\n    v->atyp = DILA_NONE;\n\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin fnpri(FN_PRI_RESCUE-2) aware unique cuffed2(depname : string);\nvar\n   i      : integer;\n   u      : unitptr;\ncode\n{\n   interrupt(SFB_COM, activator == self, broken);\n\n   :loop:\n   wait(SFB_CMD, TRUE);\n\n   :postloop:\n   if (activator == self.master)\n   {\n      if (activator.position < POSITION_STANDING)\n        goto loop;\n\n      /* Do this trickery to allow the cuffed person to follow! */\n\n      if (command(\"north\") or command(\"east\") or command(\"south\") or\n          command(\"west\") or command(\"up\") or command(\"down\"))\n      {\n         wait(SFB_CMD, TRUE);\n         if (activator == self)\n         {\n            if (command(\"north\") or command(\"east\") or\n               command(\"south\") or command(\"west\") or\n               command(\"up\") or command(\"down\"))\n            {\n               goto loop;\n            }\n         }\n         goto postloop;\n      }\n      goto loop;\n   }\n   else if (activator == self)\n   {\n      if (command(\"look\") or command(\"say\") or\n          command(\"ask\") or command(\"tell\"))\n        goto loop;\n      else\n      {\n         block;\n         act(depname + \" prevents you from removing the hand cuffs.\",\n            A_ALWAYS, self, null, null, TO_CHAR);\n      }\n   }\n   goto loop;\n\n   :broken:\n   i := dildestroy(\"cuffed@midgaard\", self);\n   quit;\n} dilend"
}