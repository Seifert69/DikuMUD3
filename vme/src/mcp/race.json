{
    "keyword": "race",
    "opcode": "DILSF_RCE",
    "yacc_rule": "| DILSF_RCE /* .race */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_RCE;\n}",
    "dilfe_name": "DILF_RCE",
    "c_implementation": "case DILF_RCE:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *character = reinterpret_cast<char_data *>(v1->val.ptr);\n                    if (character && character->isChar())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_UINT2R;\n                        v->ref = character->getRacePtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin holy_water();\nexternal\n   integer IsInGuild@guilds(pc : unitptr, sGuild : string);\n   integer IsInGuilds@guilds(pc : unitptr, sGuilds : stringlist);\n\nvar\n mob : unitptr;\n n : integer;\n txt : string;\ncode\n{\n :start:\nwait(SFB_CMD,command(\"sprinkle\")and(activator==self.outside));\nblock;\ntxt:=argument;\nmob:=findunit(activator,txt,FIND_UNIT_SURRO,null);\n\nif (not(mob))\n{\nsendtext(\"Sprinkle who?<br/>\",self.outside);\ngoto start;\n}\n\nif ((mob.type == UNIT_ST_PC)and\n     (mob!=activator)and(visible(self.outside,mob)))\n{\nact(\"You open your vial and sprinkle holy water over $3n with a blessing.\",\nA_SOMEONE,self.outside,self,mob,TO_CHAR);\nact(\"$1n opens a vial and sprinkles holy water over $3n with a blessing.\",\nA_SOMEONE,self.outside,self,mob,TO_NOTVICT);\nact(\"$1n opens a vial and sprinkles holy water over you with a blessing.\",\nA_SOMEONE,self.outside,self,mob,TO_VICT);\nif (IsInGuilds@guilds(self.outside, {GUILD_UDG_CLERIC, GUILD_PALADIN}))\n{\nn:=cast_spell(SPL_BLESS,self.outside,self,mob,\"\");\n}\ndestroy(self);\n}\n\nif ((mob.type == UNIT_ST_PC)and(mob==activator))\n{\nact(\"You open your vial and sprinkle yourself with the holy water.\",\nA_SOMEONE,self.outside,self,mob,TO_CHAR);\nact(\"$1n opens a vial and sprinkles $1mself with holy water.\",\nA_SOMEONE,self.outside,self,mob,TO_REST);\nif (IsInGuilds@guilds(self.outside, {GUILD_UDG_CLERIC, GUILD_PALADIN}))\n{\nn:=cast_spell(SPL_BLESS,self.outside,self,self.outside,\"\");\n}\ndestroy(self);\n}\n\nif (mob.type==UNIT_ST_NPC)\n{\nact(\"You sprinkle $3n with holy water!\",\nA_SOMEONE,self.outside,self,mob,TO_CHAR);\nact(\"$1n sprinkles $3n with holy water!\",\nA_SOMEONE,self.outside,self,mob,TO_REST);\n\nif (((mob.race>5999)and(mob.race<6999)) or\n    ((mob.race>5019)and(mob.race<5030)) or\n    ((mob.race>5000)and(mob.race<5006)))\n{\nact(\"The water melts $3n like hot acid!\",\nA_SOMEONE,self.outside,self,mob,TO_ALL);\nn:=cast_spell(SPL_ACIDBALL_1,self.outside,self,mob,\"\");\nexec(\"kill \"+self.outside.name,mob);\n}\ndestroy(self);\n}\nsendtext(\"Sprinkle who? --TEST--<br/>\",self.outside);\ngoto start;\n} dilend"
}