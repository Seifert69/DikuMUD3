{
    "keyword": "sendtext",
    "opcode": "DILSI_SETE",
    "yacc_rule": "| DILSI_SETE '(' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'sendtext' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 2 of 'sendtext' not a unitptr\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_SETE);\n    }\n}",
    "dilfe_name": "dilfi_sete",
    "c_implementation": "void dilfi_sete(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"sendtext\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_SP, v2, TYPEFAIL_NULL, 1, DILV_UP))\n    {\n        if (v1->val.ptr && v2->val.ptr && ((unit_data *)v2->val.ptr)->isChar())\n        {\n            if (*((char *)v1->val.ptr) == MULTI_UNIQUE_CHAR && *((char *)v1->val.ptr + 1) == MULTI_PROMPT_CHAR)\n            {\n                if (CHAR_DESCRIPTOR((unit_data *)v2->val.ptr))\n                {\n                    protocol_send_text(CHAR_DESCRIPTOR((unit_data *)v2->val.ptr)->getMultiHookPtr(),\n                                       CHAR_DESCRIPTOR((unit_data *)v2->val.ptr)->getMultiHookID(),\n                                       (((const char *)v1->val.ptr) + 2),\n                                       MULTI_PROMPT_CHAR);\n                }\n            }\n            else\n            {\n                send_to_char((char *)v1->val.ptr, (unit_data *)v2->val.ptr);\n            }\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin look_signature();\nvar\n  pc:unitptr;\n  code\n  {\n  heartbeat:=PULSE_SEC*3;\n  :start:\n  wait (SFB_CMD,(\n  (command (\"look\")) and\n  ((\"signature\"==argument ) or (\"signatures\" == argument))\n  ));\n  block;\n  pc:=ghead();\nsendtext (\"The following book signers are on line.<br/><br/>\",activator);\n\n     while (pc.type==UNIT_ST_PC)\n      {\n      if (((isset (pc.pcflags,PC_PK_RELAXED)) or\n\t\t\t(dilfind (\"no_kill@function\",pc))) and\n      (pc.level<200) and\n      (visible (activator,pc)))\n     sendtext(pc.name+\" \"+pc.title+\"<br/>\",activator);\n      pc:=pc.gnext;\n      }\n\ngoto start;\n} dilend"
}