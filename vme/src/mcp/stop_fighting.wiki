= stop_fighting =
function: '''stop_fighting'''(ch : unitptr, vict : unitptr);

The '''stop_fighting''' function terminates combat between characters or stops all combat for a specific character.

== Description ==
This function is used to cancel combat engagements in the game. It can either stop combat between two specific characters or stop all combat for a particular character. The function removes the specified combat relationships and updates the combat state accordingly.

When called with a specific target (vict), it stops combat between the two characters. When called with null as the second parameter, it stops all combat engagements for the first character (ch). This function is commonly used in death sequences, area peace effects, teleportation, and other situations where combat should be terminated.

== Parameters ==
{| class="wikitable"
! Parameter !! Type !! Description
|-
| ch || unitptr || The character to stop fighting for
|-
| vict || unitptr || The specific opponent to stop fighting with, or null to stop all combat
|}

== Return Value ==
The function does not return a value.

== Examples ==
=== Stop All Combat ===
 dilbegin peace_room();
 var
   u : unitptr;
 code
 {
   // Stop all combat in the room
   foreach (u, self.inside)
   {
     if (u.type == UNIT_ST_PC or u.type == UNIT_ST_NPC)
     {
       stop_fighting(u, null);
       sendtext("Combat has been stopped.<br/>", u);
     }
   }
 }
 dilend

=== Stop Combat Between Two Characters ===
 dilbegin separate_fighters(attacker : unitptr, defender : unitptr);
 code
 {
   if (opponent(attacker, defender))
   {
     stop_fighting(attacker, defender);
     stop_fighting(defender, attacker);
     
     act("$1n and $2n stop fighting.", A_SOMEONE, attacker, defender, null, TO_ALL);
   }
 }
 dilend

=== Death Sequence ===
 dilbegin character_death();
 var
   corpse : unitptr;
 code
 {
   // Stop all combat for the dying character
   stop_fighting(self, null);
   
   // Set position to dead
   self.position := POSITION_DEAD;
   
   // Create corpse
   corpse := make_corpse("corpse@death");
   
   // Handle player vs NPC differences
   if (self.type == UNIT_ST_NPC)
     destroy(self);
   else
   {
     link(self, findroom("death_room@basis"));
     dilcopy("death_sequence@death", self);
   }
 }
 dilend

== Usage Notes ==
* The first parameter (ch) must be a character (PC or NPC)
* The second parameter (vict) can be a specific character or null to stop all combat
* When vict is null, all combat engagements for ch are terminated
* When vict is specified, only combat between ch and vict is stopped
* The function automatically handles both sides of the combat relationship
* Use [[Manual:DIL_Manual/opponent|opponent]]() to check if two characters are in combat
* The [[Manual:DIL_Manual/fighting|fighting]] field can be used to check current combat status
* Combat is automatically stopped when characters die or leave the area

== Error Handling ==
The function handles errors in the following ways:
* Null or invalid first parameter causes no action
* Non-character units are ignored
* Invalid second parameter (non-unitptr) causes compilation error
* No runtime errors are generated for valid character parameters

Always validate that parameters are valid characters before calling the function.

== Related Functions/Fields ==
* [[Manual:DIL_Manual/set_fighting|set_fighting]] - Start combat between two characters
* [[Manual:DIL_Manual/opponent|opponent]] - Check if two characters are in combat
* [[Manual:DIL_Manual/fighting|fighting]] - Field showing current combat target
* [[Manual:DIL_Manual/opponentcount|opponentcount]] - Field showing number of opponents
* [[Manual:DIL_Manual/position|position]] - Field for character position (useful for checking death)

== See Also ==
* DIL Combat System Documentation
* POSITION_* constants for character positions
* SFB_COM flag for combat message detection
* Combat-related DIL functions and fields