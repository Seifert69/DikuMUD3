{
    "keyword": "alignment",
    "opcode": "DILSF_ALG",
    "yacc_rule": "| DILSF_ALG /* .alignment */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_ALG;\n}",
    "dilfe_name": "DILF_ALG",
    "c_implementation": "case DILF_ALG:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *unit = reinterpret_cast<unit_data *>(v1->val.ptr);\n                    if (unit)\n                    {\n                        /* sbit16 capacity */\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_SINT2R;\n                        v->ref = unit->getAlignmentPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                }\n                break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin recall aware smoke_dil();\nvar\n u : unitptr;\n i : integer;\n txt : string;\ncode\n{\n :start:\ninterrupt(SFB_CMD,command(\"smoke\")and(activator==self.outside),smoking);\nwait(SFB_CMD,(self.value[1]==1)and(self.equip==WEAR_HOLD));\n :smokeloop:\nif ((self.value[1]==1)and(not(command(\"remove\"))))\n{\ni:=rnd(1,5);\nheartbeat:=PULSE_SEC*5;\npause;\nif (i==1)\n{\nsendtext(\"You inhale deeply the tobacco smoke.<br/>\",self.outside);\nact(\"$1n inhales deeply the tobacco smoke from $1s $2n with every sign \"+\n\"of enjoyment.\",A_HIDEINV,self.outside,self,null,TO_REST);\n}\nif (i==2)\n{\nsendtext(\"You blow smoke rings in the air.<br/>\",self.outside);\nact(\"$1n blows smoke rings in the air.\",\nA_SOMEONE,self.outside,self,null,TO_REST);\n}\nif (i==3)\n{\nsendtext(\"Puffing energetically on your \"+self.name+\", you blow a cloud of \"+\n\"smoke in the air.<br/>\", self.outside);\nact(\"Puffing energetically on $1s $2n, $1n blows a cloud of smoke.\",\nA_HIDEINV,self.outside,self,null,TO_REST);\n}\nif (i==4)\n{\nsendtext(\"You take another puff on your \"+self.name+\".<br/>\",self.outside);\nact(\"$1n takes another puff on $1s $2n.\",\nA_HIDEINV,self.outside,self,null,TO_REST);\n}\nif (i==5)\n{\nsendtext(\"You enjoy the smoke of your \"+self.name+\".<br/>\",self.outside);\nact(\"A cloud of tobacco smoke surrounds $1n.\",\nA_HIDEINV,self.outside,self,null,TO_REST);\n}\nheartbeat:=PULSE_SEC*20;\npause;\ngoto smokeloop;\n}\nelse goto start;\n\n :smoking:\n/* -------------------- Smoke Social ---------------------- */\nblock;\nif (self.value[1]==0)\n{\nsendtext(\"Light your \"+self.name+\" first, then smoke it!<br/>\",self.outside);\ngoto smokeloop;\n}\n\ntxt:=argument;\nif ((txt==self.outside.name)or(txt==self.name)or\n((txt==\"cigar\")and(\"cigar\" in self.name))or\n((txt==\"pipe\")and(\"pipe\" in self.name)))\ntxt:=\"\";\nif (txt==\"\")\n  {\n if (rnd(1,3)==1)\n {\n sendtext(\"You puff on your \"+self.name+\" and blow smoke into \"+\n \"the air.<br/>\",self.outside);\n act(\"$1n puffs on $1s $2N and blows smoke into the air.\",\n A_SOMEONE,self.outside,self,null,TO_REST);\n goto start;\n }\n if (rnd(1,2)==1)\n {\n sendtext(\"You inhale the aromatic smoke deeply.<br/>\",self.outside);\n act(\"$1n inhales deeply the smoke of $1s $2N.\",\n A_SOMEONE,self.outside,self,null,TO_REST);\n goto start;\n }\n if (rnd(1,2)==1)\n {\n sendtext(\"You blow smoke circles in the air.<br/>\",self.outside);\n act(\"$1n blows smoke circles in the air.\",\n A_SOMEONE,self.outside,self,null,TO_REST);\n goto start;\n }\n sendtext(\"You pulse on your \"+self.name+\".<br/>\",self.outside);\n act(\"$1n pulses on $1s $2n.\",\n A_SOMEONE,self.outside,self,null,TO_REST);\n goto start;\n  }\n if (txt!=\"\")\n {\n u:=findunit(self.outside,txt,FIND_UNIT_SURRO,null);\n        if ((u.type==UNIT_ST_PC)and(rnd(1,2)==1))\n         {\n         sendtext(\"You blow a cloud of smoke in the face of \"+u.name+\".<br/>\",\n         self.outside);\n         act(\"$1n blows a cloud of tobacco smoke in $3n's face.\",\n         A_SOMEONE,self.outside,self,u,TO_NOTVICT);\n         act(\"$1n blows a cloud of tobacco smoke in your face.\",\n         A_SOMEONE,self.outside,self,u,TO_VICT);\n         goto start;\n         }\n        if (u.type==UNIT_ST_PC)\n         {\n         sendtext(\"You blow a neat smoke ring right at \"+u.name+\"!<br/>\",\n         self.outside);\n         act(\"$1n blows a neat smoke ring right at $3n.\",\n         A_SOMEONE,self.outside,self,u,TO_NOTVICT);\n         act(\"$1n blows a ring of smoke right in your face.\",\n         A_SOMEONE,self.outside,self,u,TO_VICT);\n         goto start;\n         }\n  if (u.type==UNIT_ST_NPC)\n  {\n         sendtext(\"You blow a cloud of smoke at \"+u.title+\".<br/>\",\n         self.outside);\n         act(\"$1n blows a cloud of tobacco smoke at $3n.\",\n         A_SOMEONE,self.outside,self,u,TO_NOTVICT);\n         act(\"$1n blows a cloud of tobacco smoke in your face.\",\n         A_SOMEONE,self.outside,self,u,TO_VICT);\n   if (u.alignment<0)\n  {\n  exec(\"growl \"+self.outside.name,u);\n  }\n  goto start;\n  }\n sendtext(\"No-one here by this name.<br/>\",self.outside);\n }\ngoto start;\n} dilend"
}