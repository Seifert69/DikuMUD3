{
    "keyword": "loadcount",
    "opcode": "DILSF_LCN",
    "yacc_rule": "| DILSF_LCN\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_LCN;\n}",
    "dilfe_name": "DILF_LCN",
    "c_implementation": "case DILF_LCN:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if (v1->val.ptr)\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_INT;\n                        v->val.num =\n                            ((unit_data *)v1->val.ptr)->getFileIndex() ? ((unit_data *)v1->val.ptr)->getFileIndex()->getNumInMem() : 1;\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin gift_func(count:integer,i:integer);\nexternal\n  string gift_name (i:integer);\nvar\n item: unitptr;\n  namer:string;\n  place:unitptr;\n  gift:unitptr;\ncode\n{\n  namer:=gift_name(count);\n  gift:=load (namer+\"@\"+\"hallows23\");\n\nif ((gift.nameidx == \"tot_bag2\") and (gift.loadcount > 250))\n{\ndestroy(gift);\nreturn;\n}\nelse if ((gift.nameidx == \"tot_bag3\") and (gift.loadcount > 175))\n{\ndestroy(gift);\nreturn;\n}\nelse if ((gift.nameidx == \"tot_bag4\") and (gift.loadcount > 150))\n{\ndestroy(gift);\nreturn;\n}\n\n\n  log(\"loaded\"+namer+\"@\"+\"hallows23\");\n\n\n  :loop:\n  if (i==0)\n  place:=findrndunit (self,FIND_UNIT_WORLD,UNIT_ST_NPC);\n  else\n  place:=findrndunit (self,FIND_UNIT_WORLD,UNIT_ST_ROOM);\n\n  if ((place==null) or\n  (place==self)) goto loop;\n\nitem:=place;\n\nwhile (item.type!=UNIT_ST_ROOM)\n {\n if (item.type==UNIT_ST_PC)\n   goto loop;\n  item:=item.outside;\n  }\n\n  link (gift,place);\n  return ;\n  } dilend"
}