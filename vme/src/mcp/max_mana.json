{
    "keyword": "max_mana",
    "opcode": "DILSF_MMA",
    "yacc_rule": "| DILSF_MMA /* .max_mana */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_MMA;\n}",
    "dilfe_name": "DILF_MMA",
    "c_implementation": "case DILF_MMA:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if (v1->val.ptr && ((unit_data *)v1->val.ptr)->isChar())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_INT;\n                        v->val.num = mana_limit((unit_data *)v1->val.ptr);\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin recall unique fnpri(FN_PRI_DEATH) death_seq();\nvar\n    room:unitptr;\n    i : integer;\ncode\n{\n    priority; /* Disable any DILs below this */\n    heartbeat:=3;\n    self.hp  := self.max_hp;\n    heartbeat := PULSE_SEC * 3;\n    sendto(\"remove kill protection\",self);\n    dilcopy(\"no_kill@function\",self);\n\n    act(\"There is complete silence, you are floating in utter darkness.\",\n        A_ALWAYS, self, null, null, TO_CHAR);\n    pause;\n\n    act(\"Through the darkness you see a white light in the distance.\",\n        A_ALWAYS, self, null, null, TO_CHAR);\n    pause;\n\n    act(\"The light grows larger and more intense, it seems to resemble a \"+\n        \"warrior flying through the darkness.\",\n        A_ALWAYS, self, null, null, TO_CHAR);\n    pause;\n\n    act(\"The warrior takes your soul, and at that very instant you can see the\"+\n        \" world around you. You are in the arms of a beautiful Valkyrie, she \"+\n        \"begins to fly towards the stars.\",\n        A_ALWAYS, self, null, null, TO_CHAR);\n    pause;\n\n    act(\"The world is rapidly disappearing below you, as the Valkyrie rides \"+\n        \"towards the stars at an amazing speed.\",\n        A_ALWAYS, self, null, null, TO_CHAR);\n    pause;\n\n    if (self.quests.[\"New Player Helper\"] != null)\n    {\n        act(\"After a short ride she sets your spirit down inside thew Newbie Guide Respite room \"+ // fixed room name from a mispelling and renamed the room - see basis.zon\n        \"You slowly regain a more material form.\",\n            A_ALWAYS, self, null, null, TO_CHAR);\n        act(\"$1n enters the castle of Valhalla.\",\n            A_ALWAYS, self, null, null, TO_ROOM);\n        link(self, findroom(\"throne_room2@basis\"));\n    }\n    else if (self.alignment>249)\n    {\n        act(\"After a short ride she sets your spirit down inside Valhalla. You \"+\n            \"slowly regain a more material form.\",\n            A_ALWAYS, self, null, null, TO_CHAR);\n        act(\"$1n enters the castle of Valhalla.\",\n            A_ALWAYS, self, null, null, TO_ROOM);\n        link(self, findroom(\"heaven_entry@basis\"));\n    }\n    else if (self.alignment<-249)\n    {\n        act(\"After a short ride she throws you down into the pits of hell.  You \"+\n          \"slowly regain a more material form instantly feeling the heat.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n        act(\"$1n enters the pits of hell.\",\n          A_ALWAYS, self, null, null, TO_ROOM);\n        link(self, findroom(\"hell_entry@basis\"));\n    }\n    else\n    {\n        act(\"After a short ride she lets your spirit drift into the astral planes.\"+\n        \"You slowly regain your senses.\",\n            A_ALWAYS, self, null, null, TO_CHAR);\n        act(\"$1n floats into the astral planes.\",\n            A_ALWAYS, self, null, null, TO_ROOM);\n        link(self, findroom(\"entry1@basis\"));\n    }\n\n    i:=dildestroy(\"noaction@death\",self);\n    self.hp:=self.max_hp;\n    self.endurance:=self.max_endurance;\n    self.mana:=self.max_mana;\n    self.full:=24;\n    self.thirst:=24;\n\n    self.position := POSITION_RESTING;\n\n    if (self.level<=5)\n      heartbeat:=PULSE_SEC*45;\n    else if (self.level<25)\n      heartbeat:=PULSE_SEC*120;\n    else\n      heartbeat:=PULSE_SEC*180;\n\n    pause;\n    act(\"You feel strange.\", A_ALWAYS,self,null,null,TO_CHAR);\n    act(\"$1n shimmers and vanishes.\", A_ALWAYS,self,null,null,TO_REST);\n\n    unset(self.pcflags,PC_SPIRIT);\n    unset(self.charflags,CHAR_KILL_SELF);\n    room:=findroom(self.hometown);\n    if (room!=null)\n      link (self,findroom(self.hometown));\n    else\n      link (self,findroom(\"temple@udgaard\"));\n    dilcopy (\"piunwizinv@death()\",self);\n    exec(\"look\",self);\n    return;\n} dilend"
}