{
    "keyword": "subaff",
    "opcode": "DILSI_SUA",
    "yacc_rule": "| DILSI_SUA '(' coreexp ',' coreexp ')' ihold\n{\n    checkbool(\"argument 2 of subaff\", $5.boolean);\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'subaff' not a unit\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'subaff' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_SUA);\n    }\n}",
    "dilfe_name": "dilfi_sua",
    "c_implementation": "void dilfi_sua(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n    unit_affected_type *af = nullptr;\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"subaff\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, TYPEFAIL_NULL, 1, DILV_INT))\n    {\n        if (v1->val.ptr)\n        {\n            af = affected_by_spell((unit_data *)v1->val.ptr, v2->val.num);\n            if (af)\n            {\n                destroy_affect(af);\n            }\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin remove_aff();\nvar\n   i:integer;\ncode\n{\n   heartbeat:=3;\n   i:=0;\n   while (i<100)\n   {\n      if (isaff(self,i))\n      {\n         subaff(self,i);\n         continue;\n      }\n      i:=i+1;\n   }\n\n   while (dilfind(\"panic@spells\",self))\n      i:=dildestroy(\"panic@spells\",self);\n\n   while (dilfind(\"spl_poison@spells\",self))\n      i:=dildestroy(\"spl_poison@spells\",self);\n\n   while (dilfind(\"hammer@spells\",self))\n      i:=dildestroy(\"hammer@spells\",self);\n\n   while (dilfind(\"no_flee@spells\",self))\n      i:=dildestroy(\"no_flee@spells\",self);\n\n   while (dilfind(\"spl_madness@spells\",self))\n      i:=dildestroy(\"spl_madness@spells\",self);\n\n   while (dilfind(\"spl_sleep@spells\",self))\n      i:=dildestroy(\"spl_sleep@spells\",self);\n\n   return;\n} dilend"
}