{
    "keyword": "zone",
    "opcode": "DILSF_ZON",
    "yacc_rule": "| DILSF_ZON /* .zone */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_SP;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_ZON;\n}",
    "dilfe_name": "DILF_ZON",
    "c_implementation": "case DILF_ZON:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if (v1->val.ptr)\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_SP;\n                        v->val.ptr = unit_zone((unit_data *)v1->val.ptr)->getNamePtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin unitptr make_corpse(sCorpseLoad : string);\nexternal\n   unitptr findcrproom(u:unitptr);\n   die@justice(crp : unitptr);\nvar\n   rltime:integer;\n   corpseroom:unitptr;\n   crp:unitptr;\n   item:unitptr;\n   temp:unitptr;\n   exd : extraptr;\n\ncode\n{\n   heartbeat := PULSE_SEC;\n   \n   if (self.symname == \"familiar2@g_q\")\n   {\n     /* The while statement is to prevent people from destroying eq with a familiar*/\n\n\twhile(self.inside != null)\n\t\tlink(self.inside, self.outside);\n\t\n\t\tact(\"The familiar's magic unwinds and it fades from this plane of existance.\",\n\t\t\tA_ALWAYS,self,null,null,TO_ALL);\n      crp := null;\n      return (crp);\n   }\n\n   crp := load(sCorpseLoad); // e.g. \"corpse@death\", \"statue?\"\n\n   // Fix corpse's description\n   //\n\n   // corpse.name.[0] = \"corpse of $1n\"\n   // corpse.title = \"$1n's corpse\"\n   // corpse.descr = \"$1n's corpse is lying here.\"\n   crp.names.[0] := sact(crp.names.[0], A_RAW, self, crp, null, TO_CHAR);\n   crp.title := sact(crp.title, A_RAW, self, crp, null, TO_CHAR);\n   crp.outside_descr := sact(crp.outside_descr, A_RAW, self, crp, null, TO_CHAR);\n   exd := \"$rot\" in crp.extra;\n   if (exd)\n   {\n      exd.names.[1] := sact(exd.names.[1], A_RAW, self, crp, null, TO_CHAR);\n      exd.names.[2] := sact(exd.names.[2], A_RAW, self, crp, null, TO_CHAR);\n      exd.names.[3] := sact(exd.names.[3], A_RAW, self, crp, null, TO_CHAR);      \n   }\n\n   // Copy important values to corpse\n   //\n   set_weight_base(crp, self.baseweight);\n   set_weight(crp, self.baseweight);\n   crp.height:=self.height;\n  \n   if (self.type==UNIT_ST_NPC)\n   {\n      crp.value[2]:=0;\n      crp.value[3]:=self.level;\n   }\n   else\n   {\n      crp.value[2]:=1;\n      crp.value[3]:=self.vlevel;\n   }\n   crp.value[4] := self.race;\n   \n   addextra(crp.extra, {\"$living_sym\"}, self.symname);\n   if (isset(self.pcflags, PC_PK_RELAXED))\n      addextra(crp.extra, {\"$BOB\"}, \"\");\n\n   // Transfer victim's items to corpse\n   //\n   //   \n   item := self.inside;\n   while (item != null)\n   {\n      temp := item.next;\n      unequip(item);\n\n      // Items on players that are from the treasure zone or minv < 51 stay inside the player\n      if ((self.type != UNIT_ST_PC) or ((item.zoneidx != \"treasure\") and (item.minv < 51)))\n      {\n         link(item, crp);\n      }\n      else\n      {\n         item.minv := 200;  // Stays inside the PC\n      }\n      item := temp;\n   } \n\n\n   // Process justice when dead\n   //\n   die@justice(crp);\n\n\n   // Set up corpse decay and saving of items\n   //\n   rltime := realtime;\n   corpseroom := findcrproom(self);\n   addextra(crp.extra, {CORPSE_TIME}, itoa(rltime));\n\n   if (self.type==UNIT_ST_PC)\n   {\n      if (\"Soul Anchor Request Complete\" in self.quests)\n      {\n         addextra(crp.extra, {CORPSE_HOMETOWN}, self.hometown);\n      }\n      addextra(crp.extra, {CORPSE_EXTRA}, corpseroom.symname);\n\n      addextra(crp.extra, {CORPSE_FILE}, \"corpse_\"+self.name+\".\"+itoa(rltime));\n      store(crp, \"corpse_\"+self.name+\".\"+itoa(rltime), TRUE);\n      dilcopy(\"partial_get@death\", crp);\n   }\n\n   dilcopy(\"remove_corpse@death\", crp);\n\n   link(crp, corpseroom);\n\n   return (crp);\n} dilend"
}