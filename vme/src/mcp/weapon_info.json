{
    "keyword": "weapon_info",
    "opcode": "DILSE_WEPINFO",
    "yacc_rule": "| DILSE_WEPINFO '(' dilexp ')'\n{\n    INITEXP($$);\n    if ($3.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 1 of 'weapon_info' not integer\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_ILP;\n        make_code(&($3));\n        add_code(&($$), &($3));\n        add_ubit8(&($$), DILE_WEPINFO);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_wepinfo",
    "c_implementation": "void dilfe_wepinfo(dilprg *p)\n{\n    dilval *v = new dilval;\n    dilval *v1 = p->stack.pop();\n\n    v->type = DILV_ILP;\n\n    switch (dil_getval(v1))\n    {\n        case DILV_INT:\n            if (((int)v1->val.num >= 0) && ((int)v1->val.num < WPN_TREE_MAX))\n            {\n                cintlist *ilist = new cintlist;\n                ilist->Append(g_wpn_info[(int)v1->val.num].hands);\n                ilist->Append(g_wpn_info[(int)v1->val.num].speed);\n                ilist->Append(g_wpn_info[(int)v1->val.num].type);\n                ilist->Append(g_wpn_info[(int)v1->val.num].shield);\n                ilist->Append(g_WpnColl.tree[(int)v1->val.num].parent);\n                for (int idx2 = 0; idx2 < MAX_ARMOUR_TYPES; idx2++)\n                {\n                    ilist->Append(g_weapon_chart[(int)v1->val.num].element[idx2].offset);\n                    ilist->Append(g_weapon_chart[(int)v1->val.num].element[idx2].basedam);\n                    ilist->Append(g_weapon_chart[(int)v1->val.num].element[idx2].alpha);\n                }\n                v->val.ptr = ilist;\n            }\n            else\n            {\n                v->val.ptr = nullptr;\n                v->type = DILV_NULL;\n            }\n            break;\n        default:\n            v->type = DILV_ERR;\n            break;\n    }\n\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin integer two_handed(i : integer);\nvar\n   wpns : intlist;\ncode\n{\n   wpns := weapon_info(i);\n\n   if (wpns.[0] == 2)\n\t   return (TRUE);\n\n   return (FALSE);\n} dilend"
}