{
    "keyword": "crimes",
    "opcode": "DILSF_CRM",
    "yacc_rule": "| DILSF_CRM /* .crimes */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_CRM;\n}",
    "dilfe_name": "DILF_CRM",
    "c_implementation": "case DILF_CRM:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *pc = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (pc && pc->isPC())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_UINT2R;\n                        v->ref = pc->getNumberOfCrimesCommittedPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin deputy_join();\nvar\n  u : unitptr;\n\ncode\n{\n   :loop:\n   unsecure(u);\n   wait(SFB_CMD, command(\"join\"));\n\n   if (activator.type != UNIT_ST_PC)\n     goto loop;\n\n   u := activator;\n   secure(u, loop);\n\n   block;\n\n   if (POLICE_ACADEMY in u.quests)\n   {\n      exec(\"say You're already a deputy, \"+u.name+\", now stop bothering me \"+\n\t   \"and go catch some criminals.\", self);\n      goto loop;\n   }\n\n   if ((POLICE_BANNED in u.quests) or (u.crimes > 0) or\n       isset(u.charflags, CHAR_OUTLAW))\n   {\n      exec(\"say You have a criminal record, we can not accept you as a \"+\n\t   \"deputy \"+u.name+\".\",self);\n      goto loop;\n   }\n\n   exec(\"say We are glad to honour you as a deputy, \"+u.name+\".\", self);\n   pause;\n   exec(\"say Clearly we need a stronger law these days as the amount of \"+\n\t\"violence seems to increase every day.\", self);\n   pause;\n   exec(\"say A word of warning is needed, if you break any laws, your \"+\n\t\"jurisdiction will immediately be revoked, and all knowledge \"+\n\t\"taught to you will forever be gone.\", self);\n   pause;\n   exec(\"handshake \"+u.name, self);\n   addextra(u.quests, {POLICE_ACADEMY}, \"\");\n} dilend"
}