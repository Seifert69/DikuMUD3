{
    "keyword": "exptol",
    "opcode": "DILSF_EXPTOL",
    "yacc_rule": "| DILSF_EXPTOL /* .exptol */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_EXPTOL;\n}",
    "dilfe_name": "DILF_EXPTOL",
    "c_implementation": "case DILF_EXPTOL:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if (v1->val.ptr && ((unit_data *)v1->val.ptr)->isChar())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_INT;\n                        v->val.num = required_xp(PC_VIRTUAL_LEVEL((unit_data *)v1->val.ptr) + 1) - CHAR_EXP((unit_data *)v1->val.ptr);\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                    break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin gain_exp(u:unitptr, gain:integer);\nvar\n\tj:integer;\ncode\n{\n   heartbeat:=3;\n   if (u.type!=UNIT_ST_PC)\n      return;\n\n   if (gain > 0)\n   {\n      if (gain >= self.exptol)\n         sendtext(\"You can now raise a level by using the 'level' command!<br/>\",self);\n\n   \texperience (gain,self);\n\t}\n   else  /* gain <= 0 */\n\t{\n      // Dont lose XP until you're level 3\n      if (self.level >= 3)\n      {\n         // Ignore any loss leaing to less than 1650 XP\n         if ((self.exp+gain) > 1650)\n            experience(gain,self);\n      }\n   }\n   return;\n} dilend"
}