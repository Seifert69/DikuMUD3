{
    "keyword": "hometown",
    "opcode": "DILSF_HOME",
    "yacc_rule": "| DILSF_HOME /* .home */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_SP;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_HOME;\n}",
    "dilfe_name": "DILF_HOME",
    "c_implementation": "case DILF_HOME:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *pc = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (pc && pc->isPC())\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_SPR;\n                        v->ref = pc->getHometownPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin recall home();\nvar\n   hour : integer;\n   i : integer;\n\ncode\n{\n   hour := -24;\n\n   :start:\n   wait(SFB_CMD, (activator == self.outside) and command(\"home\"));\n   block;\n   if (self.outside.position == POSITION_FIGHTING)\n   {\n      act(\"The $2N does not work in combat.\",\n         A_ALWAYS, self.outside, self, null, TO_CHAR);\n      goto start;\n   }\n\n   if (self.equip == 0)\n   {\n      act(\"The $2N must be worn for it to work.\",\n         A_ALWAYS, self.outside, self, null, TO_CHAR);\n      goto start;\n   }\n\n   if (activator.level > 3)\n   {\n      act(\"As you attempt to use $2n it suddenly dissolves.\",\n         A_ALWAYS, self.outside, self, null, TO_CHAR);\n      act(\"$1n's $2n suddenly dissolves as $1e attempts to use it,\",\n         A_ALWAYS, self.outside, self, null, TO_REST);\n      destroy(self);\n   }\n   i := hour - (mudhour + mudday * MUD_DAY);\n   if (i < 0)\n     i := -i;\n   if (i < 6)\n   {\n      act(\"The $2N has not charged enough power yet.\",\n         A_ALWAYS, self.outside, self, null, TO_CHAR);\n      goto start;\n   }\n   hour := mudhour + mudday * MUD_DAY;\n   act(\"Your $2N glows and you feel transported to another place!\",\n        A_ALWAYS, self.outside, self, null, TO_CHAR);\n   act(\"The $2N on $1n's finger glows brightly as $1e vanishes in a \"+\n       \"flash of light!\", A_ALWAYS, self.outside, self, null, TO_REST);\n   link(self.outside, findroom(self.outside.hometown));\n   exec(\"look\", self.outside);\n   act(\"$1n appears in a flash of light!\",\n       A_ALWAYS, self.outside, self, null, TO_REST);\n   goto start;\n} dilend"
}