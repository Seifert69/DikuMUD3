{
    "keyword": "movement",
    "opcode": "DILSF_MOV",
    "yacc_rule": "| DILSF_MOV /* .movement */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_MOV;\n}",
    "dilfe_name": "DILF_MOV",
    "c_implementation": "case DILF_MOV:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *room = reinterpret_cast<room_data *>(v1->val.ptr);\n                    if (room && room->isRoom())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_UINT1R;\n                        v->ref = room->getLandscapeTerrainPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin jack_fight();\nvar\n        vict : unitptr;\n        fght : integer;\ncode\n{\n   :init:\n   heartbeat := PULSE_SEC * 7;\n   wait(SFB_COM,(self.position == POSITION_FIGHTING));\n   vict := self.fighting;\n   secure(vict,damnleft);\n\n   :start:\nfght := rnd(0,100);\npause;\n\nif (fght < 10)\n{\nact(\"$1n chokes you with $1s strings!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"$1n chokes $3n with $1s strings!\",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(1,2);\nposition_update(vict);\ngoto start;\n}\nif (fght < 20)\n{\nact(\"A quick slap from $1n's movement bar knocks you silly!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"A quick slap from $1n's movement bar knocks $3n silly!\",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(0,2);\nposition_update(vict);\ngoto start;\n}\nif (fght < 30)\n{\nact(\"$1n tries to charge you and trips over $1s's strings!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"$1n tries to charge $3n but trips over $1s's own strings!\",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(0,0);\nposition_update(vict);\ngoto start;\n}\nif (fght < 40)\n{\nact(\"$1n slices you with his razor!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"$1n slices $3n with his razor\",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(3,5);\nposition_update(vict);\ngoto start;\n}\nif (fght < 50)\n{\nact(\"$1n's jaw drops open and $1s takes a bite out of you!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"$1n's jaw opens and he bites $3n !\",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(0,1);\nposition_update(vict);\ngoto start;\n}\nif (fght < 60)\n{\nact(\"$1n gets all tangled up in $1s's own ropes!\",\nA_ALWAYS,self,null,vict,TO_ALL);\nact(\"$1n gets totally tangled in $1s's own ropes!\",\nA_ALWAYS,self,null,vict,TO_ALL);\nself.abilities[ABIL_DEX] := (self.abilities[ABIL_STR])-rnd(1,2);\nposition_update(self);\ngoto start;\n}\nif (fght < 70)\n{\nact(\"$1n kicks you with his wooden sabat!\",\nA_ALWAYS,self,null,vict,TO_VICT);\nact(\"$1n kicks $3n with his wooden sabat! \",\nA_ALWAYS,self,null,vict,TO_NOTVICT);\nvict.hp := vict.hp - rnd(0,5);\nposition_update(vict);\ngoto start;\n}\nelse goto start;\n\n        :damnleft:\nexec(\"emote cackles maniacally.\", self);\nunsecure(vict);\ngoto init;\n} dilend"
}