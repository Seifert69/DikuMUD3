{
    "keyword": "send_pre",
    "opcode": "DILSE_SENDPRE",
    "yacc_rule": "| DILSE_SENDPRE '(' dilexp ',' dilexp ',' dilexp ',' dilexp ',' dilexp ',' dilexp ',' dilexp ')'\n{\n    INITEXP($$);\n\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'send_pre' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_NULL && $5.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 2 of 'send_pre' not an unit pointer\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_NULL && $7.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 3 of 'send_pre' not an unit pointer\");\n    }\n    else if ($9.typ != DilVarType_e::DILV_NULL && $9.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 4 of 'send_pre' not an unit pointer\");\n    }\n    else if ($11.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 5 of 'send_pre' not an integer\");\n    }\n    else if ($13.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 6 of 'send_pre' not a string\");\n    }\n    else if ($15.typ != DilVarType_e::DILV_NULL && $15.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 7 of 'send_pre' not an unit pointer\");\n    }\n    else\n    {\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_INT;\n        make_code(&($3));\n        make_code(&($5));\n        make_code(&($7));\n        make_code(&($9));\n        make_code(&($11));\n        make_code(&($13));\n        make_code(&($15));\n        add_code(&($$), &($3));\n        add_code(&($$), &($5));\n        add_code(&($$), &($7));\n        add_code(&($$), &($9));\n        add_code(&($$), &($11));\n        add_code(&($$), &($13));\n        add_code(&($$), &($15));\n        add_ubit8(&($$), DILE_SENDPRE);\n    }\n    FREEEXP($3);\n    FREEEXP($5);\n    FREEEXP($7);\n    FREEEXP($9);\n    FREEEXP($13);\n    FREEEXP($15);\n}",
    "dilfe_name": "dilfe_sendpre",
    "c_implementation": "void dilfe_sendpre(dilprg *p)\n{\n    dilval *v = new dilval;\n    command_info *cmd = nullptr;\n    dilval *v7 = p->stack.pop();\n    dilval *v6 = p->stack.pop();\n    dilval *v5 = p->stack.pop();\n    dilval *v4 = p->stack.pop();\n    dilval *v3 = p->stack.pop();\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    v->type = DILV_INT;\n\n    switch (dil_getval(v1))\n    {\n        case DILV_SP:\n            switch (dil_getval(v2))\n            {\n                case DILV_UP:\n                case DILV_NULL:\n                    switch (dil_getval(v3))\n                    {\n                        case DILV_UP:\n                        case DILV_NULL:\n                            switch (dil_getval(v4))\n                            {\n                                case DILV_UP:\n                                case DILV_NULL:\n                                    switch (dil_getval(v5))\n                                    {\n                                        case DILV_INT:\n                                            switch (dil_getval(v6))\n                                            {\n                                                case DILV_SP:\n                                                    switch (dil_getval(v7))\n                                                    {\n                                                        case DILV_UP:\n                                                        case DILV_NULL:\n                                                            cmd = ((command_info *)search_trie((char *)v1->val.ptr, g_intr_trie));\n                                                            if (!cmd)\n                                                            {\n                                                                szonelog(p->sarg->owner->getFileIndex()->getZone(),\n                                                                         \"DIL %s, : Can not send_preprocess. No such command %s\\n\",\n                                                                         p->sarg->owner->getFileIndexSymName(),\n                                                                         (char *)v1->val.ptr);\n                                                                v->type = DILV_FAIL;\n                                                            }\n                                                            else\n                                                            {\n                                                                v->val.num = send_ack((unit_data *)v2->val.ptr,\n                                                                                      (unit_data *)v3->val.ptr,\n                                                                                      (unit_data *)v4->val.ptr,\n                                                                                      &(v5->val.num),\n                                                                                      cmd,\n                                                                                      (const char *)v6->val.ptr,\n                                                                                      (unit_data *)v7->val.ptr);\n                                                            }\n                                                            break;\n                                                        default:\n                                                            v->type = DILV_FAIL;\n                                                            break;\n                                                    }\n\n                                                    break;\n                                                default:\n                                                    v->type = DILV_FAIL;\n                                                    break;\n                                            }\n                                            break;\n                                        default:\n                                            v->type = DILV_FAIL;\n                                            break;\n                                    }\n\n                                    break;\n                                default:\n                                    v->type = DILV_FAIL;\n                                    break;\n                            }\n\n                            break;\n                        default:\n                            v->type = DILV_FAIL;\n                            break;\n                    }\n                    break;\n                default:\n                    v->type = DILV_FAIL;\n                    break;\n            }\n\n            break;\n        default:\n            v->type = DILV_FAIL;\n            break;\n    }\n    p->stack.push(v);\n    delete v1;\n    delete v2;\n    delete v3;\n    delete v4;\n    delete v5;\n    delete v6;\n    delete v7;\n}",
    "dil_example": "dilbegin climb_dil(arg : string);\nexternal\n   checkstand();\n   integer checkexit(arg : string, bMessage:integer);\n   string  dirstring@function(int123 : integer);\n   integer is_hidden(unit2 : unitptr, int1 : integer, unit23 : unitptr);\n   integer skillchecksa@skills(skillidx : integer, abiidx : integer, difficulty : integer);\n   string exitname@function(room:unitptr, dir:integer);\n   fall_dil(damage:integer);\n   look_blank@baselook(l1 : unitptr, str12 : string);\n\nvar\n   fall_to:string;\n   res:integer;\n   args:stringlist;\n   first_arg:string;\n   last_arg:string;\n   len_arg:integer;\n   in_vehicle:integer;\n   dir         :  integer;\n   send_dir         :string; \n   dir_name:string;\n   room:unitptr;\n   room_going:unitptr;\n   i:integer;\n   skilla:integer;\n   skillb:integer;\n   hm : integer; \n   difficulty:integer;\n   damage:integer;\n   amount:integer;\n   percent:integer;\n   exd : extraptr;\n   dmg : integer;\n   exit_name : string;\n   \ncode\n{\n   heartbeat := PULSE_SEC * 5;\n   checkstand();\n\n   if (self.endurance < 10)\n   {\n      act(\"You are too exhausted.\", A_ALWAYS, self, null, null, TO_CHAR);\n      return;\n   }\n\n   if (arg == \"\")\n   {\n      act(\"Climb what?\", A_ALWAYS, self, null, null, TO_CHAR);\n      return;\n   }\n\n   room := self.outside;\n   if (room.type != UNIT_ST_ROOM)\n   {\n      act(\"You can't climb while inside $2n.\", A_SOMEONE, self, room, null, TO_CHAR);\n      return;      \n   }\n\n   dir := checkexit(arg, 1);\n   dir_name := dirstring@function(dir);\n   exit_name := exitname@function(room, dir);\n\n   if (isset(room.exit_info[dir], EX_CLOSED))\n   {\n      act(\"The $2t seems to be closed.\", A_SOMEONE, self, exit_name, null, TO_CHAR);\n      return;\n   }\n\n   if (not isset(room.exit_info[dir], EX_CLIMB))\n   {\n      act(\"Doesn't seem like you have to climb the $2t, perhaps just try to move normally?\", A_SOMEONE, self, exit_name, null, TO_CHAR);\n      return;\n   }\n\n   /*\n   * test for success and fail including endurance loss\n   *\tincluding drunk code\n   */\t\n\n   room_going := room.exit_to[dir];\n   difficulty := room.exit_diff[dir];\n\n   if (self.drunk > 0)\n   {\n      difficulty := difficulty + 5 * self.drunk;\n      act(\"Climbing under influence isn't easy.\", A_SOMEONE, self, null, null, TO_CHAR);\n   }\n\n   hm := skillchecksa@skills(SKI_CLIMB, ABIL_DEX, difficulty);\n   dmg := 5; /* Default: 5 hits per 10 fail */\n\n   exd := room.extra.[\"$climb_\"+dir_name];\n   if (exd != null)\n   {\n      if (exd.vals != null)\n      {\n         dmg := exd.vals.[0];\n      }\n   }\n\n   self.endurance := self.endurance-6;\n\n   if (hm <= 0)\n   {\n      dmg := dmg * (-hm / 10);\n\n      act(\"You begin climbing the $2t but slip and fall.\",\tA_ALWAYS, self, exit_name, null, TO_CHAR);\n      act(\"$1n begins climbing the $2t but slips and falls.\", A_HIDEINV, self, exit_name, null, TO_ROOM);\n      dilcopy(\"fall_dil@basemove(\"+itoa(dmg)+\")\", self);\n      quit;\n   }\n\n   /* Issue the command() stuff so that all movers send the command \"north\" etc to the mud.\n   //                        sendtext(\"after endurance test<br/>\",self);\n   *   This is necessary for dils like the guard dil.\n   */\n\n   res := send_pre(dirstring@function(dir), self, null, null, 0, arg, null);\n   if (res != SFR_SHARE)\n      quit;\n\n   res := send_pre(\"climb\", self, null, null, 0, arg, null);\n   if (res != SFR_SHARE)\n      quit;\n\n   link(self, room_going);\n\n   act(\"$1n climbs in on the $2t.\", A_HIDEINV, self, arg , null, TO_ROOM);\n\n   look_blank@baselook(self, \":brief:\");   /* get the rooms contents.  The :brief: tells the look dil*/\n\n   send_done(\"climb\", self, null, null, 0, \"\", null, CMD_AUTO_NONE);\n   send_done(dirstring@function(dir), self, null, null, 0, \"\", null, CMD_AUTO_NONE);\n   quit;\n} dilend"
}