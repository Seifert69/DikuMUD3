{
    "keyword": "npcs",
    "opcode": "DILSF_NPCS",
    "yacc_rule": "| DILSF_NPCS /* .npcs */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_ZP;\n    $$.typ = DilVarType_e::DILV_UP;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_NPCS;\n}",
    "dilfe_name": "DILF_NPCS",
    "c_implementation": "case DILF_NPCS:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_ZP:\n                    if (v1->val.ptr)\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_UP;\n                        auto *z = (zone_type *)v1->val.ptr;\n\n                        v->val.ptr = z->findFirstNPC();\n                        if (v->val.ptr == nullptr)\n                        {\n                            v->type = DILV_FAIL;\n                        }\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin disarm_pc(); /*added by darg to trip pc by npcs for fun */\nvar\n    targ     : unitptr;\n    s        : string;\n    i        : integer;\ncode\n{\n  :start:\n    wait(SFB_COM,self.position==POSITION_FIGHTING);\n    heartbeat := PULSE_VIOLENCE;\n    if (self.fighting.type != UNIT_ST_PC)\n        goto start;\n\n    i := rnd(1, 200);\n    if (i <= self.abilities[ABIL_DEX])\n        goto start;\n  \n    targ := self.fighting;\n   \n    secure(targ,losttarg);\n    {\n        block;\n        if (targ==null)goto losttarg;\n            exec(\"disarm \"+targ.name,self);\n        unsecure(targ);\n\n        goto start;\n    }\n     goto start;\n\n    :losttarg:\n    unsecure(targ);\n    goto start;\n} dilend"
}