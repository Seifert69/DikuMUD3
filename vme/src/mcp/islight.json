{
    "keyword": "islight",
    "opcode": "DILSE_ISLT",
    "yacc_rule": "| DILSE_ISLT '(' dilexp ')'\n{\n    INITEXP($$);\n\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'islight' not a unitptr\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_INT;\n        make_code(&($3));\n        add_code(&($$), &($3));\n        add_ubit8(&($$), DILE_ISLT);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_islt",
    "c_implementation": "void dilfe_islt(dilprg *p)\n{\n    dilval *v = new dilval;\n    dilval *v1 = p->stack.pop();\n\n    v->type = DILV_INT;\n\n    switch (dil_getval(v1))\n    {\n        case DILV_FAIL:\n        case DILV_NULL:\n            v->type = DILV_FAIL;\n            break;\n        case DILV_UP:\n            if (!v1->val.ptr)\n            {\n                v->type = DILV_FAIL;\n            }\n            else\n            {\n                if (((unit_data *)v1->val.ptr)->isLight())\n                {\n                    v->val.num = 1;\n                }\n                else\n                {\n                    v->val.num = 0;\n                }\n            }\n            break;\n        default:\n            v->type = DILV_ERR;\n            break;\n    }\n\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin direc_dil(arg : string);\nexternal\n   integer is_hidden(u1 : unitptr, int1 : integer, u2 : unitptr);\n   integer issetclimb@function(direction:integer);\n   string  dirstring@function(i2 : integer);\n\nvar\n   room    :  unitptr;\n   buff    :  string;\n   dir     :  integer;\n   test    :  integer;\n   temp    :  string;\n\ncode{\n   if (not islight(self.outside))\n   {\n      act(\"It is pitch black.\", A_ALWAYS, self, null, null, TO_CHAR);\n      return;\n   }\n\n   room := self.outside;\n\n   if ((room.type != UNIT_ST_ROOM) and (isset(room.flags, UNIT_FL_TRANS)))\n      room := room.outside;\n\n   if (room.type != UNIT_ST_ROOM)\n   {\n      act(\"<div class='exit'>Obvious exits:<br/>None.<br/></div>\", A_ALWAYS, self, null, null, TO_CHAR);\n      return;\n   }\n\n   buff := \"\";\n   dir := NORTH;\n\n   while (dir <= MAX_EXIT)\n   {\n      if (room.exit_to[dir])\n      {\n         test := is_hidden(self, dir, room);\n\n         if (test)\n         {\n            dir := dir + 1;\n            continue;\n         }\n\n        temp := dirstring@function(dir);\n\n        buff := buff + \"<div class='exit'><a cmd='#'>\" + temp + \"</a> - \";\n        if (isset(room.exit_info[dir], EX_CLOSED))\n            buff := buff + \"Closed \" + room.exit_names[dir].[0] + \"<br/>\";\n        else\n            buff := buff + room.exit_to[dir].title + \"<br/>\";\n       }\n      dir := dir + 1;\n   }\n\n   if (buff == \"\")\n      buff := \"<div class='exit'>Obvious exits:<br/>None.</div>\";\n   else\n      buff := \"<div class='exit'>Obvious exits:<br/>\" + buff + \"</div>\";\n\n   sendtext(textformat(buff), self);\n   return;\n} dilend"
}