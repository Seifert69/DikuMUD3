{
    "keyword": "reboot",
    "opcode": "DILSI_REBOOT",
    "yacc_rule": "| DILSI_REBOOT '(' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 1 of 'reboot' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $5 + 1;\n        wtmp = &tmpl.core[$5];\n        bwrite_ubit8(&wtmp, DILI_REBOOT);\n    }\n\n    /*$$.fst = $2;\n    $$.lst = $2 + 1;\n    wtmp = &tmpl.core[$2];\n    bwrite_ubit8(&wtmp, DILI_REBOOT);*/\n}",
    "dilfe_name": "dilfi_reboot",
    "c_implementation": "void dilfi_reboot(dilprg *p)\n{\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"reboot\", p, 1, v1, TYPEFAIL_NULL, 1, DILV_INT))\n    {\n        dil_getval(v1);\n\n        if (p->frame[0].tmpl->zone->getAccessLevel() > 0)\n        {\n            szonelog(p->frame->tmpl->zone, \"DIL '%s' attempt to violate system access security (reboot).\", p->frame->tmpl->prgname);\n            p->waitcmd = WAITCMD_QUIT;\n        }\n        else\n        {\n            g_mud_shutdown = g_mud_reboot = 1;\n            g_mud_exitcode = v1->val.num; // The exit() code\n        }\n    }\n\n    delete v1;\n}",
    "dil_example": "dilbegin rebooting(s : string);\nexternal\n\tsend_to_world(s : string);\nvar\nj : integer;\nu : unitptr;\nstr : string;\ni : integer;\ncode\n{\ni := atoi(s);\nif (i == 0) goto go_now;\n\nif (i > 1) str := \"minutes\";\nelse str := \"minute\";\n\n\n/* Only tell the players it will reboot if it's under 20 */\n if (i < 20)\n send_to_world(\"The mud will reboot in \"+itoa(i)+\" \"+str+\".</br>\");\n\nheartbeat := PULSE_SEC * SECS_PER_REAL_MIN;\n\nwhile (i > 1)\n{\n wait(SFB_TICK, TRUE);\n\n if ((i == 10) or (i == 5))\n send_to_world(\"The mud will reboot in \"+itoa(i)+\" minutes.<br/>\");\n\n i := i - 1;\n}\n\n\nj := SECS_PER_REAL_MIN;\n\nheartbeat := PULSE_SEC;\n\nwhile (j > 0)\n{\n\n wait(SFB_TICK, TRUE);\n\n if (j == 30)\n send_to_world(\"The mud will reboot in 30 seconds.<br/>\");\n\n if (j == 10)\n send_to_world(\"The mud will reboot in 10 seconds.<br/>\");\n\n j := j - 1;\n}\n\n:go_now:\nsend_to_world(\"Rebooting...<br/>\");\nu:=pc_head();\nwhile (u.type==UNIT_ST_PC)\n{\nu:=u.gnext;\n}\nreboot(0);\nquit;\n} dilend"
}