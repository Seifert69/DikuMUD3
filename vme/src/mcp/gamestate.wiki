= gamestate =
 function: void '''gamestate'''({unit : unitptr, state : integer});

The '''gamestate''' function changes the game state of a player character.

== Description ==
The '''gamestate''' function changes the game state of a player character. This function is primarily used for managing player connections and menu navigation in VME 2.0. When used, it removes the character from normal gameplay and transitions them to a different state.

== PARAMETERS ==
{| class="wikitable"
! Parameter !! Type !! Description
|-
| unit || unitptr || The player character whose game state will be changed
|-
| state || integer || The new game state using GS_ defines from vme.h
|}

== Examples ==
 dilbegin quit_command();
 var
    err : integer;
    goodbye : string;
    
 code
 {
    if (self.position == POSITION_FIGHTING)
    {
       sendtext("Not while fighting!<br/>", self);
       quit;
    }
    
    foreach(UNIT_ST_PC, u)
    {
       if (u != self)
       {
          if (visible(u, self))
             sendtext(self.name + " has left the game.<br/>", u);
       }
    }
    
    if (self.level < 200)
    {
       err := loadstr("goodbye", goodbye);
       
       if (err > 0)
       {
          goodbye := textformat(goodbye);
          sendtext("<br/><br/>" + goodbye, self);
       }
       
       sendtext("Goodbye, friend.. Come back soon!<br/>", self);
       gamestate(self, GS_QUIT);
    }
    else
    {
       gamestate(self, GS_MENU);
    }
    quit;
 } dilend

 dilbegin immortal_menu();
 var
    choice : string;
    
 code
 {
    sendtext("Immortal Menu:<br/>", self);
    sendtext("1) Enter game<br/>", self);
    sendtext("0) Disconnect<br/>", self);
    sendtext("Choice: ", self);
    
    wait(SFB_CMD, TRUE);
    
    if (command("1"))
    {
       gamestate(self, GS_PLAY);
       exec("look", self);
    }
    else if (command("0"))
    {
       gamestate(self, GS_QUIT);
    }
    else
    {
       sendtext("Invalid choice.<br/>", self);
    }
    quit;
 } dilend

== Usage Notes ==
* This function only works on player characters (UNIT_ST_PC), not NPCs
* Using GS_QUIT will extract the unit from the game completely
* Using GS_MENU removes the player from normal gameplay and puts them in menu mode
* Using GS_LINK_DEAD closes the player's network descriptor
* Using GS_PLAY returns the player to normal gameplay
* Be aware that players could potentially use this function to hide if not properly secured
* This function is commonly used in login/logout sequences and immortal menu systems

The state parameter should use one of the following GS_ defines:
* GS_PLAY - Returns the player to normal gameplay mode
* GS_QUIT - Extracts the player from the game (disconnects them)
* GS_MENU - Transitions the player to menu mode (typically for immortal/admin menus)
* GS_LINK_DEAD - Closes the player's descriptor, making them link-dead

== Error Handling ==
* Function will fail if the unit parameter is not a player character
* Invalid state values may cause unexpected behavior

== Related Functions/Fields ==
* [[extract_unit]]
* [[descriptor_close]]

== See Also ==
* [[UNIT_ST_PC]]