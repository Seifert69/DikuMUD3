{
    "keyword": "acc_balance",
    "opcode": "DILSF_ABAL",
    "yacc_rule": "| DILSF_ABAL /* .acc_balance */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_ABAL;\n}",
    "dilfe_name": "DILF_ABAL",
    "c_implementation": "case DILF_ABAL:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL:\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *player = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (player && player->isPC())\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_INT;\n                        if (g_cServerConfig.isAccounting())\n                        {\n                            v->val.num = static_cast<int>(player->getPCAccountData().getAccountBalance());\n                        }\n                        else\n                        {\n                            v->val.num = 0;\n                        }\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                }\n                break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin restore_youth();\n   external\n      integer Rejuvenate(pc : unitptr, years : integer);\n\n   var\n      payer : unitptr;\n      drinker : unitptr;\n      s : string;\n      u : unitptr;\n      i : integer;\n      j : integer;\n      k : integer;\n      price : integer;\n      years : integer;\n      prevage : integer;\n      \n  code\n  {\n      interrupt(SFB_CMD, (command(\"drink\") and (argument in self.names) and (activator.type == UNIT_ST_PC)), drink);\n      heartbeat := 60 * PULSE_SEC;\n      j := 0;\n      \n      :start:\n      wait(SFB_TICK, TRUE);\n      j := j + 1;\n      if (j == 3)\n      {\n         subextra(self.extra, \"$interactions_1\");\n         addextra(self.extra, {\"$interactions_1\"}, \"\");\n      }\n      else if (j == 4)\n      {\n         subextra(self.extra, \"$interactions_2\");\n         addextra(self.extra, {\"$interactions_2\"}, \"\");        \n      }\n      if (j == 6)\n         j := 0;\n      goto start;\n      \n      \n      :drink:\n      block;\n      if (activator.level >= IMMORTAL_LEVEL)\n      {\n          sendtext(\"No need. You've already got everlasting life!<br/>\", activator);\n          goto start;\n      }\n      \n      price := atoi(self.extra.[\"$price_per_drink\"].descr);\n      years := atoi(self.extra.[\"$years_to_restore\"].descr);\n      \n      if ( (not(price)) or (not(years)) )\n      {\n        log(\"Missing extra on eternal spring. Make sure $price_per_drink and $years_to_restore extra exist on spring@youth.\");\n        act(\"You attempt to drink from the fountain and find that you just can't quite reach. Ask an immortal for help.\", A_SOMEONE, activator, self, null, TO_CHAR);\n        goto start;\n      }\n      /* if ( ((price) * 100) > activator.acc_balance)\n      {\n          act(\"Your will to drink from the $2N is strong but you realize you can't afford it.\", A_SOMEONE, activator, self, null, TO_CHAR);\n          goto start;\n      }*/\n\n      if (not ((activator.name in self.extra.[\"$interactions_1\"].names) or (activator.name in self.extra.[\"$interactions_2\"].names)))\n      {\n          addstring(self.extra.[\"$interactions_1\"].names, activator.name);\n          addstring(self.extra.[\"$interactions_2\"].names, activator.name);        \n          sendtext(\"<div class='cpr'>Drinking from the spring will make you younger by \" +  itoa(years) + \" mud years. If you are sure you want to continue, drink again.</div><br/>\", activator);\n          goto start;\n      }\n\n      prevage := activator.birth;\n      i := Rejuvenate(activator, years);\n\n      if (i == 0)\n      {    \n          act(\"You try to drink from the spring but find that it simply dissapears before it hits your lips.\", A_SOMEONE, activator,  self, null, TO_CHAR);\n          goto start;\n      }\n\n      drinker := activator;\n      substring(self.extra.[\"$interactions_1\"].names, drinker.name);\n      substring(self.extra.[\"$interactions_2\"].names, drinker.name);\n      act(\"You scoop a handful of water to your lips and sip, feeling renewed!\", A_ALWAYS, drinker, self, null, TO_CHAR);\n      act(\"$1n scoops a handful of water to $1s lips and instantly looks \" + itoa(years) + \" younger.\", A_SOMEONE, drinker, self, null, TO_REST);\n\n      log (self.name + \": \" + drinker.name + \" changed age to \" +  itoa((realtime - drinker.birth) / (SECS_PER_MUD_YEAR)));\n      \n      s := asctime(realtime);\n      s := s + \n      \" Drinker:\" + \n      drinker.name + \n      \" age from \" + \n      itoa((realtime - prevage) / (SECS_PER_MUD_YEAR)) + \n      \" to \" + \n      itoa((realtime-drinker.birth) / (SECS_PER_MUD_YEAR)) + \n      \" price: \" + \n      itoa(price) + \n      \" lifespan: \" + \n      itoa(drinker.lifespan) + \"<br/>\";\n      k := savestr(\"youth.log\", s, \"a\");\n      acc_modify(payer, -((price) * 100));\n      goto start;    \n  } dilend"
}