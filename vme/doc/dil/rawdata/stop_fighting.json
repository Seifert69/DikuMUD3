{
    "keyword": "stop_fighting",
    "opcode": "DILSI_STOPF",
    "yacc_rule": "| DILSI_STOPF '(' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'stop_fighting' not an unitptr\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_UP && $5.typ != DilVarType_e::DILV_NULL)\n    {\n        dilfatal(\"Arg 2 of 'stop_fighting' not an unitptr or null\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_STOPF);\n    }\n}",
    "dilfe_name": "dilfi_stopf",
    "c_implementation": "void dilfi_stopf(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"stop_fighting\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, TYPEFAIL_NULL, 2, DILV_UP, DILV_NULL))\n    {\n        if (v1->val.ptr && ((unit_data *)v1->val.ptr)->isChar())\n        {\n            if (v2->val.ptr && ((unit_data *)v2->val.ptr)->isChar())\n            {\n                stop_fighting((unit_data *)v1->val.ptr, (unit_data *)v2->val.ptr);\n            }\n            else\n            {\n                stop_fighting((unit_data *)v1->val.ptr, nullptr);\n            }\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin raw_kill();\nexternal\n   unitptr make_corpse(sCorpseLoad : string);\n   remove_aff();\n   death_cry();\n   rem_db_entry@justice(criminal : unitptr, extra_type : string, juris: string);\n   integer  valid_extra@justice(criminal : unitptr, extra_type : string, juris : string);\nvar\n   exd : extraptr;\n   u : unitptr;\ncode\n{\n   heartbeat:=3;\n\n   if (self.type==UNIT_ST_PC)\n   {\n      set(self.pcflags,PC_SPIRIT);\n      dilcopy(\"noaction@death\",self);\n      // No such room any more... dilcopy (\"death_bell@death(\"+self.name+\")\",findroom(\"moot_nowe@udgaard\")); \n\n      if (\"$TOTAL_DEATHS\" in self.extra)\n         self.extra.[\"$TOTAL_DEATHS\"].vals.[0]:=self.extra.[\"$TOTAL_DEATHS\"].vals.[0]+1;\n      else\n         addextra(self.extra,{\"$TOTAL_DEATHS\"},itoa(realtime),{1});\n   }\n\n   sendtext(\"You are dead. R.I.P.<br/>\",self);\n   death_cry();\n\n   exd := self.extra.[\"$petrify\"]; \n   if (exd)\n   {\n      u := make_corpse(\"corpse_statue@death\");\n      u.spells[SPL_PETRIFY] := atoi(exd.descr);\n      subextra(self.extra, \"$petrify\");\n   }\n   else\n      make_corpse(\"corpse@death\");\n\n   //Remove extras just Justice DB\n     rem_db_entry@justice(self,\"$reward\",\"all\");\n\n   stop_fighting(self, null);\n   self.position:=POSITION_DEAD;\n\n   if (self.type==UNIT_ST_NPC)\n      destroy(self);\n   else\n   {\n      remove_aff();\n      // self.weight:=self.baseweight;\n      link(self, findroom(\"deathseq_room@basis\"));\n      dilcopy(\"death_seq@death\", self);\n   }\n   return;\n} dilend"
}