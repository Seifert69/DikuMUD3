{
    "keyword": "set_weight_base",
    "opcode": "DILSI_SET_W_BASE",
    "yacc_rule": "| DILSI_SET_W_BASE '(' coreexp ',' coreexp ')' ihold\n{\n    checkbool(\"argument 2 of set_weight_base\", $5.boolean);\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'setweight' not an unitptr\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'setweight' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_SET_W_BASE);\n    }\n}",
    "dilfe_name": "dilfi_set_weight_base",
    "c_implementation": "void dilfi_set_weight_base(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"set_weight_base\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, FAIL_NULL, 1, DILV_INT))\n    {\n        auto *unit = reinterpret_cast<unit_data *>(v1->val.ptr);\n        if (unit)\n        {\n            int dif = v2->val.num - unit->getBaseWeight();\n\n            /* set new baseweight */\n            unit->setBaseWeight(v2->val.num);\n\n            /* update weight */\n            weight_change_unit(unit, dif);\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin putin_safe(prisoner : unitptr);\nvar\n   vr : unitptr;\n   u : unitptr;\n   nextu : unitptr;\n   safe : unitptr;\n   i : integer;\n\ncode\n{\n   vr := findsymbolic(\"void@basis\");\n   safe := load(\"safe@justice\");\n   link(safe, vr); // Place it in a room OK to mess up weight\n\n   i := 0;\n   u := prisoner.inside;\n\n   while (u)\n   {\n      nextu := u.next;\n\n      if (u.minv < 1)\n      {\n         link(u, safe);\n         i := i + 1;\n      }\n\n      u := nextu;\n   }\n\n   if (i < 1)\n   {\n      destroy(safe);\n   }\n   else\n   {\n      set_weight_base(safe, 0);\n      set_weight(safe, 0);\n      link(safe, prisoner);\n\n      if (safe == null)\n      {\n         act(\"$1n takes all $3n's possessions.\",\n            A_SOMEONE, self, null, prisoner, TO_NOTVICT);\n         act(\"$1n takes all your possessions.\",\n            A_SOMEONE, self, null, prisoner, TO_VICT);\n      }\n      else\n      {\n         act(\"$1n puts all $3n's possessions in the safe.\",\n            A_SOMEONE, self, safe, prisoner, TO_NOTVICT);\n         act(\"$1n puts all your possessions in the safe.\",\n            A_SOMEONE, self, safe, prisoner, TO_VICT);\n      }\n   }\n\n   return;\n} dilend"
}