{
    "keyword": "logcrime",
    "opcode": "DILSI_LCRI",
    "yacc_rule": "| DILSI_LCRI '(' coreexp ',' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'logcrime' not an unitptr\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 2 of 'logcrime' not an unitptr\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 3 of 'logcrime' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $9 + 1;\n        wtmp = &tmpl.core[$9];\n        bwrite_ubit8(&wtmp, DILI_LCRI);\n    }\n}",
    "dilfe_name": "dilfi_lcri",
    "c_implementation": "void dilfi_lcri(dilprg *p)\n{\n    dilval *v3 = p->stack.pop();\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"logcrime\", p, 3, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, TYPEFAIL_NULL, 1, DILV_UP, v3, TYPEFAIL_NULL, 1, DILV_INT))\n    {\n        if (v1->val.ptr && v2->val.ptr && ((unit_data *)v1->val.ptr)->isChar() && ((unit_data *)v2->val.ptr)->isChar())\n        {\n            log_crime((unit_data *)v1->val.ptr, (unit_data *)v2->val.ptr, v3->val.num);\n        }\n    }\n    delete v1;\n    delete v2;\n    delete v3;\n}",
    "dil_example": "dilbegin steal(arg : string);\nexternal\n    onefreehand();\n    bobcheck(victim : unitptr);\n    provoked_attack (victim : unitptr, ch : unitptr);\n    awareness_check(thief : unitptr, victim : unitptr, skill : integer, msg : string);\n    integer skillbattle2(skillidx : integer, abiidx1 : integer, abiidx2 : integer, opp : unitptr, oabiidx1 : integer, oabiidx2 : integer);\n\nvar\n   skilla  :  integer;\n   skillb  :  integer;\n   skillc  :  integer;\n   skilld  :  integer;\n   hm      :  integer;\n   vict    :  unitptr;\n   targ    :  unitptr;\n   t       :  string;\n   temp    : string;\n   ti      : integer;\n\ncode\n{\n   if ((self.type == UNIT_ST_PC) and (self.skills[SKI_STEAL] <= 0))\n   {\n      act(\"You must practice first.\", A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   onefreehand();\n\n   if (not (\" from \" in arg))\n   {\n      act(\"Steal what from who?\", A_SOMEONE, self, null, null,  TO_CHAR);\n      quit;\n   }\n\n   /* needed for multi word names */\n   t := getword(arg);\n   temp := getword(arg);\n   while (temp != \"from\")\n   {\n      t := (t + \" \" + temp);\n      temp := getword(arg);\n   }\n\n   vict := findunit(self, arg, FIND_UNIT_SURRO, null);\n   if ((vict == null) or not visible(self, vict))\n   {\n      act(\"No such person to steal from.\",  A_SOMEONE, self, null,  null, TO_CHAR);\n      quit;\n   }\n\n\n   if (vict == self)\n   {\n      act(\"But you already have it - no need to steal it from yourself.\", A_SOMEONE, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   if ((vict.type != UNIT_ST_PC) and (vict.type != UNIT_ST_NPC))\n   {\n      act(\"Why bother? Just get the darn thing!\", A_SOMEONE, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   bobcheck(vict);\n\n   targ := findunit(vict, t, FIND_UNIT_IN_ME, null);\n\n   if ((targ == null) or not visible(self, targ))\n   {\n      act(\"You can't find that on $3n.\", A_SOMEONE, self, targ, vict, TO_CHAR);\n      quit;\n   }\n\n   if (targ.objecttype == ITEM_MONEY)\n   {\n      act(\"That would take a different type of finesse, try pickpocket instead.\", A_SOMEONE, self, null, vict, TO_CHAR);\n      quit;\n   }\n\n   if (targ.equip != 0)  /* 0 = not equipped, value not in values.h */\n   {\n      act(\"You can only steal non-equiped items!\", A_SOMEONE, self, null, vict, TO_CHAR);\n      quit;\n   }\n\n   if (targ.zoneidx == \"treasure\")\n   {\n      act(\"A chill runs down your spine...someone or something is watching.\",\n         A_ALWAYS, self, null, null, TO_CHAR);\n      act(\"You change your mind about stealing that.\", A_ALWAYS, self,\n         null, null, TO_CHAR);\n      quit;\n   }\n\n   ti := can_carry(self,targ,1);\n\n   if (ti == 1)\n   {\n      act (\"You can't carry another thing.\", A_ALWAYS,self,null,null,TO_CHAR);\n      quit;\n   }\n\n    hm := skillbattle2(SKI_STEAL, ABIL_DEX, ABIL_BRA, vict, ABIL_BRA, ABIL_DEX);\n    if (isaff(self, ID_INVISIBILITY))\n        hm := hm + 50;\n\n   if (hm <= -25)\n   {\n      act(\"You are caught!\", A_SOMEONE, self, targ, vict, TO_CHAR);\n      if (isaff(self, ID_INVISIBILITY))\n      {\n         subaff(self, ID_INVISIBILITY);\n      }\n      act(\"You catch $1n trying to steal your $2n!\", A_SOMEONE, self, targ,\n          vict, TO_VICT);\n      act(\"You see $1n trying to steal something from $3n...$3e doesn't \" +\n          \"seem amused!\", A_SOMEONE, self, targ, vict, TO_NOTVICT);\n      provoked_attack(vict, self);\n      logcrime(self, vict, CRIME_STEALING);\n      quit;\n   }\n\n   if (hm <= 0)\n   {\n      act(\"You fail to steal $3n's $2n, but at least no one was watching!\",\n        A_SOMEONE, self, targ, vict, TO_CHAR);\n      quit;\n   }\n\n   if (hm < 25)\n   {\n      act(\"You steal $2n from $3n just as $3e turns toward you..You have \"+\n          \"been caught!\", A_SOMEONE, self, targ, vict, TO_CHAR);\n      if (isaff(self, ID_INVISIBILITY))\n      {\n          subaff(self, ID_INVISIBILITY);\n      }\n      act(\"Arrgh!  $1n just stole your $2n!\", A_SOMEONE, self, targ, vict, TO_VICT);\n      act(\"You see $1n steal something from $3n...$3e doesn't seem amused!\",\n          A_SOMEONE, self, targ, vict, TO_NOTVICT);\n      link(targ, self);\n      provoked_attack(vict, self);\n      logcrime(self, vict, CRIME_STEALING);\n      send_done(\"steal\",self,targ,vict,hm,arg,null, CMD_AUTO_NONE);\n      quit;\n   }\n\n   act(\"You stealthily steal $3n's $2n and quickly tuck it out of sight!\", A_SOMEONE, self, targ, vict, TO_CHAR);\n   link(targ, self);\n   awareness_check(self, vict, SKI_STEAL, \"You notice $2n stealing something from $3n\");\n   send_done(\"steal\",self,targ,vict,hm,arg,null, CMD_AUTO_NONE);\n   quit;\n} dilend"
}