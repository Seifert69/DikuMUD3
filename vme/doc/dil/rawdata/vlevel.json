{
    "keyword": "vlevel",
    "opcode": "DILSF_VLVL",
    "yacc_rule": "| DILSF_VLVL /* .vlevel */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_VLVL;\n}",
    "dilfe_name": "DILF_VLVL",
    "c_implementation": "case DILF_VLVL:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *pc = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (pc && pc->isPC())\n                    {\n                        v->atyp = DILA_NONE;\n                        if (p->frame[0].tmpl->zone->getAccessLevel() != 0)\n                        {\n                            v->type = DILV_INT;\n                            v->val.num = pc->getVirtualPlayerLevel();\n                        }\n                        else\n                        {\n                            v->type = DILV_UINT2R;\n                            v->ref = pc->getVirtualPlayerLevelPtr();\n                        }\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin clan_aggro(home:string);\nvar\n u : unitptr;\ncode\n{\n\theartbeat := PULSE_SEC*10;\n\n\t:start:\n\tforeach(UNIT_ST_PC,u)\n\t{\n\t\tif ((u == self) or (u.level > 200)) continue;\n\t\tif ((u.vlevel < 20) and (u.hometown != home))\n\t\t{\n\t\t\tact(\"$1n magically transfers $3n out of harms way....\",\n\t\t\t  A_ALWAYS, self, null, u, TO_NOTVICT);\n\t\t\tact(\"$1n magically transfers you out of harms way....\",\n\t\t\t  A_SOMEONE, self, null, u, TO_VICT);\n\t\t\tlink(u, findroom(\"temple@udgaard\"));\n\t\t\tu.hp:= 5;\n\t\t\tposition_update(u);\n\n\t\t\theartbeat := PULSE_SEC *4;\n\t\t\tgoto start;\n\t\t}\n\t\telse\n\t\t{\n\t\t\theartbeat := PULSE_SEC *15;\n\t\t\tif (self.position <= POSITION_SLEEPING) goto sleep;\n\t\t\tif ((u.type == UNIT_ST_PC) and (u.hometown != home))\n\t\t\tif (self.position != POSITION_FIGHTING)\n\t\t\t{\n\t\t\t\tact(\" $3n, you are not a member of this clan! Leave NOW!\",\n\t\t\t\tA_SOMEONE,self,null,u,TO_NOTVICT);\n\t\t\t\tact(\"$1n attacks $3n!\",A_SOMEONE,self,null,u,TO_NOTVICT);\n\t\t\t\tact(\"The $1n attacks you!\", A_SOMEONE,self,null,u,TO_VICT);\n\t\t\t\tset_fighting(self,u);\n\t\t\t}\n\t\t\tif (u.hp < 10)\n\t\t\t{\n\t\t\t\tact(\"$1n drives his spear through you killing you instantly.\",\n\t\t\t\tA_ALWAYS,self,null,u,TO_VICT);\n\t\t\t\tact(\"$1n drives his spear through $3n killing $3s instantly.\",\n\t\t\t\tA_ALWAYS,self,null,u,TO_NOTVICT);\n\t\t\t\tu.hp := -10;\n\t\t\t\tposition_update(u);\n\t\t\t}\n\t\t}\n\t}\n\tpause;\n\tgoto start;\n\n\t:sleep:\n\theartbeat:= 20;\n\tpause;\n\tself.position:= POSITION_STANDING;\n\texec(\"yawn\", self);\n\theartbeat:= 3;\n\tgoto start;\n} dilend"
}