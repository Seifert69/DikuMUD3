{
    "keyword": "addaff",
    "opcode": "DILSI_ADA",
    "yacc_rule": "| DILSI_ADA '(' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'addaff' not a unit\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'addaff' not an integer\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 3 of 'addaff' not an integer\");\n    }\n    else if ($9.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 4 of 'addaff' not an integer\");\n    }\n    else if ($11.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 5 of 'addaff' not an integer\");\n    }\n    else if ($13.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 6 of 'addaff' not an integer\");\n    }\n    else if ($15.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 7 of 'addaff' not an integer\");\n    }\n    else if ($17.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 8 of 'addaff' not an integer\");\n    }\n    else if ($19.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 9 of 'addaff' not an integer\");\n    }\n    else if ($21.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 10 of 'addaff' not an integer\");\n    }\n    else if ($23.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 11 of 'addaff' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $25 + 1;\n        wtmp = &tmpl.core[$25];\n        bwrite_ubit8(&wtmp, DILI_ADA);\n    }\n}",
    "dilfe_name": "dilfi_ada",
    "c_implementation": "void dilfi_ada(dilprg *p)\n{\n    dilval *v11 = p->stack.pop();\n    dilval *v10 = p->stack.pop();\n    dilval *v9 = p->stack.pop();\n    dilval *v8 = p->stack.pop();\n    dilval *v7 = p->stack.pop();\n    dilval *v6 = p->stack.pop();\n    dilval *v5 = p->stack.pop();\n    dilval *v4 = p->stack.pop();\n    dilval *v3 = p->stack.pop();\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"addaff\",\n                       p,\n                       11,\n                       v1,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_UP,\n                       v2,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v3,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v4,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v5,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v6,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v7,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v8,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v9,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v10,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v11,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT))\n    {\n        if (v1->val.ptr)\n        {\n            if (((unit_data *)v1->val.ptr)->isChar() || ((unit_data *)v1->val.ptr)->isRoom())\n            {\n                if (is_in(v2->val.num, 1, ID_TOP_IDX) && is_in(v8->val.num, TIF_NONE, TIF_MAX) && is_in(v9->val.num, TIF_NONE, TIF_MAX) &&\n                    is_in(v10->val.num, TIF_NONE, TIF_MAX) && is_in(v11->val.num, APF_NONE, APF_MAX))\n                {\n                    if (p->frame[0].tmpl->zone->getAccessLevel() != 0)\n                    {\n                        szonelog(p->frame->tmpl->zone,\n                                 \"DIL '%s' attempt to violate system access security (ada).\",\n                                 p->frame->tmpl->prgname);\n                        p->waitcmd = WAITCMD_QUIT;\n                    }\n                    else\n                    {\n                        unit_affected_type af;\n\n                        af.setID(v2->val.num);\n                        af.setDuration(v3->val.num);\n                        af.setBeat(v4->val.num);\n\n                        af.setDataAtIndex(0, v5->val.num);\n                        af.setDataAtIndex(1, v6->val.num);\n                        af.setDataAtIndex(2, v7->val.num);\n\n                        af.setFirstFI(v8->val.num);\n                        af.setTickFI(v9->val.num);\n                        af.setLastFI(v10->val.num);\n                        af.setApplyFI(v11->val.num);\n                        create_affect((unit_data *)v1->val.ptr, &af);\n                    }\n                }\n                else\n                {\n                    szonelog(p->frame->tmpl->zone,\n                             \"DIL '%s' addaffect parameters OOB (ada) v2=%d, v8=%d, v9=%d, v10=%d, v11=%d.\",\n                             p->frame->tmpl->prgname,\n                             v2->val.num,\n                             v8->val.num,\n                             v9->val.num,\n                             v10->val.num,\n                             v11->val.num);\n                }\n            }\n            else if (((unit_data *)v1->val.ptr)->isObj())\n            {\n                if ((is_in(-v2->val.num, 1, ID_TOP_IDX) || is_in(v2->val.num, 1, ID_TOP_IDX)) && is_in(v8->val.num, TIF_NONE, TIF_MAX) &&\n                    is_in(v9->val.num, TIF_NONE, TIF_MAX) && is_in(v10->val.num, TIF_NONE, TIF_MAX) &&\n                    is_in(v11->val.num, APF_NONE, APF_MAX))\n                {\n                    if (p->frame[0].tmpl->zone->getAccessLevel() != 0)\n                    {\n                        szonelog(p->frame->tmpl->zone,\n                                 \"DIL '%s' attempt to violate system access security (ada).\",\n                                 p->frame->tmpl->prgname);\n                        p->waitcmd = WAITCMD_QUIT;\n                    }\n                    else\n                    {\n                        // This is a transfer affect\n\n                        unit_affected_type af;\n\n                        af.setID(v2->val.num); // Negative for object transfers\n                        af.setDuration(v3->val.num);\n                        af.setBeat(v4->val.num);\n\n                        af.setDataAtIndex(0, v5->val.num);\n                        af.setDataAtIndex(1, v6->val.num);\n                        af.setDataAtIndex(2, v7->val.num);\n\n                        af.setFirstFI(v8->val.num);\n                        af.setTickFI(v9->val.num);\n                        af.setLastFI(v10->val.num);\n                        af.setApplyFI(v11->val.num);\n                        create_affect((unit_data *)v1->val.ptr, &af);\n                    }\n                }\n                else\n                {\n                    szonelog(p->frame->tmpl->zone,\n                             \"DIL '%s' addaffect parameters OOB (ada) v2=%d, v8=%d, v9=%d, v10=%d, v11=%d.\",\n                             p->frame->tmpl->prgname,\n                             v2->val.num,\n                             v8->val.num,\n                             v9->val.num,\n                             v10->val.num,\n                             v11->val.num);\n                }\n            }\n            else\n            {\n                szonelog(p->frame->tmpl->zone, \"DIL '%s' addaffect unit is neither char nor object (ada).\", p->frame->tmpl->prgname);\n            }\n        }\n        else\n        {\n            szonelog(p->frame->tmpl->zone, \"DIL '%s' addaffect, NULL unit pointer (ada).\", p->frame->tmpl->prgname);\n        }\n    }\n    delete v1;\n    delete v2;\n    delete v3;\n    delete v4;\n    delete v5;\n    delete v6;\n    delete v7;\n    delete v8;\n    delete v9;\n    delete v10;\n    delete v11;\n}",
    "dil_example": "dilbegin do_light(arg:string);\nvar\ntorch : unitptr;\ncode\n{\n\n   torch := findunit(self, arg, FIND_UNIT_HERE,null,UNIT_ST_OBJ);\n\n   if (torch == null)\n   {\n      sendtext(\"No such thing.<br/>\",self);\n      return;\n   }\n\n   if ((torch.type != UNIT_ST_OBJ) or (torch.objecttype != ITEM_LIGHT))\n   {\n      sendtext(\"You can't light that.<br/>\",self);\n      return;\n   }\n\n   if (isaff(torch, ID_LIGHT_EXTINGUISH))\n   {\n      sendtext(\"How silly, it is already lit.<br/>\",self);\n      return;\n   }\n\n   if (torch.value[0] <= 0) // Hours left\n   {\n      sendtext(\"It is used up, it wont ignite.<br/>\",self);\n      return;\n   }\n\n  \taddaff(torch, ID_LIGHT_EXTINGUISH, torch.value[0], SECS_PER_MUD_HOUR*WAIT_SEC,\n\t          torch.value[1], 0, 0, TIF_NONE, TIF_TORCH_TICK, TIF_NONE, APF_LIGHT_DARK);\n   act(\"You light $2n.\", A_SOMEONE, self, torch, null, TO_CHAR);\n   act(\"$1n lights $2n.\", A_SOMEONE, self, torch, null, TO_ROOM);\n   quit;\n} dilend"
}