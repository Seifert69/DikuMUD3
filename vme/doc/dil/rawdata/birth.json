{
    "keyword": "birth",
    "opcode": "DILSF_BIR",
    "yacc_rule": "| DILSF_BIR /* .birth */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_BIR;\n}",
    "dilfe_name": "DILF_BIR",
    "c_implementation": "case DILF_BIR:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *player = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (player && player->isPC())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_UINT4R;\n                        v->ref = player->getPCTimeInformation().getPlayerBirthdayPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin info_changer(); /* Change your maiden name and email */\n\nvar\n   mail_expd  : extraptr;\n   mail_list  : stringlist;\n   new_list   : stringlist;\n   my_name    : string;\n   my_email   : string;\n   temp_str   : string;\n   temp_str2  : string;\n   public     : integer;\n\n   expd       : extraptr;\n   pc         : unitptr;\n   mail_obj   : unitptr;\n   maiden_str : string;\n   email_str  : string;\n   creat      : string;\n\ncode\n{\n:init:\n   heartbeat := PULSE_SEC*2;\n   mail_obj := self.inside;\n   if ((mail_obj == null) or (mail_obj.nameidx != \"mail_list_obj\"))\n   {\n      mail_obj:= restore(self.zoneidx+\".mail_list_obj\",null);\n      if (mail_obj == null)\n         mail_obj:=load(\"mail_list_obj@udgaard\");\n   }\n\n:start:\n   wait(SFB_CMD, (activator.type == UNIT_ST_PC) and (command(\"see\") or\n                  command(\"mail\") or command(\"maiden\") or command(\"public\")\n                  or command(\"show\") or command(\"update\") or\n                  command(\"add\") or command(\"remove\")));\n\n   pc := activator;\n   secure(pc, lost_pc);\n\n   if (command(\"see\")) goto show_file;\n   if (command(\"mail\")) goto change_mail;\n   if (command(\"maiden\")) goto change_maiden;\n   if (command(\"public\")) goto public_set;\n   if (command(\"show\")) goto show_info;\n   if (command(\"update\")) goto new_entry;\n   if (command(\"add\")) goto god_add;\n   if (command(\"remove\")) goto god_remove;\n   goto lost_pc;\n\n:god_add:\n   block;\n   if (pc.level < 253)\n   {\n      act(\"Only Administrators can modify the list. Sorry.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n\n   temp_str := argument;\n\n   my_name := getword(temp_str);\n   my_email := getword(temp_str);\n   temp_str2 := getword(temp_str);\n\n   if ((my_name == \"\") or (my_email == \"\") or (temp_str2 == \"\"))\n   {\n      act(\"You must fill in 3 parameters: name email public, \" +\n          \"where email is the player's address and public is 1 \" +\n          \"or 0 (0 meaning private).\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n   expd := (\"$\" + my_name) in self.inside.extra;\n   if (expd)\n   {\n      act(my_name + \" already has an entry.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n\n   addstring(new_list, \"$\" + my_name);\n   addstring(new_list, my_name);\n   addstring(new_list, my_email);\n   addstring(new_list, temp_str2);\n\n   subextra(self.inside.extra, \"$\" + my_name);\n   addextra(self.inside.extra, new_list, \"\");\n\n   act(my_name + \" added with email address \" + my_email + \".\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n\n   new_list := null;\n\n   store(self.inside,\"udgaard.mail_list_obj\",TRUE);\n\n   goto lost_pc;\n\n:god_remove:\n   if (pc.level < 253) goto start;\n\n   if (cmdstr != \"remove\") goto start;\n\n   block;\n\n   temp_str := argument;\n\n   my_name := getword(temp_str);\n\n   if (my_name == \"\")\n   {\n      act(\"You must supply the name of a player.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n   expd := (\"$\" + my_name) in self.inside.extra;\n   if (not(expd))\n   {\n      act(my_name + \" does not have an entry.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n\n   temp_str2 := \"$\" + my_name;\n   subextra(self.inside.extra, temp_str2);\n\n   act(my_name + \"'s entry has been removed.\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n\n   store(self.inside,\"udgaard.mail_list_obj\",TRUE);\n\n   goto lost_pc;\n\n:new_entry:\n   block;\n   expd := \"$email\" in pc.info;\n   if ((not expd) or (expd.descr == \"\") or (not(\"@\" in expd.descr)))\n   {\n      act(\"Kurt says 'You have not set an email address. Please do so \" +\n          \"with the mail command'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n      goto lost_pc;\n   }\n   email_str := expd.descr;\n\n   temp_str := pc.name + \" \" + email_str;\n   mail_obj := self.inside;\n   if (mail_obj == null)\n   {\n      act(\"There was an error in adding you to the email list.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      log(\"No List object found for email list in Kurt. Restarting.\");\n      goto init;\n   }\n   temp_str2 := temp_str;\n   my_name := getword(temp_str);\n   my_email := temp_str;\n   mail_expd :=( \"$\" + my_name) in self.inside.extra;\n   if (mail_expd == null)\n   {\n      public := 0;\n      addstring(new_list, \"$\" + my_name);\n      addstring(new_list, my_name);\n      addstring(new_list, my_email);\n      addstring(new_list, itoa(public));\n      addextra(self.inside.extra, new_list, \"\");\n   }\n   else\n   {\n      mail_list := mail_expd.names;\n      my_name := mail_list.[1];\n      my_email := mail_list.[2];\n      public := atoi(mail_list.[3]);\n\n      substring(mail_list, itoa(public));\n      substring(mail_list, my_email);\n      my_email := getword(temp_str2);\n      my_email := temp_str2;\n      addstring(mail_list, my_email);\n      addstring(mail_list, itoa(public));\n      subextra(self.inside.extra, \"$\" + my_name);\n      addextra(self.inside.extra, mail_list, \"\");\n   }\n\n   act(\"Kurt says 'Your email address has been updated on the email \" +\n       \"listing to match your file information'\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n   act(\"Kurt checks his files.\",\n        A_HIDEINV, pc, null, null, TO_REST);\n\n   new_list := null;\n\n   store(self.inside,\"udgaard.mail_list_obj\",TRUE);\n\n   goto lost_pc;\n\n:show_info:\n   block;\n   mail_obj := self.inside;\n   if (mail_obj == null)\n   {\n      act(\"There was an error. Please try again.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      log(\"No List object found for email list in Kurt. Restarting.\");\n      goto init;\n   }\n   temp_str2 := \"$\" + argument;\n   mail_expd := temp_str2 in self.inside.extra;\n   if (mail_expd == null)\n   {\n      act(\"Kurt says 'That person does not have a listing'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n   mail_list := mail_expd.names;\n   my_name := mail_list.[1];\n   my_email := mail_list.[2];\n   public := atoi(mail_list.[3]);\n   if ((public == 0) and (pc.level < 240))\n   {\n      act(\"Kurt says '\" + my_name + \" has chosen not to have a \" +\n          \"publicly available email - Sorry'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n   }\n   else\n   {\n      act(\"Kurt says '\" + my_name + \"'s email address is \" +\n          \"\" + my_email + \"'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n   }\n   goto lost_pc;\n\n:public_set:\n   block;\n   mail_obj := self.inside;\n   if (mail_obj == null)\n   {\n      act(\"There was an error. Please try again.\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      log(\"No List object found for email list in Kurt. Restarting.\");\n      goto init;\n   }\n   temp_str2 := \"$\" + pc.name;\n   mail_expd := temp_str2 in self.inside.extra;\n   if (mail_expd == null)\n   {\n      act(\"Kurt says 'You do not have an entry on the email list. \" +\n          \"Please set an email using the mail command'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n      goto lost_pc;\n   }\n   mail_list := mail_expd.names;\n   my_name := mail_list.[1];\n   my_email := mail_list.[2];\n   public := atoi(mail_list.[3]);\n   if (public == 0)\n   {\n      substring(mail_list, itoa(0));\n      public := 1;\n      act(\"Kurt says 'Your email address is now available to anyone \" +\n          \"who wants to see it'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n   }\n   else\n   {\n      substring(mail_list, itoa(1));\n      public := 0;\n      act(\"Kurt says 'Your email address is no longer visible to others'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n   }\n\n   addstring(mail_list, itoa(public));\n   subextra(self.inside.extra, pc.name);\n   addextra(self.inside.extra, mail_list, \"\");\n   store(self.inside,\"udgaard.mail_list_obj\",TRUE);\n   goto lost_pc;\n\n:show_file:\n   block;\n   expd := \"$maiden\" in pc.info;\n   if ((not expd) or (expd.descr == \"\"))\n      maiden_str := \"You have no Maiden name set for your character. It \"\n+\n                \"would be a good idea to set one in case you lose your \" +\n                \"password - e.g. 'maiden Mommy'.\";\n   else\n      maiden_str := \"Your character's maiden name is set to \" +\n                expd.descr + \".\";\n\n   expd := \"$email\" in pc.info;\n   if ((not expd) or (expd.descr == \"\"))\n   {\n      email_str := \"You do not have an email address set for your \" +\n               \"character. It would be a good idea to set one - \" +\n               \"e.g. 'email your@email.address' .\";\n   }\n   else\n   {\n      email_str := \"Your email address is set to \" + expd.descr +\n\".\";   }\n/*\n   creat := asctime(pc.birth);\n   creat := \"Your character was created \" + creat + \".\";\n*/\n   mail_expd := (\"$\" + pc.name) in self.inside.extra;\n   if (not(mail_expd))\n   {\n      email_str := email_str + \"<br/>You do not have an entry on the \" +\n                               \"email list - please type \" +\n                               \"'update'.\";\n   }\n   else\n   {\n   public := atoi(mail_expd.names.[3]);\n   if (public == 0)\n   {\n      email_str := email_str + \"<br/>Your email address is private.\";\n   }\n   else email_str := email_str + \"<br/>Your email address is public.\";\n   }\n\n   act(self.name + \" says 'Here is your file information, \" + pc.name +\n\"'<br/>\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n   act(\"Your name is \" + pc.name + \" \" + pc.title + \".<br/>You are \" +\n       \"currently level \" + itoa(pc.level) +  \".<br/>\" +\n       maiden_str + \"<br/>\" +\n       email_str + \"<br/><br/>You can change your maiden \" +\n       \"name and email address. Don't forget to add your email to \" +\n       \"our player email list by typing update (if you \" +\n       \"haven't done so already, or have changed your address) - \" +\n       \"'look sign' for info.\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n\n   email_str := \"\";\n\n   goto lost_pc;\n\n:change_maiden:\n   block;\n   maiden_str := argument;\n   if (maiden_str == \"\")\n   {\n      act(self.name + \" says 'You can't have a blank Maiden Name, \" +\n          pc.name + \"'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n   subextra(pc.info, \"$maiden\");\n   addextra(pc.info, {\"$maiden\"}, maiden_str);\n   act(self.name + \" says 'Your maiden name has been changed'\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n   act(\"Kurt checks his files.\",\n       A_HIDEINV, pc, null, null, TO_REST);\n   goto show_file;\n\n   goto lost_pc;\n\n:change_mail:\n   block;\n   email_str := argument;\n   if ((email_str == \"\") or (not(\"@\" in email_str)))\n   {\n      act(self.name + \" says 'That is not a valid email address, \" +\n          pc.name + \"'\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\n      goto lost_pc;\n   }\n   subextra(pc.info, \"$email\");\n   addextra(pc.info, {\"$email\"}, email_str);\n   act(self.name + \" says 'Your email address has been changed. You \" +\n       \"may wish to put your address on the email list. If so, \" +\n       \"type update'<br/>\",\n       A_ALWAYS, pc, null, null, TO_CHAR);\n      act(\"Kurt checks his files.\",\n          A_HIDEINV, pc, null, null, TO_REST);\n\n   goto show_file;\n\n   goto lost_pc;\n\n:lost_pc:\n   unsecure(pc);\n   goto start;\n} dilend"
}