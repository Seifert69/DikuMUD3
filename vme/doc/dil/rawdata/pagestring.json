{
    "keyword": "pagestring",
    "opcode": "DILSI_PGSTR",
    "yacc_rule": "| DILSI_PGSTR '(' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'pagestring' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 2 of 'pagestring' not a unitptr\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_PGSTR);\n    }\n}",
    "dilfe_name": "dilfi_pgstr",
    "c_implementation": "void dilfi_pgstr(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"pagestring\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_SP, v2, TYPEFAIL_NULL, 1, DILV_UP))\n    {\n        if (!((unit_data *)v2->val.ptr)->isPC() && !((unit_data *)v2->val.ptr)->isNPC())\n        {\n            dil_typeerr(p, \"not a pc/npc unit\");\n        }\n        else if (v1->val.ptr && v2->val.ptr)\n        {\n            page_string(CHAR_DESCRIPTOR((unit_data *)v2->val.ptr), (char *)v1->val.ptr);\n        }\n    }\n    delete v2;\n    delete v1;\n}",
    "dil_example": "dilbegin cinfo (arg:string);\nvar\n\tln:integer;\n\tcount:integer;\n\tbuf:string;\n\tpc:unitptr;\n    mlist:stringlist;\n\tline:stringlist;\n\tlist:stringlist;\n\tpos:stringlist;\n\tps:string;\n\ti:integer;\n\terr:integer;\n\trlist:stringlist;\ncode\n{\n\tif (self.extra.[CLAN_SYMBOLIC]==null)\n\t{\n\t\tact (\"<div class='clan'>You are not a member of a clan.</div>\",\n\t\tA_ALWAYS,self,null,null,TO_CHAR);\n\t\tquit;\n\t}\n\tpc:=ghead();\n\twhile (pc.type==UNIT_ST_PC)\n\t{\n\t\tif ((pc.extra.[CLAN_NAME].descr==self.extra.[CLAN_NAME].descr) and\n\t\t(visible(self,pc)))\n\t\taddstring(list,pc.name);\n\t\tpc:=pc.gnext;\n\t}\n\terr:=loadstr (self.extra.[CLAN_SYMBOLIC].descr,buf);\n\tif (err<1)\n\t{\n\t\tlog (\"01:  Error in cinfo\");\n\t\tquit;\n\t}\n\tmlist:=split(buf,\"\\n\");\n\terr:=loadstr (self.extra.[CLAN_SYMBOLIC].descr+\".rank\",buf);\n\tif (err<1)\n\t\terr:=loadstr (\"default.rank\",buf);\n\t\tif (err<1)\n\t\t{\n\t\t\tbuf:=\"\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\n\t\t\tblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\\nblank\";\n\t\t}\n\trlist:=split(buf,\"\\n\");\n\tif (arg==\"\")\n\t\tgoto cinfo_who;\n\telse if (arg==left(\"master\",length(arg)))\n\t\tgoto cinfo_mast;\n\telse if (arg==left(\"lord\",length(arg)))\n\t\tgoto cinfo_lord;\n\telse if (arg==left(\"treasurer\",length(arg)))\n\t\tgoto cinfo_treas\n\telse if (arg==left(\"quartermaster\",length(arg)))\n\t\tgoto cinfo_quar;\n\t\t\n:cinfo_who:\n\n\tbuf:=\"<div class='clan'>Clan members (* denotes on line):<br/><br/></div>\";\n\ti:=0;\n\tln:=length(mlist);\n\twhile (i<ln)\n\t{\n\t\tline:=split(mlist.[i],\":\");\n\t\tif (length(line)<3)\n\t\t{\n\t\t\ti:=i+1;\n\t\t\tcontinue;\n\t\t}\n\t\tpos:=split(line.[2],\"/\");\n\t\tps:=\"\";\n\t\tif (pos.[0]==\"$master\")\n\t\t\tps:=\"*Master* \";\n\t\telse if (pos.[0]==\"$lord\")\n\t\t\tps:=\"&lt;Lord&gt; \";\n\t\tif (pos.[1]==\"$treasure\")\n\t\t\tps:=ps+\"[Treasurer] \";\n\t\tif (pos.[2]==\"$quartermaster\")\n\t\t\tps:=ps+\"[Quartermaster] \";\n\t\tif (line.[0] in list)\n\t\t{\n\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" \"+ps+\"<br/>\";\n\t\t\telse\n\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\" \"+ps+\"<br/>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" \"+ps+\"<br/>\";\n\t\t\telse\n\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\" \"+ps +\"<br/>\";\n\t\t}\n\t\ti:=i+1;\n\t}\n\tgoto cinfo_list;\n\n:cinfo_mast:\n\t\n\tif (self.extra.[CLAN_RANK].names.[1]==\"$master\")\n\t{\n\t\tsendtext (textformat(\"You are the master daaa!<br/>\"),self);\n\t\tquit;\n\t}\n\tbuf:=\"<div class='clan'>The \"+self.extra.[CLAN_NAME].descr+\" clan master is (* denotes on line):</div>\";\n\ti:=0;\n\tln:=length(mlist);\n\twhile (i<ln)\n\t{\n\t\tline:=split(mlist.[i],\":\");\n\t\tif (length(line)<3)\n\t\t{\n\t\t\ti:=i+1;\n\t\t\tcontinue;\n\t\t}\n\t\tpos:=split (line.[2],\"/\");\n\t\tif (pos.[0]==\"$master\")\n\t\t{\n\t\t\tif (line.[0] in list)\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t}\n\t\ti:=i+1;\n\t}\n\tgoto cinfo_list;\n\n:cinfo_lord:\n\t\n\tln:=length(mlist);\n\ti:=0;\n\tbuf:=\"<div class='clan'>Clan lords (* denotes on line):<br/><br/></div>\";\n\tcount:=0;\n\twhile (i<ln)\n\t{\n\t\tline:=split(mlist.[i],\":\");\n\t\tif (length(line)<3)\n\t\t{\n\t\t\ti:=i+1;\n\t\t\tcontinue;\n\t\t}\n\t\tpos:=split (line.[2],\"/\");\n\t\tif (pos.[0]==\"$lord\")\n\t\t{\n\t\t\tcount:=count+1;\n\t\t\tif (line.[0] in list)\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t\ti:=i+1;\n\t\t}\n\t\ti:=i+1;\n\t}\n\tif (count<=0)\n\t\tbuf:=\"This clan has no lords yet see the master.<br/>\";\n\tgoto cinfo_list;\n\t\n:cinfo_treas:\n\t\n\tln:=length(mlist);\n\n\ti:=0;\n\tbuf:=\"<div class='clan'>Clan treasurers (* denotes on line):<br/><br/></div>\";\n\tcount:=0;\n\twhile (i<ln)\n\t{\n\t\tline:=split(mlist.[i],\":\");\n\t\tif (length(line)<3)\n\t\t{\n\t\t\ti:=i+1;\n\t\t\tcontinue;\n\t\t}\n\t\tpos:=split (line.[2],\"/\");\n\t\tif (pos.[1]==\"$treasure\")\n\t\t{\n\t\t\tcount:=count+1;\n\t\t\tif (line.[0] in list)\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t}\n\t\ti:=i+1;\n\t}\n\n\tif (count<=0)\n\t\tbuf:=\"This clan has no treasurers yet see the master.<br/>\";\n\tgoto cinfo_list;\n\n:cinfo_quar:\n\t\n\tln:=length(mlist);\n\ti:=0;\n\tbuf:=\"<div class='clan'>Clan Quartermasters (* denotes on line):<br/><br/></div>\";\n\tcount:=count+1;\n\twhile (i<ln)\n\t{\n\t\tline:=split(mlist.[i],\":\");\n\t\tif (length(line)<3)\n\t\t{\n\t\t\ti:=i+1;\n\t\t\tcontinue;\n\t\t}\n\t\tpos:=split (line.[2],\"/\");\n\t\tif (pos.[2]==\"$quartermaster\")\n\t\t{\n\t\t\tcount:=count+1;\n\t\t\tif (line.[0] in list)\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"* \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((line.[1]==\"0\") or (rlist.[atoi(line.[1])]==\"blank\"))\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\"<br/>\";\n\t\t\t\telse\n\t\t\t\t\tbuf:=buf+\"  \"+line.[0]+\" - \"+rlist.[atoi(line.[1])]+\"<br/>\";\n\t\t\t}\n\t\t}\n\t\ti:=i+1;\n\t}\n\tif (count<=0)\n\t\tbuf:=\"This clan has no quartermaster yet see the master.<br/>\";\n\tgoto cinfo_list;\n\n:cinfo_list:\n\t\n\tpagestring(textformat(buf+\"<div class='default'></div>\")+\"<br/>\",self);\n\tquit;\n} dilend"
}