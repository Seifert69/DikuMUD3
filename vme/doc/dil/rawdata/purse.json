{
    "keyword": "purse",
    "opcode": "DILSE_PURS",
    "yacc_rule": "| DILSE_PURS '(' dilexp ',' dilexp ')'\n{\n    INITEXP($$);\n\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'purse' not a unitptr\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 2 of 'purse' not a string\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_INT;\n        make_code(&($3));\n        make_code(&($5));\n        add_code(&($$), &($3));\n        add_code(&($$), &($5));\n        add_ubit8(&($$), DILE_PURS);\n    }\n    FREEEXP($3);\n    FREEEXP($5);\n}",
    "dilfe_name": "dilfe_purs",
    "c_implementation": "void dilfe_purs(dilprg *p)\n{\n    dilval *v = new dilval;\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    v->type = DILV_INT;\n    switch (dil_getval(v1))\n    {\n        case DILV_UP:\n            if (!v1->val.ptr)\n            {\n                v->type = DILV_FAIL;\n            }\n            else\n            {\n                switch (dil_getval(v2))\n                {\n                    case DILV_SP:\n                        if ((!v2->val.ptr) || (!*((char *)v2->val.ptr)))\n                        {\n                            v->type = DILV_FAIL;\n                        }\n                        else\n                        {\n                            int i = 0;\n\n                            v->val.num = 0;\n\n                            for (i = 0; i <= MAX_MONEY; i++)\n                            {\n                                if (strcmp((char *)v2->val.ptr, g_money_types[i].abbrev) == 0)\n                                {\n                                    break;\n                                }\n                            }\n\n                            if (i <= MAX_MONEY)\n                            {\n                                /* Note down money-objects in from, and their values */\n                                for (unit_data *tmp = ((unit_data *)v1->val.ptr)->getUnitContains(); tmp; tmp = tmp->getNext())\n                                {\n                                    if (IS_MONEY(tmp) && MONEY_TYPE(tmp) == i)\n                                    {\n                                        v->val.num = MONEY_AMOUNT(tmp);\n                                        break;\n                                    }\n                                }\n                            }\n                        }\n                        break;\n                    case DILV_FAIL:\n                    case DILV_NULL:\n                        v->type = DILV_FAIL;\n                        break;\n                    default:\n                        v->type = DILV_ERR;\n                        break;\n                }\n            }\n\n            break;\n        case DILV_FAIL:\n        case DILV_NULL:\n            v->type = DILV_FAIL;\n            break;\n        default:\n            v->type = DILV_ERR;\n            break;\n    }\n\n    p->stack.push(v);\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin prg4();\nvar\n\tpc : unitptr;\n   gift: unitptr;\n    i  : integer;\n    il : intlist;\n\tbuf : string;\n\tsl  : stringlist;\n   gift1 : string;\ncode\n{\n\theartbeat := 3;\n\n\t:start:\n\n\twait(SFB_CMD, (command(\"open\")) and ((\"bag\" in argument)or\n\t(\"box\" in argument)or(\"treat\" in argument)) );\n\tpc := activator;\n\tsecure(pc, lost);\n\t{\n\t  block;\n\t  if (self.outside != activator)\n{\n      act(\"You must pick me up before opening me. DOH!\",\n          A_ALWAYS, activator, null, null, TO_CHAR);\ngoto start;\n}\t\t  \n  unset(self.openflags, EX_CLOSED);\n    \t  goto trap;\n    }\n:lost:\nact(\"<div class='cpr'>A possible 500000 gold disappears forever!</div><div class='default'></div>\",\nA_SOMEONE, self, null, pc, TO_ALL);\ndestroy(self);\n\n:trap:\n      act(\"The bag rustles as you open it.\",\n          A_ALWAYS, pc, null, null, TO_ALL);\n       act(\"There is money inside - check your purse!\",\n          A_ALWAYS, pc, null, null, TO_CHAR);\non rnd(0,4) goto load_1, load_2, load_3, load_4, load_5;\n:load_1:\ngift := load(\"pcoins@hallows23\");\nlink(gift,pc);\ndestroy(self);\n      pause;\n      quit;\n:load_2:\n     gift := load(\"icoins@hallows23\");\nlink(gift,pc);\ndestroy(self);\n      pause;\n      quit;\n:load_3:\n     gift := load(\"gcoins@hallows23\");\nlink(gift,pc);\ndestroy(self);\n      pause;\n      quit;\n:load_4:\n     gift := load(\"scoins@hallows23\");\nlink(gift,pc);\ndestroy(self);\n      pause;\n      quit;\n:load_5:\n     gift := load(\"ccoins@hallows23\");\nlink(gift,pc);\ndestroy(self);\n      pause;\n      quit;\t  \n\t  \n\n} dilend"
}