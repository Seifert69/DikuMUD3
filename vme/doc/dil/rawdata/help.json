{
    "keyword": "help",
    "opcode": "DILSF_HELP",
    "yacc_rule": "| DILSF_HELP /*.help*/\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_ZP;\n    $$.typ = DilVarType_e::DILV_SP;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_HELP;\n}",
    "dilfe_name": "DILF_HELP",
    "c_implementation": "case DILF_HELP:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_ZP:\n                    if (v1->val.ptr)\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_SPR;\n                        v->ref = ((zone_type *)v1->val.ptr)->getHelpPtrPtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin li1();\nvar\n  pcname   : string;\n  item     : unitptr;\n  pc       : unitptr;\n  i        : integer;\n  exdp     : extraptr;\n\ncode\n{\n\n  :init:\n  heartbeat := PULSE_SEC*5;\n  on_activation((self.position <= POSITION_SLEEPING) or\n\t       (self.position == POSITION_FIGHTING), skip);\n\n  :start:\n  wait(SFB_CMD, (activator.type == UNIT_ST_PC) and (not\n      command(\"give\")) and ((SCRIBE_ONGOING in\n\t\t activator.quests)));\n  if(LIB_COMPLETE in activator.quests)\n   goto waitawhile;\n\n  pc := activator;\n  secure(pc, lostpc);\n\n  if(not(LIB_ONGOING in pc.quests))\n    {\n     pause;\n     exec(\"say You look like one who is on a quest.\", self);\n     pause;\n     exec(\"say I have a pair of spectacles that I could \" +\n\t  \"give you in return for some things I need.\", self);\n     pause;\n     exec(\"say would you like to help me?\", self);\n     pause;\n     exec(\"say Please nod or shake.\", self);\n\n     i := 0;\n     while (i < 5)\n     {\n\twait(SFB_CMD, activator #= pc);\n\n\tif(command(\"nod\"))\n\t{\n\t  goto quest_accepted;\n\t}\n\telse if(command(\"say\"))\n\t{\n\t  pause;\n\t  exec(\"say Nod if you want to continue, shake \" +\n\t       \"if not.\", self);\n\t}\n\telse if(command(\"shake\"))\n\tgoto no_quest;\n\ti := I + 1;\n     }\n\n  :no_quest:\n  pause;\n  exec(\"say Fine, good luck in your travels.\", self);\n  unsecure(pc);\n  goto waitawhile;\n\n  :quest_accepted:\n  pause;\n  exec(\"say I am looking for something to write with.\",\n\t   self);\n  pause;\n  exec(\"say A book containing unlimited knowledge.\", self);\n  pause;\n  exec(\"say I also search for a little information \"+\n       \"relating to a group of people named the \"+\n\t  \"Sanctuarians.\", self);\n  pause;\n  exec(\"say Bring me these things and I can give you the \"+\n\t  \"glasses I have.\", self);\n  pause;\n  exec(\"say I also know what you seek, and can tell you that there are \"+\n       \"between six and eight scrolls containing the language of \"+\n       \"the ancients\", self);\n\n  addextra(pc.quests, {LIB_ONGOING}, \"\");\n  unsecure(pc);\n  goto start;\n  }\n  else\n  {\n    exdp := LIB_ONGOING in pc.quests;\n    if ((\"quill\" in exdp.names)and\n\t(\"book of knowledge\" in exdp.names)and\n\t   (\"vellum scrap\" in exdp.names))\n    {\n      pause;\n      subextra(pc.quests, LIB_ONGOING);\n      addextra(pc.quests, {LIB_COMPLETE}, \"\");\n      exec(\"say Thank you \" +pc.name+ \".\", self);\n      item := load(\"obj_15@pit\");\n      link(item, pc);\n      pause;\n\t exec(\"say You have helped me greatly.\", self);\n\t pause;\n\t exec(\"say here are the glasses.\", self);\n\t pause;\n\t act(\"The librarian gives you a pair of glasses.\",\n\t\tA_SOMEONE, pc, null, null, TO_CHAR);\n\n\t act(\"The librarian give a pain of glasses to $1n.\",\n\t\tA_SOMEONE, self.outside, null, null, TO_ROOM);\n    }\n  }\n\n      unsecure(pc);\n      goto start;\n\n\t:waitawhile:\n\theartbeat := PULSE_SEC*60;\n\tpause;\n\tgoto init;\n\n\t:lostpc:\n\texec(\"say I guess the quest wasn't so important.\",\n\tself);\n\tpause;\n\texec(\"sigh\", self);\n\tgoto start;\n} dilend"
}