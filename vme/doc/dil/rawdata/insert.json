{
    "keyword": "insert",
    "opcode": "DILSI_INSLST",
    "yacc_rule": "| DILSI_INSLST '(' coreexp ',' coreexp ',' coreexp ')' ihold\n{\n    if (($3.typ != DilVarType_e::DILV_SLP\n        && $3.typ != DilVarType_e::DILV_ILP)\n        || $3.dsl != DSL_LFT)\n    {\n        dilfatal(\"Arg 1 of 'insert' not a stringlist or intlist variable\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'insert' not an integer\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_SP && $7.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 3 of 'insert' not a string or integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $9 + 1;\n        wtmp = &tmpl.core[$9];\n        bwrite_ubit8(&wtmp, DILI_INSLST);\n    }\n}",
    "dilfe_name": "dilfi_inslst",
    "c_implementation": "void dilfi_inslst(dilprg *p)\n{\n    dilval *v3 = p->stack.pop();\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    switch (v1->type)\n    {\n        default:\n            /* ERROR not right lvalue */\n            dil_typeerr(p, \"lvalue addstring\");\n            break;\n        case DILV_FAIL:\n            break;\n        case DILV_SLPR:\n        case DILV_ILPR:\n            if (dil_type_check(\"insert\", p, 2, v2, TYPEFAIL_NULL, 1, DILV_INT, v3, TYPEFAIL_NULL, 2, DILV_SP, DILV_INT))\n            {\n                if (v1->type == DILV_SLPR)\n                {\n                    if (dil_getval(v3) == DILV_INT)\n                    {\n                        ((cNamelist *)v1->ref)->InsertName(itoa(v3->val.num), (ubit32)v2->val.num);\n                    }\n                    else if (v3->val.ptr)\n                    {\n                        ((cNamelist *)v1->ref)->InsertName(((char *)v3->val.ptr), (ubit32)v2->val.num);\n                    }\n                }\n                else if (v1->type == DILV_ILPR)\n                {\n                    if (dil_getval(v3) == DILV_INT)\n                    {\n                        ((cintlist *)v1->ref)->Insert(v3->val.num, (sbit32)v2->val.num);\n                    }\n                    else\n                    {\n                        if (v3->val.ptr)\n                        {\n                            ((cintlist *)v1->ref)->Insert(atoi(skip_spaces((char *)v3->val.ptr)), (sbit32)v2->val.num);\n                        }\n                    }\n                }\n            }\n            break;\n    }\n\n    delete v1;\n    delete v2;\n    delete v3;\n}",
    "dil_example": "dilbegin aware Gold_bucket ();\nvar\nlen :integer;\n i,t:integer;\n buf:string;\n tmp:string;\n args:stringlist;\n\ncode\n{\n\ninterrupt (SFB_CMD, command(\"accadd\"),add_name);\ninterrupt (SFB_CMD, command(\"accdel\"),del_name);\n\n:start:\nwait (SFB_MSG, TRUE);\n\nif (argument !=\"lookin\" )\n goto start;\n\n\n if (length(self.extra.[\"$dlist\"].names)==1)\n  {\n  sendtext (\"No donations this year yet we still need $2400 per year.<br/>\",activator);\n goto start;\n }\n\n\n len:=length (self.extra.[\"$dlist\"].names);\n  buf:=\"As you look into the bucket you see the images of\";\n i:=1;\n while (i<len)\n  {\n  if (i==1)\n  {\n  if (i+1==len)\n   buf:=buf+\" \"+self.extra.[\"$dlist\"].names.[i]+\".  \";\n   else\n      buf:=buf+\" \"+self.extra.[\"$dlist\"].names.[i]+\", \";\n      }\n      else\n      {\n        if (i+1==len)\n   buf:=buf+\" and \"+ self.extra.[\"$dlist\"].names.[i]+\".  \";\n   else\n     buf:=buf+\" \"+self.extra.[\"$dlist\"].names.[i]+\", \";\n      }\n   t:=t+self.extra.[\"$dlist\"].vals.[i];\n   i:=i+1;\n  }\nif (t>2400)\n t:=2400;\n  t:=(t*100)/2400;\nif (t==100)\n                                                                                     buf :=buf +\"The images seem to fill the bucket, \"+\n                                                                                     \" with their grandeur and generosity.<br/>\";\nelse\n  buf:=buf+\"The images only seem to fill the bucket %\"+itoa(t)+\" of the way up. \"+\n  \" There is still room for your image if you are worthy.<br/>\";\n\n  buf:=textformat(buf);\n  sendtext(buf,activator);\n\ngoto start;\n\n:add_name:\nif (activator.level<240)\ngoto start;\nblock;\nif (argument==\"\")\n {\n sendtext (\"who do you want to add<br/>\",activator);\n goto start;\n }\n args:=getwords(argument);\n\n if (length (args) <2)\n  {\n  sendtext (\"Correct format is 'add &lt;amount&gt; &lt;person&gt;'<br/>\",activator);\n  goto start;\n  }\n\n  if (atoi(args.[0])==0)\n  {\n  sendtext (\"The first argument needs to be greater than 0<br/>\",activator);\n  goto start;\n  }\n\ntmp:=getword(argument);\ninsert(self.extra.[\"$dlist\"].names,length(self.extra.[\"$dlist\"].names),argument);\ninsert(self.extra.[\"$dlist\"].vals,length(self.extra.[\"$dlist\"].vals),atoi(args.[0]));\n\nstore (self,\"bucket\",TRUE);\ngoto start;\n:del_name:\n\nif (activator.level<200)\ngoto start;\nblock;\n\n\nif (argument==\"\")\n {\n sendtext (\"who do you want to delete<br/>\",activator);\n goto start;\n }\n\nt:=argument in self.extra.[\"$dlist\"].names;\nif (t>0)\n {\n remove (self.extra.[\"$dlist\"].names,t-1);\n  remove (self.extra.[\"$dlist\"].vals,t-1);\n   sendtext(argument +\" removed from the list<br/>\",activator);\n }\nelse\n{\nsendtext (\"That person is not in the list.<br/>\",activator);\n}\n\nstore (self,\"bucket\",TRUE);\ngoto start;\n} dilend"
}