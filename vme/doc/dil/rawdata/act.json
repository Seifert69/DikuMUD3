{
    "keyword": "act",
    "opcode": "DILSI_ACT",
    "yacc_rule": "| DILSI_ACT '(' dilexp ',' dilexp ',' dilexp ',' dilexp ',' dilexp ',' dilexp ')'\n{\n    /* Fri Jan 24 12:44:22 PST 1997   HHS:\n       This function writes act() as a function that\n       returns a string in an expression\n       */\n    INITEXP($$)\n    checkbool(\"argument 2 of act\", $5.boolean);\n    checkbool(\"argument 6 of act\", $13.boolean);\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'act' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'act' not an integer\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_NULL\n             && $7.typ != DilVarType_e::DILV_SP\n             && $7.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 3 of 'act' not a unit or string\");\n    }\n    else if ($9.typ != DilVarType_e::DILV_NULL\n             && $9.typ != DilVarType_e::DILV_SP\n             && $9.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 4 of 'act' not a unit or string\");\n    }\n    else if ($11.typ != DilVarType_e::DILV_NULL\n             && $11.typ != DilVarType_e::DILV_SP\n             && $11.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 5 of 'act' not a unit or string\");\n    }\n    else if ($13.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 6 of 'act' not an integer\");\n    }\n    else\n    {\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_SP;\n\n        make_code(&($3));\n        make_code(&($5));\n        make_code(&($7));\n        make_code(&($9));\n        make_code(&($11));\n        make_code(&($13));\n\n        add_code(&($$), &($3));\n        add_code(&($$), &($5));\n        add_code(&($$), &($7));\n        add_code(&($$), &($9));\n        add_code(&($$), &($11));\n        add_code(&($$), &($13));\n        add_ubit8(&($$), DILE_ACT);\n    }\n}\n\n------\n\n| DILSI_ACT '(' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ',' coreexp ')' ihold\n{\n    checkbool(\"argument 2 of act\", $5.boolean);\n    checkbool(\"argument 6 of act\", $13.boolean);\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'act' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'act' not an integer\");\n    }\n    else if ($7.typ != DilVarType_e::DILV_NULL\n             && $7.typ != DilVarType_e::DILV_SP\n             && $7.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 3 of 'act' not a unit or string\");\n    }\n    else if ($9.typ != DilVarType_e::DILV_NULL\n             && $9.typ != DilVarType_e::DILV_SP\n             && $9.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 4 of 'act' not a unit or string\");\n    }\n    else if ($11.typ != DilVarType_e::DILV_NULL\n             && $11.typ != DilVarType_e::DILV_SP\n             && $11.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 5 of 'act' not a unit or string\");\n    }\n    else if ($13.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 6 of 'act' not an integer\");\n    }\n    else\n    {\n        /* make code */\n        $$.fst = $3.fst;\n        $$.lst = $15 + 1;\n        wtmp = &tmpl.core[$15];\n        bwrite_ubit8(&wtmp, DILI_ACT);\n    }\n}",
    "dilfe_name": "dilfe_act",
    "c_implementation": "void dilfe_act(dilprg *p)\n{\n    dilval *v = new dilval;\n    char buf[1024];\n    /* Conversion of integers to strings */\n    dilval *v6 = p->stack.pop();\n    dilval *v5 = p->stack.pop();\n    dilval *v4 = p->stack.pop();\n    dilval *v3 = p->stack.pop();\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    v->type = DILV_FAIL;\n\n    if (dil_type_check(\"act\",\n                       p,\n                       6,\n                       v1,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_SP,\n                       v2,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT,\n                       v3,\n                       TYPEFAIL_NULL,\n                       3,\n                       DILV_UP,\n                       DILV_SP,\n                       DILV_NULL,\n                       v4,\n                       TYPEFAIL_NULL,\n                       3,\n                       DILV_UP,\n                       DILV_SP,\n                       DILV_NULL,\n                       v5,\n                       TYPEFAIL_NULL,\n                       3,\n                       DILV_UP,\n                       DILV_SP,\n                       DILV_NULL,\n                       v6,\n                       TYPEFAIL_NULL,\n                       1,\n                       DILV_INT))\n    {\n        switch (v6->val.num)\n        {\n            case TO_CHAR:\n            case TO_ROOM:\n            case TO_ALL:\n            case TO_REST:\n                /* these require 1st argument */\n                if (v3->val.ptr)\n                {\n                    act_generate(buf, (char *)v1->val.ptr, ActShow(v2->val.num), v3, v4, v5, ActType(v6->val.num), (unit_data *)v3->val.ptr);\n                }\n                v->type = DILV_SP;\n                v->atyp = DILA_EXP;\n                v->val.ptr = str_dup(buf);\n                break;\n\n            case TO_VICT:\n            case TO_NOTVICT:\n                if (v5->val.ptr)\n                {\n                    act_generate(buf, (char *)v1->val.ptr, ActShow(v2->val.num), v3, v4, v5, ActType(v6->val.num), (unit_data *)v5->val.ptr);\n                }\n                v->type = DILV_SP;\n                v->atyp = DILA_EXP;\n                v->val.ptr = str_dup(buf);\n                break;\n        }\n    }\n    p->stack.push(v);\n    delete v1;\n    delete v2;\n    delete v3;\n    delete v4;\n    delete v5;\n    delete v6;\n}",
    "dil_example": "dilbegin cuff_target(deputy : unitptr, targ : unitptr, cuffs : unitptr);\nvar\n   depname: string;\n\ncode\n{\n   act(\"You cuff $3n.\", A_SOMEONE, deputy, null, targ, TO_CHAR);\n   act(\"$1n surprises you and put $2n around your wrists.\", A_SOMEONE, deputy, cuffs, targ, TO_VICT);\n   act(\"$1n puts $2n around $3N's wrists.\", A_SOMEONE, deputy, cuffs, targ, TO_NOTVICT);\n\n   follow(targ, deputy);\n   depname := deputy.name;\n   link(cuffs, targ);\n   unequip(equipment(targ, WEAR_WRIST_R));\n   addequip(cuffs, WEAR_WRIST_R);\n   dilcopy(\"cuffed@midgaard(\"+depname+\")\", targ);\n   dilcopy(\"cuffed2@midgaard(\"+depname+\")\", targ);\n\n   exec(\"sigh\", targ); /* Do this to activate the DILs */\n   return;\n} dilend"
}