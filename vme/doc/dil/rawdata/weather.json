{
    "keyword": "weather",
    "opcode": "DILSE_WEAT",
    "yacc_rule": "| DILSE_WEAT\n{\n    INITEXP($$);\n    $$.dsl = DSL_DYN;\n    $$.typ = DilVarType_e::DILV_INT;\n    add_ubit8(&($$), DILE_WEAT);\n}",
    "dilfe_name": "dilfe_weat",
    "c_implementation": "void dilfe_weat(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* Self */\n\n    v->type = DILV_INT;\n    v->atyp = DILA_NORM;\n    v->val.num = unit_zone(p->sarg->owner)->cgetWeather().getSky();\n    p->stack.push(v);\n}",
    "dil_example": "dilbegin sun_beam(medi : unitptr, tgt : unitptr,\n                 arg : string, hm : integer, effect : string);\nvar\n   u : unitptr;\n\ncode\n{\n   hm := 0;\n   u := self.outside;\n\n   while (u)\n   {\n      if (isset(u.flags, UNIT_FL_NO_WEATHER | UNIT_FL_INDOORS))\n      {\n         act(\"There is no access to the forces of nature from here.\",\n             A_ALWAYS, self, null, null, TO_CHAR);\n         quit;\n      }\n      u := u.outside;\n   }\n/* I changed this so maybe it will work until we fix weather Darg\n   if (weather != SKY_CLOUDLESS)\n   {\n      act(\"The skies are not clear.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n*/\n   if ((weather != SKY_CLOUDLESS) or (weather != SKY_CLOUDY))\n   {\n      act(\"The heavy rain clouds block any chance of casting the spell.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n   if ((mudhour < 5) or (mudhour >= 21))\n   {\n      act(\"The sun has not risen yet.\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n\n   /* Most powerful at noon */\n   if (mudhour < 12)\n     hm := 18*(mudhour - 12);\n   else\n     hm := -15*(mudhour - 12);\n\n   if (RACE_IS_UNDEAD(tgt.race))\n     hm := hm + 100;\n\n   hm := attack_spell(SPL_SUN_BEAM, self, medi, tgt, hm, effect);\n   quit;\n} dilend"
}