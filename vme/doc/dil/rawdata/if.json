{
    "keyword": "if",
    "opcode": "DILSI_IF",
    "yacc_rule": "dilcomplex : DILSI_IF '(' coreexp ')' ihold ahold block ihold ahold DILSI_ELS dilcomposed\n    {\n        wtmp = &tmpl.core[$5];\n        bwrite_ubit8(&wtmp, DILI_IF); /* the instruction */\n        wtmp = &tmpl.core[$6];\n        bwrite_ubit32(&wtmp, $11.fst); /* address of else */\n        wtmp = &tmpl.core[$8];\n        bwrite_ubit8(&wtmp, DILI_GOTO); /* skip else */\n        wtmp = &tmpl.core[$9];\n        bwrite_ubit32(&wtmp, $11.lst); /* end of else */\n        $$.fst = $3.fst;\n        $$.lst = $11.lst;\n    }\n\n------\n\n| DILSI_IF '(' coreexp ')' ihold ahold dilinst optsemicolons ihold ahold DILSI_ELS dilcomposed\n{\n    wtmp = &tmpl.core[$5];\n    bwrite_ubit8(&wtmp, DILI_IF); /* the instruction */\n    wtmp = &tmpl.core[$6];\n    bwrite_ubit32(&wtmp, $12.fst); /* address of else */\n    wtmp = &tmpl.core[$9];\n    bwrite_ubit8(&wtmp, DILI_GOTO); /* skip else */\n    wtmp = &tmpl.core[$10];\n    bwrite_ubit32(&wtmp, $12.lst); /* end of else */\n    $$.fst = $3.fst;\n    $$.lst = $12.lst;\n}\n\n------\n\n| DILSI_IF '(' coreexp ')' ihold ahold dilcomposed\n{\n    wtmp = &tmpl.core[$5];\n    bwrite_ubit8(&wtmp, DILI_IF); /* the instruction */\n    wtmp = &tmpl.core[$6];\n    bwrite_ubit32(&wtmp, $7.lst); /* address of else */\n    $$.fst = $3.fst;\n    $$.lst = $7.lst;\n}",
    "dilfe_name": "dilfi_if",
    "c_implementation": "void dilfi_if(dilprg *p)\n{\n    ubit32 coreptr = 0;\n    dilval *v1 = p->stack.pop();\n\n    coreptr = bread_ubit32(&(p->fp->pc)); /* else branch */\n\n    p->waitcmd--;\n    if (!dil_getbool(v1, p))\n    {                                              /* might be pointer, but ok! */\n        p->fp->pc = &(p->fp->tmpl->core[coreptr]); /* choose else branch */\n    }\n    delete v1;\n}",
    "dil_example": "dilbegin guardroutine(guardloc : string, dayguard : integer);\nexternal\n   DailyRoutine@quests(sl : stringlist, arg2 : string);\nvar\n   i  : integer;\n   sch : intlist;\ncode\n{\n   on_activation((self.position == POSITION_FIGHTING), skip);\n\n   if (dayguard)\n      sch := {5, 18};  // Wake up at 5, go back at 6pm\n   else\n      sch := {17,6};   // Wake up at 17, go home at 6\n\n:start:\n   heartbeat := WAIT_SEC*5;\n   pause;\n   if (mudhour == sch.[0])\n   {\n      DailyRoutine@quests({\n         \"wake\", \n         \"::descr::A $1N is here heading to work.\",\n         \"yawn\",\n         \"say Time to get going guys!\", \n         \"::walkto::$2t\",\n         \"::descr::A $1N is here guarding the gate.\"\n      }, guardloc);\n   }\n\n   if(mudhour == sch.[1])\n   {\n      i := rnd(1,3);\n      if (i == 1) goto bar1;\n      if (i == 2) goto bar2;\n      if (i == 3) goto bar3;\n      else goto start;\n\n:bar1:\n      pause;\n      DailyRoutine@quests({\n      \"::walkto::grunting_inn@midgaard\",\n      \"::descr::A $1N is here on $1s evening break.\",\n      \"buy beer\", \n      \"drink beer\",\n      \"stretch\", \n      \"::descr::A $1N is here heading home.\",\n      \"::walkto::guard_dorm@midgaard\",\n      \"yawn\",\n      \"::descr::A $1N is here resting.\",\n      \"sleep\"\n   }, \"\");\n   goto start;\n\n   :bar2:\n   pause;\n   DailyRoutine@quests({\n      \"::walkto::grub_inn@midgaard\",\n      \"::descr::A $1N is here on $1s evening break.\",\n      \"buy firebreather\", \n      \"drink firebreather\",\n      \"::descr::A $1N is here heading home.\",\n      \"::walkto::guard_dorm@midgaard\",\n      \"::descr::A $1N is here resting.\",\n      \"yawn\",\n      \"sleep\"}, \"\");\n\n   goto start;\n\n\n   :bar3:\n   pause;\n   DailyRoutine@quests({\n      \"::walkto::park_cafe@midgaard\",\n      \"::descr::A $1N is here on $1s evening break.\",\n      \"buy coffee\", \n      \"drink coffee\",\n      \"::descr::A $1N is here heading home.\",\n      \"::walkto::guard_dorm@midgaard\",\n      \"::descr::A $1N is here resting.\",\n      \"yawn\",\n      \"sleep\"}, \"\");\n   goto start;\n  }\n} dilend"
}