{
    "keyword": "attack_type",
    "opcode": "DILSF_ATY",
    "yacc_rule": "| DILSF_ATY /* .attack_type */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_ATY;\n}",
    "dilfe_name": "DILF_ATY",
    "c_implementation": "case DILF_ATY:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *character = reinterpret_cast<char_data *>(v1->val.ptr);\n                    if (character && character->isChar())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_UINT1R;\n                        v->ref = character->getAttackTypePtr();\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin attack_switch(arg : string);\nvar\n    lst : stringlist;\n    wpn : intlist;\n    i : integer;\n    fnd : integer;\n    str : string;\ncode\n{\n    if (arg == \"\")\n    {\n        sendtext(\"Your current attack type is \"+\n        weapon_name(self.attack_type)+\".<br/>\", self);\n        quit;\n    }\n\n    lst := {\"fist\",\"kick\",\"knee\",\"elbow\"};\n\n    wpn := {WPN_FIST,WPN_KICK,WPN_KNEE,WPN_ELBOW};\n\n    i := 0;\n    fnd := FALSE;\n    while (i < length(lst))\n    {\n        if (left(lst.[i], length(arg)) == arg)\n        {\n            fnd := TRUE;\n            break;\n        }\n\n        i := i + 1;\n    }\n\n    if (fnd != TRUE)\n    {\n        str := lst.[0];\n        i := 1;\n        while (i < length(lst))\n        {\n            str := str+\", \"+lst.[i];\n            i := i + 1;\n        }\n\n        sendtext(\"That option is not available (choose \"+str+\"</div>).<br/>\",self);\n    }\n    else\n    {\n        self.attack_type := wpn.[i];\n        sendtext(\"Attack type set to \"+lst.[i]+\".<br/>\",self);\n        send_done(\"attackswitch\", self, null, null, 0, arg, null, CMD_AUTO_NONE);\n    }\n\n    quit;\n} dilend"
}