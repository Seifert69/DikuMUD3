{
    "keyword": "change_speed",
    "opcode": "DILSI_CHAS",
    "yacc_rule": "| DILSI_CHAS '(' coreexp ',' coreexp ')' ihold\n{\n    checkbool(\"argument 2 of change_speed\", $5.boolean);\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'change_speed' not an unitptr\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'change_speed' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_CHAS);\n    }\n}",
    "dilfe_name": "dilfi_chas",
    "c_implementation": "void dilfi_chas(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    if (dil_type_check(\"change_speed\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_UP, v2, FAIL_NULL, 1, DILV_INT))\n    {\n        auto *character = reinterpret_cast<char_data *>(v1->val.ptr);\n        if (character && character->isChar() && CHAR_COMBAT(character))\n        {\n            CHAR_COMBAT(character)->changeSpeed(v2->val.num, character->getSpeedPercentage());\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin quaff_dil(arg : string);\nvar\npotion: unitptr;\nn: integer;\n\ncode\n{\n\n if (arg == \"\")\n {\n act(\"What do you want to quaff?\",A_ALWAYS, self, null, null, TO_CHAR);\n quit;\n }\n\n potion := findunit(self,arg,FIND_UNIT_IN_ME,null);\n\n if (potion == null)\n {\n act(\"You do not have that item.\",A_ALWAYS, self, null, null, TO_CHAR);\n quit;\n }\n\n if (potion.objecttype != ITEM_POTION)\n {\n act(\"You can only quaff potions.\",A_ALWAYS, self, null, null, TO_CHAR);\n quit;\n }\n\n potion.spells[SPL_ALL] := potion.value[0];\n\n if (self.position == POSITION_FIGHTING) change_speed(self,PULSE_VIOLENCE*2);\n\n act(\"You quaff $2t which dissolves.\", A_ALWAYS, self, potion.title, null,\nTO_CHAR);\n act(\"$1N quaffs $2t.\",\n      A_SOMEONE, self,potion.title, null, TO_REST);\n n := cast_spell(potion.value[1],self,potion,self,\"\");\n n := cast_spell(potion.value[2],self,potion,self,\"\");\n n := cast_spell(potion.value[3],self,potion,self,\"\");\n send_done(\"quaff\",self,potion,potion,0,\"\",null, CMD_AUTO_NONE);\n destroy(potion);\n quit;\n\n} dilend"
}