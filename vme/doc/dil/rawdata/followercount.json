{
    "keyword": "followercount",
    "opcode": "DILSF_FOLCT",
    "yacc_rule": "| DILSF_FOLCT /* .followercount */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_DYN;\n    $$.num = DILF_FOLCT;\n}",
    "dilfe_name": "DILF_FOLCT",
    "c_implementation": "case DILF_FOLCT:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL:\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                    if ((v1->val.ptr && ((unit_data *)v1->val.ptr)->isChar()))\n                    {\n                        v->atyp = DILA_NORM;\n                        v->type = DILV_INT;\n                        v->val.num = follower_count((unit_data *)v1->val.ptr);\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL; /* not applicable */\n                    }\n                    break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin do_group (arg : string);\n\nvar\n\n   mast    :  unitptr;\n   buffer  :  string;\n   fol     :  unitptr;\n   cnt     :  integer;\n   temp    :  string;\n\ncode{\n\n if (arg == \"\")\n    {\n      if (not isset(self.charflags, CHAR_GROUP))\n         {\n           sendtext(\"You are not a member of a group.<br/>\", self);\n           quit;\n         }\n\n      if (self.master)\n          mast := self.master;\n      else\n          mast := self;\n\n      cnt := 0;\n\n      buffer := \"Your group consists of:<br/>\";\n\n      if ((isset(mast.charflags, CHAR_GROUP)) and (mast.master == null))\n         {\n\n           if (not visible(self, mast))\n              {\n                if (fol.sex == SEX_NEUTRAL)\n                     temp := \"Something (Head of Group)<br/>\";\n                else\n                     temp := \"Someone (Head of Group)<br/>\";\n              }\n           else if (mast.type == UNIT_ST_PC)\n                temp := mast.name + \" (Head of Group)<br/>\";\n           else if (mast.type == UNIT_ST_NPC)\n                temp := mast.title + \" (Head of Group)<br/>\";\n\n           buffer := buffer + \"     \" + temp;\n         }\n\n\n\n      while (cnt < mast.followercount)\n         {\n           fol := getfollower(mast, cnt);\n\n           if (isset(fol.charflags, CHAR_GROUP))\n              {\n                 if (visible(self, fol))\n                    {\n                      if (fol.type == UNIT_ST_PC)\n                           buffer := buffer + \"     \" + fol.name + \"<br/>\";\n                      else\n                           buffer := buffer + \"     \" + fol.title + \"<br/>\";\n                    }\n                 else\n                    {\n                      if (fol.sex == SEX_NEUTRAL)\n                           buffer := buffer + \"     Something<br/>\";\n                      else\n                           buffer := buffer + \"     Someone<br/>\";\n                    }\n              }\n\n           cnt := cnt + 1;\n         }\n\n\n      sendtext(buffer, self);\n\n      quit;\n    }\n\n\n /* This is a little messy, but only way I can think to do it to avoid\n   people from grouping invisible players or worse, wizi gods, and telling\n   that wizis are there by not being able to 'group whistler' but being\n   able to group '2.whistler'.\n   Let me know if there is a better way.\n */\n\n temp := arg;\n cnt := 1;\n\n:loop:\n mast := findunit(self, temp, FIND_UNIT_SURRO, null);\n\n if (mast == null)\n    {\n      if (arg == \"self\")\n           mast := self;\n      else\n          {\n            sendtext(\"There is no one named \" + arg + \" here.<br/>\", self);\n            quit;\n          }\n    }\n\n if (((mast != self) and (not visible(self, mast))) or (mast.type == UNIT_ST_OBJ))\n    {\n      cnt := cnt + 1;\n      temp := itoa(cnt) + \".\" + arg;\n      goto loop;\n    }\n\n\n if (self.master != null)\n    {\n      sendtext(\"You cannot enroll group members without being the head of the group.<br/>\", self);\n      quit;\n    }\n\n if ((mast != self) and (mast.master != self))\n    {\n      sendtext(mast.name + \" must follow you to enter your group.\", self);\n      quit;\n    }\n\n\n if (not isset(mast.charflags, CHAR_GROUP))\n    {\n      set(mast.charflags, CHAR_GROUP);\n\n      if (mast != self)\n         {\n           act(\"You are now a member of $2n's group.\", A_ALWAYS, mast, self, null, TO_CHAR);\n           act(\"$1n is now a member of your group.\", A_ALWAYS, mast, null, self, TO_VICT);\n         }\n      else\n           act(\"You are now a member of the group.\", A_ALWAYS, self, null, null, TO_CHAR);\n\n\n      act(\"$1n is now a member of $3n's group.\", A_ALWAYS, mast, null, self, TO_NOTVICT);\n    }\n else\n    {\n      unset(mast.charflags, CHAR_GROUP);\n\n      if (mast != self)\n         {\n           act(\"You are no longer a member of $2n's group.\", A_ALWAYS, mast, self, null, TO_CHAR);\n           act(\"$1n is no longer a member of your group.\", A_ALWAYS, mast, null, self, TO_VICT);\n         }\n      else\n           act(\"You are no longer a member of the group.\", A_ALWAYS, self, null, null, TO_CHAR);\n\n      act(\"$1n is no longer a member of $3n's group.\", A_ALWAYS, mast, null, self, TO_NOTVICT);\n\n    }\n\n quit;\n\n} dilend"
}