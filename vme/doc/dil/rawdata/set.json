{
    "keyword": "set",
    "opcode": "DILSI_SET",
    "yacc_rule": "| DILSI_SET '(' coreexp ',' coreexp ')' ihold\n{\n    checkbool(\"argument 2 of set\", $5.boolean);\n    if ($3.typ != DilVarType_e::DILV_INT || $3.dsl != DSL_LFT)\n    {\n        dilfatal(\"Arg 1 of 'set' not an integer variable\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_INT)\n    {\n        dilfatal(\"Arg 2 of 'set' not an integer\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_SET);\n    }\n}",
    "dilfe_name": "dilfi_set",
    "c_implementation": "void dilfi_set(dilprg *p)\n{\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"set\", p, 1, v2, TYPEFAIL_NULL, 1, DILV_INT))\n    {\n        switch (v1->type)\n        {\n            case DILV_SINT1R:\n                *((sbit8 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_SINT2R:\n                *((sbit16 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_SINT4R:\n                *((sbit32 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_UINT1R:\n                *((ubit8 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_UINT2R:\n                *((ubit16 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_UINT4R:\n                *((ubit32 *)v1->ref) |= v2->val.num;\n                break;\n            case DILV_FAIL:\n                break;\n            default:\n                /* not an lvalue! */\n                dil_typeerr(p, \"lvalue set\");\n                break;\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin bob();\nvar\n\tpc\t:\tunitptr;\n\ti\t:\tinteger;\ncode\n{\n   heartbeat := PULSE_SEC * 3;\n   :start:\n   wait(SFB_CMD, (command(\"write\") or command(\"sign\")));\n   block;\n\n   if (activator.type != UNIT_ST_PC)\n     goto start;\n\n   if (activator.level < 50)\n   {\n      act(\"The Book of Blood quakes violently in its resting \" +\n\t  \"spot, a voice intones 'Thou must be of an experience \" +\n\t  \"level of 50 or higher to register in the death book'.\" ,\n\t  A_ALWAYS, activator, null, null, TO_CHAR);\n      act(\"The Book of Blood refuses to let \"+activator.name+\" sign.\",\n\t A_ALWAYS, activator, null, null, TO_REST);\n      goto start;\n   }\n\n   if (not (\"book\" in argument))\n   {\n      act(\"If you want to sign $2n, then type 'sign book'.\",\n\t  A_ALWAYS, activator, self, null, TO_CHAR);\n      goto start;\n   }\n\n   if (isset(activator.pcflags, PC_PK_RELAXED))\n   {\n      act(\"You are already signed up in $2n, the treacherous \" +\n\t  \"ways of death are already familiar to you!\",\n          A_ALWAYS, activator, self, null, TO_CHAR);\n   }\n   else\n   {\n      pc := activator;\n      secure(pc, start);\n\n      act(\"The Book of Blood seems to shudder into life!\",\n\t  A_ALWAYS, pc, self, null, TO_CHAR);\n      pause;\n      act(\"A morbid voice intones 'Thou truly wishes to sign the \" +\n\t  \"death book? Let the warnings of the dead ring out in your \" +\n       \t  \"mind!\", A_ALWAYS, pc, self, null, TO_CHAR);\n\t\tpause;\n      act(\"The voices of the dead whisper 'If you really choose to sign, \" +\n\t  \"be it known that your death may be sought by ANYONE else \" +\n\t  \"who has signed. You will be free to murder other signers \" +\n\t  \"as you wish.\", A_ALWAYS, pc, self, null, TO_CHAR);\n      pause;\n      act (\"Understand though if you sign there is no turning back.  \"+\n      \"Once a book signer always a book signer.  Also don't complain to \"+\n      \"The gods about another book signer that kills you cause thats what\nsigning \"+\n      \"this book means.  You are giving your permission to be killed.\",\n        A_ALWAYS, pc, self, null, TO_CHAR);\n        pause;\n\n      act(\"The voices of the dead whisper 'If you still wish to sign, \" +\n\t  \"do so now, repeat the procedure to complete your entrance \" +\n        \"into the league of death!'\",\n        A_ALWAYS, pc, self, null, TO_CHAR);\n      i := 0;\n      while (i < 2)\n      {\n         wait(SFB_CMD, activator == pc);\n         if ((command(\"write\") or command(\"sign\")) and (\"book\" in argument))\n         {\n\t         block;\n            goto book_signed;\n         }\n         else\n         {\n \t  block;\n\t    act(\"You have to 'write book' to complete the procedure \" +\n\t        \"and live out your days as a fugitive from \" +\n\t        \"death!\", A_ALWAYS, activator, self, null, TO_CHAR);\n \t }\n         i := i+1;\n      }\n      act(\"An eerie voice exclaims 'A wise decision not to sign!\",\n\t  A_ALWAYS, activator, self, null, TO_CHAR);\n      unsecure(pc);\n      goto start;\n      :book_signed:\n      set(activator.pcflags, PC_PK_RELAXED);\n      act(\"You sign $2n, your wrist flares with pain and you \" +\n\t  \"notice you have a new scar, an insignia of your allegiance \" +\n\t  \"with death!\",\n          A_ALWAYS, activator, self, null, TO_CHAR);\n      act(\"$1n signs $2n, a scar wells up to signify the allegiance \" +\n\t  \"with death.\",\n          A_ALWAYS, activator, self, null, TO_ROOM);\n      unsecure(pc);\n   }\n\n   goto start;\n} dilend"
}