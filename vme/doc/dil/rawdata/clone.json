{
    "keyword": "clone",
    "opcode": "DILSE_CLONE",
    "yacc_rule": "| DILSE_CLONE '(' dilexp ')'\n{\n    INITEXP($$);\n    if ($3.typ != DilVarType_e::DILV_UP)\n    {\n        dilfatal(\"Arg 1 of 'clone' not unit pointer\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Make nodes dynamic */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_UP;\n        make_code(&($3));\n        add_code(&($$), &($3));\n        add_ubit8(&($$), DILE_CLONE);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_clone",
    "c_implementation": "void dilfe_clone(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* Load a unit from database */\n    dilval *v1 = p->stack.pop();\n\n    switch (dil_getval(v1))\n    {\n        case DILV_NULL:\n        case DILV_FAIL:\n            v->type = DILV_FAIL;\n            break;\n        case DILV_UP:\n            if (v1->val.ptr)\n            {\n                v->val.ptr = ((unit_data *)v1->val.ptr)->copy();\n                if (v->val.ptr)\n                {\n                    unit_to_unit((unit_data *)v->val.ptr, p->sarg->owner);\n                    dil_loadtime_activate((unit_data *)v->val.ptr);\n                    v->atyp = DILA_NORM;\n                    v->type = DILV_UP;\n                }\n                else\n                {\n                    v->type = DILV_NULL; /* Unit not found */\n                }\n            }\n            else\n            {\n                v->type = DILV_FAIL; /* NULL string */\n            }\n            break;\n        default:\n            v->type = DILV_ERR; /* wrong type */\n            break;\n    }\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin not_used(arg : string);\ncode\n{\n   // The functions in comments here have not been used in any DIL program.\n   // I suppose they're considered obsolete until someone needs them\n   // and they get tested.\n   //\n   // buf := getcolor(\"&br\"); -- NOT USED ANYWHERE\n   // buf := addcolor(); --NOT USED ANYWHERE\n   // buf := delcolor(); --NOT USED ANYWHERE\n   // buf := changecolor(); --NOT USED ANYWHERE\n   // buf := getcmd(); --NOT USED ANYWHERE\n   // buf := clone(); --NOT USED ANYWHERE\n   // buf := global_head(); --NOT USED ANYWHERE\n   // buf := obj_head(); --NOT USED ANYWHERE\n   // buf := npc_head(); --NOT USED ANYWHERE\n   // buf := room_head(); --NOT USED ANYWHERE\n   // buf := zone_head(); --NOT USED ANYWHERE\n   // buf := command_head(); --NOT USED ANYWHERE\n   // buf := strncmp(); --NOT USED ANYWHERE\n   // buf := check_password(); --NOT USED ANYWHERE\n   // buf := acc_total(); --NOT USED ANYWHERE\n   // buf := loglevel(); --NOT USED ANYWHERE\n   // buf := spell_levels(); --NOT USED ANYWHERE\n   // buf := spell_costs(); --NOT USED ANYWHERE\n   // buf := hasfunc(); --NOT USED ANYWHERE\n   // buf := ability_levels(); --NOT USED ANYWHERE\n   // buf := ability_costs(); --NOT USED ANYWHERE\n   // buf := weapon_levels(); --NOT USED ANYWHERE\n   // buf := weapon_costs(); --NOT USED ANYWHERE\n   // buf := skill_levels(); --NOT USED ANYWHERE\n   // buf := skill_costs(); --NOT USED ANYWHERE\n   // buf := lastroom(); --NOT USED ANYWHERE\n   // buf := unit.objs(); --NOT USED ANYWHERE\n   // buf := unit.roomcount(); --NOT USED ANYWHERE\n   // buf := unit.objcount(); --NOT USED ANYWHERE\n   // buf := unit.npccount(); --NOT USED ANYWHERE\n   // buf := unit.resetmode(); --NOT USED ANYWHERE\n   // buf := unit.loadlevel(); --NOT USED ANYWHERE\n\n   quit;\n} dilend"
}