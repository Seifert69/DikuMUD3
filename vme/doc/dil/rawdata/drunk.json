{
    "keyword": "drunk",
    "opcode": "DILSF_DRK",
    "yacc_rule": "| DILSF_DRK /* .drunk */\n{\n    INITEXP($$);\n    $$.rtyp = DilVarType_e::DILV_UP;\n    $$.typ = DilVarType_e::DILV_INT;\n    $$.dsl = DSL_LFT;\n    $$.num = DILF_DRK;\n}",
    "dilfe_name": "DILF_DRK",
    "c_implementation": "case DILF_DRK:\n            switch (dil_getval(v1))\n            {\n                case DILV_NULL: /* not applicable */\n                case DILV_FAIL:\n                    v->type = DILV_FAIL; /* not applicable */\n                    break;\n                case DILV_UP:\n                {\n                    auto *pc = reinterpret_cast<pc_data *>(v1->val.ptr);\n                    if (pc && pc->isPC())\n                    {\n                        v->atyp = DILA_NONE;\n                        v->type = DILV_SINT1R;\n                        v->ref = pc->getConditionAtIndexPtr(DRUNK);\n                    }\n                    else\n                    {\n                        v->type = DILV_FAIL;\n                    }\n                }\n                break;\n                default:\n                    v->type = DILV_ERR; /* wrong type */\n                    break;\n            }\n            break;",
    "dil_example": "dilbegin do_score(arg:string);\nexternal\n   string titlestring();\n   string agestring(rce : integer);\n   string playingstring();\n\nvar\n   u : unitptr;\n   leader : unitptr;\n   slave : unitptr;\n   alig : string;\n   pos : string;\n   deaths:string;\n   want : string;\n   start: string;\n   sav : string;\n   bob : string;\n   stat : string;\n   stat1 : string;\n   stat2 : string;\n   slvl : string;\n   i : integer;\ncode\n{\n   if (arg != \"\")\n   {\n      if (arg == \"hp\")\n      {\n         sendtext(itoa(self.hp) + \"<br/>\", self);\n         quit;\n      }\n      else if (arg == \"ep\")\n      {\n         sendtext(itoa(self.endurance) + \"<br/>\", self);\n         quit;\n      }\n      else if (arg == \"mp\")\n      {\n         sendtext(itoa(self.mana) + \"<br/>\", self);\n         quit;\n      }\n   }\n\n   /*if (self.type!=UNIT_ST_PC) quit;*/\n\n   if (self.position == POSITION_FIGHTING)\n   {\n      sendtext(\"Not while fighting!<br/>\", self);\n      quit;\n   }\n\n   /*whats my align */\n   if (self.alignment > 350)\n      alig := \"(Good)\";\n   else if (self.alignment < -350)\n      alig := \"(Evil)\";\n   else\n      alig := \"(Neutral)\";\n   /*whats my position */\n\n   if (self.position == POSITION_DEAD)\n      pos := \"<div class='score'>Sorry old chap, it seems like you're Dead!</div>\";\n   else if (self.position == POSITION_MORTALLYW)\n      pos := \"<div class='score'>You are mortally wounded, you should seek help!</div>\";\n   else if (self.position == POSITION_INCAP)\n      pos := \"<div class='score'>You are incapacitated, slowly fading away.</div>\";\n   else if (self.position == POSITION_STUNNED)\n      pos := \"<div class='score'>You are stunned and unable to move.</div>\";\n   else if (self.position == POSITION_SLEEPING)\n      pos := \"<div class='score'>You are sleeping.</div>\";\n   else if (self.position == POSITION_RESTING)\n      pos := \"<div class='score'>You are resting.</div>\";\n   else if (self.position == POSITION_SITTING)\n      pos := \"<div class='score'>You are sitting.</div>\";\n   else\n      pos := \"<div class='score'>You are standing.</div>\";\n\n   if (\"$TOTAL_DEATHS\" in self.extra)\n      deaths:=\"You have died a total of \"+itoa(self.extra.[\"$TOTAL_DEATHS\"].vals.[0])+\" times <br/>\";\n   else \n      deaths:=\"\";\n   \n   if (isset(self.charflags, CHAR_PROTECTED))\n      want := \"<div class='score'>You are a protected citizen.</div>\";\n   else if (isset(self.charflags, CHAR_LEGAL_TARGET))\n      want := \"<div class='score'>You are a protected citizen, but people may kill you now!</div>\";\n   else if (isset(self.charflags, CHAR_OUTLAW))\n      want := \"<div class='score'>You are wanted dead or alive by the law.</div>\";\n   else if (\"$reward\" in self.extra )\n      want := \"<div class='score'>There is a reward on your head.</div>\";\n   else\n      want :=\"\";\n\n   /* am i BoB */\n   if (isset(self.pcflags,PC_PK_RELAXED))\n      bob := \"<div class='score'>You have signed the Book of Blood.</div>\";\n   else\n      bob :=\"\";\n\n   /* am i drunk hungry thirsty? */\n   if (self.drunk > 10 )\n      stat :=\"<div class='score'>You are drunk!</div>\";\n   else\n      stat := \"\";\n\n\n   if (self.thirst < 4 )\n      stat1 :=\"<div class='score'>You are thirsty.</div>\";\n   else\n      stat1 := \"\";\n\n   if (self.full < 4 )\n      stat2 :=\"<div class='score'>You are hungry!</div>.\";\n   else\n      stat2 := \"\";\n\n   start := \"\";\n   if (self.level <= START_LEVEL)\n      start := \"<br/><div class='score'>Also try the '<a cmd='#'>status</a>' command.</div>\";\n    \n   if (not isplayer(self.name))\n\t{\n      sendtext (\"<div class='score'>You remain a GUEST until you 'save' yourself</div><br/>\",self);\n      quit;\n\t}\n\n\n   slvl := \"\";\n   if (self.exptol <= 0)\n   {\n      slvl := \"<b>You can now advance a <a cmd='#'>level</a> - congratulations!</b><br/>\";\n   }\n\n   if ((self.ability_points >= 10) or (self.skill_points >= 10))\n   {\n      // Override level now message\n      slvl := \"<b>You have unspent practice points, you should <a cmd='#'>practice auto</a> now or go visit a teacher.</b><br/>\";\n   }\n\n   if (arg==\"\")\n   {\n      act(titlestring()\n         +\"<div class='score'>\" + agestring(self.race)\n         +\"You have \"+itoa(self.exp)+\" experience points and you need \"\n         +itoa(self.exptol) + \" to the next level.</div><br/>\"+\n         slvl\n         +\"<div class='score'>You have \"+itoa(self.hp)+\"(\"+itoa(self.max_hp)+\") hit, \"\n         +itoa(self.mana)+\"(\"+itoa(self.max_mana)+\") mana, \"\n         +itoa(self.endurance)+\"(\"+itoa(self.max_endurance)+\") endurance points.</div><br/>\"\n         +\"<div class='score'>\"+bob+\"\"+playingstring()+deaths+\"\"+want+\" \"+pos+\"\"+stat+\"\"+stat1+\"\"+stat2+\"</div>\"+start\n         ,A_ALWAYS, self, null, null, TO_CHAR);\n      quit;\n   }\n   else if (arg==left(\"group\",length(arg)))\n   {\n   if (isset(self.charflags,CHAR_GROUP))\n   {\n   if ((self.master==null) or (self.master==self))\n   {\n   :not_leader:\n      if (self.followercount<=0)\n      {\n   act(\"<div class='score'>What group!!</div>\",A_ALWAYS,self,null,self,TO_CHAR);\n   quit;\n   }\n   act(\"<div class='score'>\"+self.name+\" \"+itoa(self.hp)+\"/\"+itoa(self.max_hp)+\n      \" Hitpoints, \"+itoa(self.endurance)+\"/\"+itoa(self.max_endurance)+\n      \" Endurance, \"+itoa(self.mana)+\"/\"+itoa(self.max_mana)+\" Mana\"+\n      \" to the group.</div>\",A_ALWAYS,self,null,null,TO_CHAR);\n   i:=0;\n   while (i<self.followercount)\n   {\n   u:=getfollower(self,i);\n   if (isset(u.charflags,CHAR_GROUP))\n      act(\"<div class='score'>\"+u.name+\" \"+itoa(u.hp)+\"/\"+itoa(u.max_hp)+\n      \" Hitpoints, \"+itoa(u.endurance)+\"/\"+itoa(u.max_endurance)+\n      \" Endurance, \"+itoa(u.mana)+\"/\"+itoa(u.max_mana)+\" Mana\"+\n      \" to the group.</div>\",A_ALWAYS,self,null,u,TO_CHAR);\n      i:=i+1;\n      }\n\n   }\n         else\n         {\n         if (isset(self.master.charflags,CHAR_GROUP))\n         {\n         leader:=self.master;\n         secure (leader,lead_end);\n   act (\"<div class='score'>\"+leader.name+\" \"+itoa(leader.hp)+\"/\"+itoa(leader.max_hp)+\n      \" Hitpoints, \"+itoa(leader.endurance)+\"/\"+itoa(leader.max_endurance)+\n      \" Endurance, \"+itoa(leader.mana)+\"/\"+itoa(leader.max_mana)+\" Mana\"+\n      \" to the group.</div>\",A_ALWAYS,self,null,leader,TO_CHAR);\n   while (i<leader.followercount)\n   {\n   u:=getfollower(leader,i);\n      if (isset(u.charflags,CHAR_GROUP))\n      act(\"<div class='score'>\"+u.name+\" \"+itoa(u.hp)+\"/\"+itoa(u.max_hp)+\n      \" Hitpoints, \"+itoa(u.endurance)+\"/\"+itoa(u.max_endurance)+\n      \" Endurance, \"+itoa(u.mana)+\"/\"+itoa(u.max_mana)+\" Mana\"+\n      \" to the group.</div>\",A_ALWAYS,self,null,u,TO_CHAR);\n      i:=i+1;\n      }\n\n         }\n         else\n         goto not_leader;\n         }\n\n   }\n   else\n   sendtext (\"You are not in a group silly.<br/>\",self);\n   }\n   else\n      sendtext(\"Use 'score', 'score group', 'score mp', 'score ep', or 'score hp'.<br/>\",self);\n\n   :lead_end:\n   unsecure(leader);\n   quit;\n} dilend"
}