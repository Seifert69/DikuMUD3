{
    "keyword": "send",
    "opcode": "DILSI_SND",
    "yacc_rule": "| DILSI_SND '(' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'send' not a string\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $5 + 1;\n        wtmp = &tmpl.core[$5];\n        bwrite_ubit8(&wtmp, DILI_SND);\n    }\n}",
    "dilfe_name": "dilfi_snd",
    "c_implementation": "void dilfi_snd(dilprg *p)\n{\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"send\", p, 1, v1, TYPEFAIL_NULL, 1, DILV_SP))\n    {\n        if (v1->val.ptr)\n        {\n            send_message(p->sarg->owner, (char *)v1->val.ptr);\n            dil_test_secure(p);\n        }\n    }\n    delete v1;\n}",
    "dil_example": "dilbegin fnpri(FN_PRI_RESCUE-1) jailstay(du : integer);\nexternal\n   integer add_reward@justice(criminal_symname : string, criminal_idx : integer, crime_type : integer);\n   rem_db_entry@justice(criminal : unitptr, extra_type : string, juris : string);\n   getfrom_safe(prisoner : unitptr);\n   set_char_flags@justice(char : unitptr, setting : string);\nvar\n   sname : string;\n   jd : unitptr;\n   id : string;\n   juris : string; \n   k : string;\n   gold : integer;\n   g : string;\ncode\n{\n   heartbeat := PULSE_SEC * SECS_PER_MUD_HOUR;\n   juris := self.outside.zoneidx;\n   sname := self.outside.symname; // Get the jail symname\n\n   jd := findsymbolic(\"database@justice\");\n   id := \"$reward \"+ self.symname + \" \" + itoa(self.idx) + \" \"+ juris;\n   k := \"$reward \"+ juris;\n     \n   // Change player arrest descr to reflect that the char is in jail.\n   //\n   jd := findsymbolic(\"database@justice\");\n   \n   if( \"$reward\" in self.extra)\n   {\n      jd.extra.[id].names.[4] := \"-1\";\n      self.extra.[k].names.[4] := \"-1\";\n      jd.extra.[id].descr := self.name+\" is currently serving time in jail.\";\n   }\n\n \n  :loop:\n   pause;\n   if (sname != self.outside.symname)\n   {\n      // Player has escaped from jail\n      jd := findsymbolic(\"database@justice\");\n      jd.extra.[id].names.[4] := \"65\";\n      self.extra.[k].names.[4] := \"65\";\n      gold := atoi(jd.extra.[id].names.[2]); \n      g := moneystring(gold,1); \n      jd.extra.[id].descr := \"A reward of \" + g + \" has been offered for the head of \"+self.name;\n      set_char_flags@justice(self, \"wanted\");\n      log(\"Jailbreak: \"+self.name+\" has escaped from the \"+ juris +\" jail.\"); \n      quit;\n   }\n\n   if(\"$reward\" in self.extra)\n   {\n      jd := findsymbolic(\"database@justice\");\n      jd.extra.[id].names.[4] := \"-1\";\n      jd.extra.[id].descr := self.name+\" is currently serving time in jail. \"+itoa(du)+\" hours remaining\";\n   }\n\n   if ((du % 4) == 0)\n     send(\"jailfood\");\n\n   if (du == 24)\n   {\n      act(\"At last! The very last day of your term!\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n   }\n   else if (du == 12)\n   {\n      act(\"Only half a day left 'till your freedom!\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n   }\n   else if (du <= 1)\n     goto release;\n   else\n   {\n      act(\"You make another mark on the wall. Only \"+itoa(du)+\" hours till freedom!\",\n          A_ALWAYS, self, null, null, TO_CHAR);\n   }\n   \n   du := du - 1;\n   goto loop;\n\n\n   /* Get thrown out of jail */\n   :release:\n   act(\"Your term is over! You are thrown out of the jail and sent home.\",\n       A_ALWAYS, self, null, null, TO_CHAR);\n   getfrom_safe(self);\n   link(self, findroom(\"accuse_room@\" + juris));\n   rem_db_entry@justice(self, \"$reward\", juris);\n   set_char_flags@justice(self, \"arrest\");\n   quit;\n} dilend"
}