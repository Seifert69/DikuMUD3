{
    "keyword": "sendtoall",
    "opcode": "DILSI_SNTA",
    "yacc_rule": "| DILSI_SNTA '(' coreexp ',' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'sendtoall' not a string\");\n    }\n    else if ($5.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 2 of 'sendtoall' not a string\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $7 + 1;\n        wtmp = &tmpl.core[$7];\n        bwrite_ubit8(&wtmp, DILI_SNTA);\n    }\n}",
    "dilfe_name": "dilfi_snta",
    "c_implementation": "void dilfi_snta(dilprg *p)\n{\n    /* Send message to DIL programs in all units of type specified */\n    /* sendtoall (string, string) */\n\n    dilval *v2 = p->stack.pop();\n    dilval *v1 = p->stack.pop();\n\n    p->waitcmd--;\n\n    if (dil_type_check(\"sendtoall\", p, 2, v1, TYPEFAIL_NULL, 1, DILV_SP, v2, TYPEFAIL_NULL, 1, DILV_SP))\n    {\n        if (v1->val.ptr && v2->val.ptr)\n        {\n            file_index_type *fi = nullptr;\n\n            if ((fi = str_to_file_index((char *)v2->val.ptr)))\n            {\n                spec_arg sarg;\n\n                sarg.activator = p->sarg->owner;\n                sarg.medium = p->sarg->owner;\n                sarg.target = nullptr;\n                sarg.pInt = nullptr;\n                sarg.fptr = nullptr; /* Set by unit_function_scan */\n\n                sarg.fptr = nullptr;\n                sarg.cmd = &g_cmd_auto_msg;\n                sarg.arg = (char *)v1->val.ptr;\n                sarg.mflags = SFB_MSG;\n\n                if (!fi->Empty())\n                {\n                    std::forward_list<unit_data *>::iterator it;\n                    std::forward_list<unit_data *>::iterator next_it;\n                    for (it = fi->Begin(); it != fi->End(); it = next_it)\n                    {\n                        next_it = it;\n                        next_it++;\n                        unit_function_scan(*it, &sarg);\n                    }\n                }\n\n                /*for (u = g_unit_list; u; u = u->gnext)\n                {\n                    if (UNIT_FILE_INDEX(u) == fi)\n                        unit_function_scan(u, &sarg);\n                }*/\n                dil_test_secure(p);\n            }\n        }\n    }\n    delete v1;\n    delete v2;\n}",
    "dil_example": "dilbegin aware recall arena_check ();\ncode\n{\n   interrupt(SFB_MSG, ((argument==\"destroy arena\") and (self==activator)), dest);\n   heartbeat := PULSE_SEC*60;\n\n   :loop:\n   wait (SFB_TICK|SFB_COM,TRUE);\n   if ((self.zone!=\"arena\") and (self.outside!=findroom(\"deathseq_room@basis\")))\n   {\n      act (\"Some how you left the Arena illegally you are being restored to your status before entering the arena.\",\n         A_SOMEONE,self,null,null,TO_CHAR);\n      sendtoall(\"emptyout\", \"bag@arena\");\n      sendto(\"destroy arena\", self);\n      quit;\n   }\n   goto loop;\n\n   :dest:\n   quit;\n} dilend"
}