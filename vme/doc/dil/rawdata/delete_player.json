{
    "keyword": "delete_player",
    "opcode": "DILSI_DELPC",
    "yacc_rule": "| DILSI_DELPC '(' coreexp ')' ihold\n{\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'delete_player' not an string\");\n    }\n    else\n    {\n        $$.fst = $3.fst;\n        $$.lst = $5 + 1;\n        wtmp = &tmpl.core[$5];\n        bwrite_ubit8(&wtmp, DILI_DELPC);\n    }\n}",
    "dilfe_name": "dilfi_delpc",
    "c_implementation": "void dilfi_delpc(dilprg *p)\n{\n    dilval *v1 = p->stack.pop();\n    descriptor_data *d = nullptr;\n    unit_data *tmp = nullptr;\n\n    if (dil_type_check(\"delete_player\", p, 1, v1, TYPEFAIL_NULL, 1, DILV_SP))\n    {\n        if (p->frame[0].tmpl->zone->getAccessLevel() > 0)\n        {\n            szonelog(p->frame->tmpl->zone, \"DIL '%s' attempt to violate system access security (delete_player).\", p->frame->tmpl->prgname);\n            p->waitcmd = WAITCMD_QUIT;\n        }\n        else\n        {\n            if (v1->val.ptr)\n            {\n                if ((d = find_descriptor(((char *)v1->val.ptr), nullptr)))\n                {\n                    extract_unit(d->getCharacter());\n                    descriptor_close(d);\n                }\n                else\n                {\n                    for (tmp = g_unit_list; tmp; tmp = tmp->getGlobalNext())\n                    {\n                        if (tmp->isPC() && !str_ccmp(tmp->getNames().Name(), ((char *)v1->val.ptr)))\n                        {\n                            extract_unit(tmp);\n                        }\n                    }\n                }\n\n                delete_player((char *)v1->val.ptr);\n            }\n        }\n    }\n    delete v1;\n}",
    "dil_example": "dilbegin god_delete(pname:string);\nexternal\n integer submember (s:string,pname:string);\n\tvar\n\t\ti:integer;\n\t\terr:integer;\n\t\tbuf:string;\n\t\tln:integer;\n\n\t\tclist:stringlist;\ncode\n{\n\terr:=loadstr (\"clanlist.data\",buf);\n\tif (err<1)\n\t{\n\t\tdelete_player(pname);\n\t\treturn;\n\t}\n\n\tclist:=split(buf,\"\\n\");\n\tln:=length (clist);\n\tln:=ln-1;\n\tif (ln<1)\n\t{\n\t\tdelete_player(pname);\n\t\treturn;\n\t}\n\ti:=0;\n\twhile (i<ln)\n\t{\n\t\terr:=submember(clist.[i],pname);\n\t\ti:=i+1;\n\t}\n\tdelete_player(pname);\n\treturn;\n} dilend"
}