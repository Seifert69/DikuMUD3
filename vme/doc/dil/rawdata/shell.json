{
    "keyword": "shell",
    "opcode": "DILSE_SHELL",
    "yacc_rule": "| DILSE_SHELL '(' dilexp ')'\n{\n    INITEXP($$);\n    if ($3.typ != DilVarType_e::DILV_SP)\n    {\n        dilfatal(\"Arg 1 of 'shell' not string\");\n    }\n    else\n    {\n        /* Type is ok */\n        /* Function is not _yet_ static */\n        $$.dsl = DSL_DYN;\n        $$.typ = DilVarType_e::DILV_INT;\n        make_code(&($3));\n        add_code(&($$), &($3));\n        add_ubit8(&($$), DILE_SHELL);\n    }\n    FREEEXP($3);\n}",
    "dilfe_name": "dilfe_shell",
    "c_implementation": "void dilfe_shell(dilprg *p)\n{\n    dilval *v = new dilval;\n    /* Get the ID number of a player. */\n    dilval *v1 = p->stack.pop();\n\n    switch (dil_getval(v1))\n    {\n        case DILV_NULL:\n        case DILV_FAIL:\n            v->type = DILV_FAIL; /* failed */\n            break;\n        case DILV_SP:\n            if (v1->val.ptr)\n            {\n                v->type = DILV_INT;\n                v->atyp = DILA_NONE;\n                if (p->frame[0].tmpl->zone->getAccessLevel() != 0) // 0 is the highest access\n                {\n                    szonelog(p->frame->tmpl->zone, \"DIL '%s' attempt run shell() w/o access.\", p->frame->tmpl->prgname);\n                    p->waitcmd = WAITCMD_QUIT;\n                }\n                else\n                {\n                    pthread_t mythread = 0;\n                    v->val.num = pthread_create(&mythread, nullptr, threadcallout, v1->val.ptr);\n                    if (v->val.num)\n                    {\n                        slog(LOG_ALL, 0, \"DIL shell pthread create error code %d.\", v->val.num);\n                    }\n                    // threadcallout((char *) v1->val.ptr);\n                }\n            }\n            break;\n        default:\n            v->type = DILV_ERR; /* Wrong type */\n            break;\n    }\n\n    p->stack.push(v);\n    delete v1;\n}",
    "dil_example": "dilbegin shelltest();\nvar \n  i : integer;\ncode\n{\n   :loop:\n   wait(SFB_CMD, command(\"bow\"));\n\n   i := shell(\"test.sh olle golle\");\n   log(\"shell = \" + itoa(i));\n   goto loop;\n} dilend"
}