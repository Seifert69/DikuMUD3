= store =
function: '''store'''(u : unitptr, filename : string, container : integer);

The '''store''' function saves a unit and its contents to a file for later restoration.

== Description ==
This function saves a copy of a unit to a file on disk, allowing it to be restored later using the [[Manual:DIL_Manual/restore|restore]] function. The function can save either just the contents of a unit or the unit itself along with its contents, depending on the container parameter.

When container is TRUE, the unit itself and all its contents are saved. When container is FALSE, only the contents of the unit are saved, not the unit itself. This makes the function versatile for different storage needs like saving player inventories, room contents, or storage containers.

The function requires zone access level 10 or lower to execute successfully. Files are stored in the DIL file directory under a "units/" subdirectory.

== Parameters ==
{| class="wikitable"
! Parameter !! Type !! Description
|-
| u || unitptr || The unit to be stored (cannot be a room or PC)
|-
| filename || string || The name of the file to store the unit in
|-
| container || integer || TRUE to save unit and contents, FALSE to save only contents
|}

== Return Value ==
The function does not return a value.

== Examples ==
=== Save Container Contents Only ===
 dilbegin save_chest_contents();
 var
   chest : unitptr;
 code
 {
   chest := self;
   
   if (chest.type != UNIT_ST_OBJ)
   {
     sendtext("This command only works on container objects.<br/>", self);
     quit;
   }
   
   // Save only the contents, not the chest itself
   store(chest, "chest." + chest.zoneidx, FALSE);
   
   sendtext("Chest contents have been saved.<br/>", self);
 }
 dilend

=== Save Container and Contents ===
 dilbegin save_storage_chest();
 var
   chest : unitptr;
 code
 {
   chest := self;
   
   if (chest.type != UNIT_ST_OBJ)
   {
     sendtext("This command only works on container objects.<br/>", self);
     quit;
   }
   
   // Save the chest and everything inside it
   store(chest, "storage_chest." + chest.zoneidx, TRUE);
   
   sendtext("Storage chest and its contents have been saved.<br/>", self);
 }
 dilend

=== Player Inventory Storage ===
 dilbegin save_player_inventory();
 var
   pc : unitptr;
   storage_box : unitptr;
 code
 {
   pc := activator;
   
   if (pc.type != UNIT_ST_PC)
   {
     sendtext("This command only works on players.<br/>", self);
     quit;
   }
   
   // Create temporary storage box
   storage_box := load("temp_storage_box@storage");
   
   if (storage_box == null)
   {
     sendtext("Storage system unavailable.<br/>", self);
     quit;
   }
   
   // Move all player items to storage box
   while (pc.inside)
   {
     link(pc.inside, storage_box);
   }
   
   // Save the storage box with player's inventory
   store(storage_box, "player_backup." + pc.name, TRUE);
   
   sendtext("Your inventory has been safely stored.<br/>", pc);
   
   // Clean up
   destroy(storage_box);
 }
 dilend

== Usage Notes ==
* The function requires zone access level 10 or lower
* Units of type UNIT_ST_ROOM and UNIT_ST_PC cannot be stored
* Files are saved in the DIL file directory under "units/" subdirectory
* Use TRUE for container parameter to save unit and its contents
* Use FALSE for container parameter to save only contents
* The filename should not include path or extension
* Use [[Manual:DIL_Manual/restore|restore]] function to load previously stored units
* Disk access is slow - use sparingly to avoid server performance issues
* Player inventories are automatically saved, so explicit storage is only needed for special cases

== Error Handling ==
The function handles errors in the following ways:
* Invalid unit types (rooms, PCs) cause security violation log
* Null or invalid unit pointer causes no action
* Invalid filename causes security violation log
* Insufficient zone access level causes security violation log
* No runtime errors are generated for valid parameters

Always validate unit type and access level before calling the function.

== Related Functions/Fields ==
* [[Manual:DIL_Manual/restore|restore]] - Load a previously stored unit
* [[Manual:DIL_Manual/delunit|delunit]] - Delete a stored unit file
* [[Manual:DIL_Manual/load|load]] - Load a unit from main database
* [[Manual:DIL_Manual/findunit|findunit]] - Find a unit in the game world

== See Also ==
* DIL File System Documentation
* Zone Access Level Documentation
* Unit Storage and Retrieval Systems
* DIL Security and Access Control